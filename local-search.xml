<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>DockeråŸºæœ¬ä½¿ç”¨åŠé…ç½®Mysqlã€redisç¯å¢ƒ</title>
    <link href="/2022/07/20/2022-7-16-Docker%E4%BD%BF%E7%94%A8/"/>
    <url>/2022/07/20/2022-7-16-Docker%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ç¯å¢ƒ:CentOS7</p></blockquote><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h3 id="å®‰è£…ä¸€äº›å¿…è¦çš„ç³»ç»Ÿå·¥å…·"><a href="#å®‰è£…ä¸€äº›å¿…è¦çš„ç³»ç»Ÿå·¥å…·" class="headerlink" title="å®‰è£…ä¸€äº›å¿…è¦çš„ç³»ç»Ÿå·¥å…·"></a>å®‰è£…ä¸€äº›å¿…è¦çš„ç³»ç»Ÿå·¥å…·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y yum-utils device-mapper-persistent-data lvm2<br></code></pre></td></tr></table></figure><h3 id="æ·»åŠ è½¯ä»¶æºä¿¡æ¯"><a href="#æ·»åŠ è½¯ä»¶æºä¿¡æ¯" class="headerlink" title="æ·»åŠ è½¯ä»¶æºä¿¡æ¯"></a>æ·»åŠ è½¯ä»¶æºä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker å®˜æ–¹æº</span><br>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<br><span class="hljs-comment"># é˜¿é‡Œäº‘æº</span><br>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…-Docker-ce"><a href="#å®‰è£…-Docker-ce" class="headerlink" title="å®‰è£… Docker-ce"></a>å®‰è£… Docker-ce</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…å‰å¯ä»¥å…ˆæ›´æ–° yum ç¼“å­˜:</span><br>yum makecache fast<br><span class="hljs-comment"># å®‰è£… Docker-ce (è¿™ä¸ªæ˜¯æ–°ç‰ˆæœ¬)</span><br>yum install docker-ce<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…ç‰¹å®šç‰ˆæœ¬-Docker"><a href="#å®‰è£…ç‰¹å®šç‰ˆæœ¬-Docker" class="headerlink" title="å®‰è£…ç‰¹å®šç‰ˆæœ¬ Docker"></a>å®‰è£…ç‰¹å®šç‰ˆæœ¬ Docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum list docker-ce --showduplicates | <span class="hljs-built_in">sort</span> -r<br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.9-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.8-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.7-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.6-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.5-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.4-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.3-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># docker-ce.x86_64            3:20.10.2-3.el7                    docker-ce-stable </span><br><span class="hljs-comment"># é€‰æ‹©ç‰ˆæœ¬å®‰è£…</span><br>yum install docker-ce-&lt;VERSION STRING&gt;<br><br><span class="hljs-comment"># é€‰æ‹©å®‰è£… docker-ce-18.06.1.ce</span><br>yum install docker-ce-18.06.1.ce<br></code></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹-Docker-ç‰ˆæœ¬"><a href="#æŸ¥çœ‹-Docker-ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ Docker ç‰ˆæœ¬"></a>æŸ¥çœ‹ Docker ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker -v<br>--------------------------------------<br>Docker version 20.10.17, build 100c701<br></code></pre></td></tr></table></figure><h1 id="å®‰è£…MySQL"><a href="#å®‰è£…MySQL" class="headerlink" title="å®‰è£…MySQL"></a>å®‰è£…MySQL</h1><h2 id="æŸ¥çœ‹å¯ç”¨-MySQL-ç‰ˆæœ¬"><a href="#æŸ¥çœ‹å¯ç”¨-MySQL-ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹å¯ç”¨ MySQL ç‰ˆæœ¬"></a>æŸ¥çœ‹å¯ç”¨ MySQL ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker search mysql<br></code></pre></td></tr></table></figure><h2 id="æ‹‰å–å®˜æ–¹ç‰ˆæœ¬é•œåƒ"><a href="#æ‹‰å–å®˜æ–¹ç‰ˆæœ¬é•œåƒ" class="headerlink" title="æ‹‰å–å®˜æ–¹ç‰ˆæœ¬é•œåƒ"></a>æ‹‰å–å®˜æ–¹ç‰ˆæœ¬é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ‹‰å–æŒ‡å®šç‰ˆæœ¬</span><br>ocker pull mysql:5.7.14<br><br><span class="hljs-comment"># æˆ–è€…æ‹‰å–æœ€æ–°ç‰ˆæœ¬</span><br>docker pull mysql:latest<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æœ¬åœ°é•œåƒ"><a href="#æŸ¥çœ‹æœ¬åœ°é•œåƒ" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°é•œåƒ"></a>æŸ¥çœ‹æœ¬åœ°é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker images<br></code></pre></td></tr></table></figure><h2 id="å‡†å¤‡è¿è¡Œ-mysql-å®¹å™¨"><a href="#å‡†å¤‡è¿è¡Œ-mysql-å®¹å™¨" class="headerlink" title="å‡†å¤‡è¿è¡Œ mysql å®¹å™¨"></a>å‡†å¤‡è¿è¡Œ mysql å®¹å™¨</h2><h3 id="1-åˆ›å»ºæŒ‚è½½æ–‡ä»¶å¤¹"><a href="#1-åˆ›å»ºæŒ‚è½½æ–‡ä»¶å¤¹" class="headerlink" title="1.åˆ›å»ºæŒ‚è½½æ–‡ä»¶å¤¹"></a>1.åˆ›å»ºæŒ‚è½½æ–‡ä»¶å¤¹</h3><p>ä¸ºäº†é¿å…æ•°æ®åœ¨ç§»é™¤å®¹å™¨çš„æ—¶å€™ä¸¢å¤±ï¼ŒæŠŠ MySQL å®¹å™¨é‡Œçš„ç›®å½•æŒ‚è½½åœ¨æœåŠ¡å™¨çš„ç›®å½•ä¸Š</p><p>å¦‚æœä¸æ˜¯ root è¿è¡Œ docker å‘½ä»¤ï¼Œè¦å…ˆåˆ›å»ºç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /usr/local/mysql/data<br><span class="hljs-built_in">mkdir</span> -p /usr/local/mysql/mysql-files<br><span class="hljs-built_in">mkdir</span> -p /usr/local/mysql/conf<br><span class="hljs-built_in">mkdir</span> -p /usr/local/mysql/logs<br></code></pre></td></tr></table></figure><h3 id="2-ç¼–å†™-my-cnf-æ–‡ä»¶"><a href="#2-ç¼–å†™-my-cnf-æ–‡ä»¶" class="headerlink" title="2.ç¼–å†™ my.cnf æ–‡ä»¶"></a>2.ç¼–å†™ my.cnf æ–‡ä»¶</h3><p>åœ¨ç›®å½•<code>/usr/local/docker/mysql/conf</code>é‡Œæ–°å»ºæ–‡ä»¶:<code>my.cnf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /usr/local/mysql/conf/my.cnf<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#Apply this config only on the master.</span><br>[client]<br>port = 3306<br>default-character-set = utf8mb4<br><br>[mysql]<br>port = 3306<br>default-character-set = utf8mb4<br><br>[mysqld]<br><span class="hljs-comment"># bind-address = 0.0.0.0</span><br><span class="hljs-comment"># port = 3306</span><br>lower_case_table_names=1<br><br>max_connections=10000<br><br>character-set-server = utf8mb4<br>collation-server = utf8mb4_unicode_ci<br><br><span class="hljs-comment"># è®¾ç½®æ—¶åŒºå’Œå­—ç¬¦é›†</span><br><span class="hljs-comment"># default-time-zone=&#x27;+8:00&#x27;</span><br>character-set-client-handshake=FALSE<br>init_connect=<span class="hljs-string">&#x27;SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci&#x27;</span><br><br>gtid-mode=ON<br>enforce-gtid-consistency = ON<br></code></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨-MySQL-å®¹å™¨"><a href="#3-å¯åŠ¨-MySQL-å®¹å™¨" class="headerlink" title="3.å¯åŠ¨ MySQL å®¹å™¨"></a>3.å¯åŠ¨ MySQL å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  \<br>    --restart=always \<br>    --name mysql-test \<br>    -v /usr/local/mysql/conf:/etc/mysql \<br>    -v /usr/local/mysql/data:/var/lib/mysql \<br>    -v /usr/local/mysql/logs:/var/log \<br>    -v /usr/local/mysql/mysql-files:/var/lib/mysql-files \<br>    -p 3306:3306 \<br>    -e MYSQL_ROOT_PASSWORD=root \<br>    -d mysql:5.7.14<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">å‚æ•°è¯´æ˜:<br>â€“restart=always <span class="hljs-comment"># å®¹å™¨åœ¨dockerå¯åŠ¨çš„æ—¶å€™,mysqlå®¹å™¨ä¹Ÿä¼šè·Ÿç€å¯åŠ¨</span><br><br>â€“name mysql-test <span class="hljs-comment"># ç»™å®¹å™¨å–åˆ«å</span><br><br>-v /usr/local/mysql/data:/var/lib/mysql <span class="hljs-comment"># æŒ‚è½½ç›®å½•,å°±æ˜¯æŠŠå®¹å™¨çš„ç›®å½•æŒ‚è½½åˆ°å¤–é¢</span><br><br>-p 3306:3306 <span class="hljs-comment"># æ˜ å°„å®¹å™¨æœåŠ¡çš„ 3306 ç«¯å£åˆ°å®¿ä¸»æœºçš„ 3306 ç«¯å£,å¤–éƒ¨ä¸»æœºå¯ä»¥ç›´æ¥é€šè¿‡ å®¿ä¸»æœºip: 3306 è®¿é—®åˆ° MySQL çš„æœåŠ¡</span><br><br>-e MYSQL_ROOT_PASSWORD=root <span class="hljs-comment"># è®¾ç½® MySQL æœåŠ¡ root ç”¨æˆ·çš„å¯†ç </span><br><br>-d <span class="hljs-comment"># åå°è¿è¡Œ  åŒæ—¶æŒ‡å®šé•œåƒçš„ç‰ˆæœ¬</span><br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹-MySQL-å®¹å™¨"><a href="#æŸ¥çœ‹-MySQL-å®¹å™¨" class="headerlink" title="æŸ¥çœ‹ MySQL å®¹å™¨"></a>æŸ¥çœ‹ MySQL å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps  <span class="hljs-comment"># æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br>docker ps -a <span class="hljs-comment"># æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨åŒ…æ‹¬æœªè¿è¡Œçš„</span><br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®MySQLå®¹å™¨å¼€æœºè‡ªå¯"><a href="#è®¾ç½®MySQLå®¹å™¨å¼€æœºè‡ªå¯" class="headerlink" title="è®¾ç½®MySQLå®¹å™¨å¼€æœºè‡ªå¯"></a>è®¾ç½®MySQLå®¹å™¨å¼€æœºè‡ªå¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker update mysql-test --restart=always  <br><br>or<br><br>docker update --restart=always edd6c56c7291 <span class="hljs-comment"># (æœ€åä¸€é¡¹ä¸ºMySQLå®¹å™¨çš„CONTAINER ID)</span><br></code></pre></td></tr></table></figure><p>è®¾ç½® Docker è‡ªå¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start docker<br><br>systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure><h1 id="å®‰è£…Redis"><a href="#å®‰è£…Redis" class="headerlink" title="å®‰è£…Redis"></a>å®‰è£…Redis</h1><h2 id="æŸ¥çœ‹å¯ç”¨-Redis-ç‰ˆæœ¬"><a href="#æŸ¥çœ‹å¯ç”¨-Redis-ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹å¯ç”¨ Redis ç‰ˆæœ¬"></a>æŸ¥çœ‹å¯ç”¨ Redis ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker search redis<br></code></pre></td></tr></table></figure><h2 id="æ‹‰å–å®˜é•œåƒ"><a href="#æ‹‰å–å®˜é•œåƒ" class="headerlink" title="æ‹‰å–å®˜é•œåƒ"></a>æ‹‰å–å®˜é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull redis<br><br><span class="hljs-comment"># å¯ä»¥æŒ‡å®šç‰ˆæœ¬å·:ä¸åŠ ç‰ˆæœ¬å·é»˜è®¤è·å–æœ€æ–°ç‰ˆæœ¬</span><br>docker pull redis:6.2.7<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æœ¬åœ°é•œåƒ-1"><a href="#æŸ¥çœ‹æœ¬åœ°é•œåƒ-1" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°é•œåƒ"></a>æŸ¥çœ‹æœ¬åœ°é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker images<br></code></pre></td></tr></table></figure><h2 id="å‡†å¤‡-redis-çš„é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡-redis-çš„é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡ redis çš„é…ç½®æ–‡ä»¶"></a>å‡†å¤‡ redis çš„é…ç½®æ–‡ä»¶</h2><p>redisä¸­æ–‡å®˜æ–¹ç½‘ç«™:<a href="http://www.redis.cn/download.html">http://www.redis.cn/download.html</a></p><p>ä¸‹è½½ä¸‹æ¥åè§£å‹ï¼Œæ‰¾åˆ° <code>redis.conf</code> æ–‡ä»¶</p><h2 id="é…ç½®-redis-conf-é…ç½®æ–‡ä»¶"><a href="#é…ç½®-redis-conf-é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½® redis.conf é…ç½®æ–‡ä»¶"></a>é…ç½® redis.conf é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">bind</span> 127.0.0.1 <span class="hljs-comment">#æ³¨é‡Šæ‰è¿™éƒ¨åˆ†ï¼Œä½¿rediså¯ä»¥å¤–éƒ¨è®¿é—®</span><br>protected-mode no  <span class="hljs-comment">#ä¿®æ”¹ä¿æŠ¤æ¨¡å¼ä¸ºno</span><br>daemonize no<span class="hljs-comment">#ç”¨å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨</span><br>requirepass <span class="hljs-comment">#ç»™redisè®¾ç½®å¯†ç ï¼Œé»˜è®¤æ²¡æœ‰å¯†ç </span><br>appendonly <span class="hljs-built_in">yes</span><span class="hljs-comment">#redisæŒä¹…åŒ–ã€€ã€€é»˜è®¤æ˜¯no</span><br>tcp-keepalive 300 <span class="hljs-comment">#é˜²æ­¢å‡ºç°è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥çš„é”™è¯¯ é»˜è®¤æ˜¯300</span><br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºæœ¬åœ°å­˜æ”¾redisçš„ä½ç½®"><a href="#åˆ›å»ºæœ¬åœ°å­˜æ”¾redisçš„ä½ç½®" class="headerlink" title="åˆ›å»ºæœ¬åœ°å­˜æ”¾redisçš„ä½ç½®"></a>åˆ›å»ºæœ¬åœ°å­˜æ”¾redisçš„ä½ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åˆ›å»ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> /usr/local/redis<br><span class="hljs-built_in">mkdir</span> /usr/local/redis/conf<br></code></pre></td></tr></table></figure><p>ç„¶åæŠŠå‰é¢ä¿®æ”¹çš„ redis.conf é…ç½®æ–‡ä»¶æ‹·è´åˆ°åˆšæ‰åˆ›å»ºå¥½çš„ <code>/redis/conf</code> æ–‡ä»¶å¤¹ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ ftp æ‹·è´è¿‡å»ï¼Œæˆ–è€…ç›´æ¥å¤åˆ¶å†…å®¹ï¼Œç„¶åç²˜è´´è¿‡å»</p><h2 id="å¯åŠ¨-Docker-å®¹å™¨"><a href="#å¯åŠ¨-Docker-å®¹å™¨" class="headerlink" title="å¯åŠ¨ Docker å®¹å™¨"></a>å¯åŠ¨ Docker å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run \<br>-p 6379:6379 \<br>--name redis-test \<br>-v /usr/local/redis/conf/redis.conf:/etc/redis/redis.conf \<br>-v /usr/local/redis/data:/data \<br>-d redis:6.2.7 redis-server /etc/redis/redis.conf \<br>--appendonly <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">å‚æ•°è§£é‡Š:<br>-p 6379:6379: <span class="hljs-comment"># æŠŠå®¹å™¨å†…çš„6379ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº6379ç«¯å£</span><br>â€“name redis : <span class="hljs-comment"># æŒ‡å®šè¯¥å®¹å™¨åç§°ï¼ŒæŸ¥çœ‹å’Œè¿›è¡Œæ“ä½œéƒ½æ¯”è¾ƒæ–¹ä¾¿</span><br>-v /usr/local/redis/conf/redis.conf:/etc/redis/redis.conf: <span class="hljs-comment"># æŠŠå®¿ä¸»æœºé…ç½®å¥½çš„redis.confæ”¾åˆ°å®¹å™¨å†…çš„è¿™ä¸ªä½ç½®ä¸­</span><br>-v /usr/local/redis/data:/data:  <span class="hljs-comment"># æŠŠredisæŒä¹…åŒ–çš„æ•°æ®åœ¨å®¿ä¸»æœºå†…æ˜¾ç¤ºï¼Œåšæ•°æ®å¤‡ä»½</span><br>redis-server /etc/redis/redis.conf:  <span class="hljs-comment"># è¿™ä¸ªæ˜¯å…³é”®é…ç½®ï¼Œè®©redisä¸æ˜¯æ— é…ç½®å¯åŠ¨ï¼Œè€Œæ˜¯æŒ‰ç…§è¿™ä¸ªredis.confçš„é…ç½®å¯åŠ¨</span><br>â€“appendonly <span class="hljs-built_in">yes</span>: <span class="hljs-comment"># rediså¯åŠ¨åæ•°æ®æŒä¹…åŒ–</span><br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ"><a href="#æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ" class="headerlink" title="æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ"></a>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®Rediså®¹å™¨è‡ªåŠ¨å¯åŠ¨"><a href="#è®¾ç½®Rediså®¹å™¨è‡ªåŠ¨å¯åŠ¨" class="headerlink" title="è®¾ç½®Rediså®¹å™¨è‡ªåŠ¨å¯åŠ¨"></a>è®¾ç½®Rediså®¹å™¨è‡ªåŠ¨å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker update redis --restart=always<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>Mysql</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>synchronized</title>
    <link href="/2022/07/16/2022-7-13-synchronized/"/>
    <url>/2022/07/16/2022-7-13-synchronized/</url>
    
    <content type="html"><![CDATA[<h1 id="Synchrozined"><a href="#Synchrozined" class="headerlink" title="Synchrozined"></a>Synchrozined</h1><h2 id="Javaå¯¹è±¡ç»“æ„"><a href="#Javaå¯¹è±¡ç»“æ„" class="headerlink" title="Javaå¯¹è±¡ç»“æ„"></a>Javaå¯¹è±¡ç»“æ„</h2><blockquote><p><strong>HotSpotè™šæ‹Ÿæœº</strong></p></blockquote><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207140920390.png" alt="å›¾ 15-1 64ä½JVMå¯¹è±¡ç»“æ„æè¿°"></p><p>åœ¨ HotSpotè™šæ‹Ÿæœºæ±‡æ€»ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å¸ƒå±€å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¡«å……æ•°æ®</p><ul><li>mark-wordï¼šå¯¹è±¡æ ‡è®°å­—æ®µï¼Œå æ®å››ä¸ªå­—èŠ‚ï¼Œç”¨äºå­˜å‚¨ä¸€äº›åˆ—çš„æ ‡è¯†ä½ï¼Œæ¯”å¦‚ï¼šå“ˆå¸Œå€¼ã€è½»é‡çº§é”çš„æ ‡è®°ä½ã€åå‘é”æ ‡è®°ä½ã€åˆ†ä»£å¹´é¾„</li><li>Klass Pointerï¼šClasså¯¹è±¡çš„ç±»å‹æŒ‡é’ˆï¼Œjdk1.8é»˜è®¤å¼€å¯æŒ‡é’ˆå‹ç¼©åä¸º4å­—èŠ‚ï¼Œå…³é—­æŒ‡é’ˆå‹ç¼©åï¼Œé•¿åº¦ä¸º8å­—èŠ‚ã€‚å®ƒæŒ‡å‘çš„ä½ç½®æ˜¯å¯¹è±¡å¯¹åº”çš„Classå¯¹è±¡å¾—åˆ°å†…å­˜åœ°å€</li><li>å¯¹è±¡å®é™…æ•°æ®ï¼šåŒ…æ‹¬å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œå¤§å°ç”±å„ä¸ªæˆå‘˜å˜é‡å†³å®šï¼Œæ¯”å¦‚ï¼šbyteå ä¸€å­—èŠ‚ï¼Œintå 4å­—èŠ‚</li><li>å¯¹é½ï¼šæœ€åè¿™æ®µç©ºé—´è¡¥å…¨å¹¶éå¿…é¡»ï¼Œä»…ä»…ä¸ºäº†èµ·åˆ°å ä½ç¬¦çš„ä½œç”¨ã€‚ç”±äºHotSpotè™šæ‹Ÿæœºçš„å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰€ä»¥å¯¹è±¡å¤´æ­£å¥½æ˜¯8å­—èŠ‚çš„å€æ•°ã€‚å› æ­¤å½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨</li></ul><p>åœ¨ <code>mark-word</code> é”ç±»å‹æ ‡è®°ä¸­ï¼Œæ— é”ï¼Œåå‘é”ï¼Œè½»é‡é”ï¼Œé‡é‡é”ï¼Œä»¥åŠGCæ ‡è®°ï¼Œ5ç§ç±»ä¸­æ²¡æ³•ç”¨2æ¯”ç‰¹æ ‡è®°ï¼ˆ2æ¯”ç‰¹æœ€ç»ˆæœ‰4ç§ç»„åˆ<code>00</code>ã€<code>01</code>ã€<code>10</code>ã€<code>11</code>ï¼‰ï¼Œæ‰€ä»¥æ— é”ã€åå‘é”ï¼Œå‰åˆå äº†ä¸€ä½åå‘é”æ ‡è®°</p><h2 id="Synchronizedrç‰¹æ€§"><a href="#Synchronizedrç‰¹æ€§" class="headerlink" title="Synchronizedrç‰¹æ€§"></a>Synchronizedrç‰¹æ€§</h2><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i1 &lt; <span class="hljs-number">10000</span>; i1++) &#123;<br>                add();<br>            &#125;<br>        &#125;);<br>        thread.start();<br>    &#125;<br>    <span class="hljs-comment">// ç­‰10ä¸ªçº¿ç¨‹è¿è¡Œå®Œæ¯•</span><br>    Thread.sleep(<span class="hljs-number">1000</span>);<br>    System.out.println(counter);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> (AtomicityTest.class) &#123;<br>        counter++;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æœ‰ synchronized æ—¶ï¼Œæµ‹è¯•ç»“æœå¯ä»¥æˆåŠŸè¾“å‡º 10000</p><p>synchroized å¯ä»¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‹¿åˆ°é”ï¼Œè¿›å…¥ä»£ç æ‰§è¡Œ</p><h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">sign</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">Thread01</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (!sign) &#123;<br>            i++;<br>            add(i);<br>        &#125;<br>    &#125;);<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">Thread02</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">3000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException ignore) &#123;<br>        &#125;<br>        sign = <span class="hljs-literal">true</span>;<br>        logger.info(<span class="hljs-string">&quot;vt.sign = true  while (!sign)&quot;</span>)<br>    &#125;);<br>    Thread01.start();<br>    Thread02.start();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span>  <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>    <span class="hljs-keyword">return</span> i + <span class="hljs-number">1</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¹Ÿæ˜¯å¯ä»¥åœ¨ç¡çœ ä¸‰ç§’åé€€å‡ºï¼Œè¿™ä¹Ÿå°±è¯´äº† synchronized å…·æœ‰å¯è§æ€§</p><p><strong>Why</strong></p><ol><li>çº¿ç¨‹è§£é”å‰ï¼Œå¿…é¡»æŠŠå…±äº«å˜é‡çš„æœ€æ–°å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚</li><li>çº¿ç¨‹åŠ é”å‰ï¼Œå°†æ¸…ç©ºå·¥ä½œå†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ï¼Œä»è€Œä½¿ç”¨å…±äº«å˜é‡æ—¶éœ€è¦ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–æœ€æ–°çš„å€¼ã€‚</li><li>volatile çš„å¯è§æ€§éƒ½æ˜¯é€šè¿‡å†…å­˜å±éšœï¼ˆMemnory Barrierï¼‰æ¥å®ç°çš„ã€‚</li><li>synchronized é æ“ä½œç³»ç»Ÿå†…æ ¸äº’æ–¥é”å®ç°ï¼Œç›¸å½“äº JMM ä¸­çš„ lockã€unlockã€‚é€€å‡ºä»£ç å—æ—¶åˆ·æ–°å˜é‡åˆ°ä¸»å†…å­˜</li></ol><h3 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h3><p><code>as-if-serial</code>ï¼Œä¿è¯ä¸ç®¡ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ä¼šå¦‚ä½•è¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼Œéƒ½éœ€è¦ä¿è¯å•çº¿ç¨‹ä¸‹çš„è¿è¡Œç»“æœçš„æ­£ç¡®æ€§ã€‚ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ï¼š<strong>å¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚</strong></p><p>åŒé‡æ£€éªŒé”ï¼ˆDouble-checked Lockingï¼‰çš„æ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> Singleton instance;<br><br>    <span class="hljs-keyword">public</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿä¸Šé¢ä»£ç å¯ä»¥å‘ç°ï¼Œåœ¨ä½¿ç”¨ synchronized çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº† volatile å…³é”®å­—</p><p>è¿™æ˜¯å› ä¸ºï¼Œsynchronized çš„æœ‰åºæ€§ï¼Œä¸æ˜¯ volatile çš„<strong>é˜²æŒ‡ä»¤é‡æ’åº</strong></p><p>é‚£å¦‚æœä¸åŠ  volatile å…³é”®å­—å¯èƒ½å¯¼è‡´çš„ç»“æœï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨åˆå§‹åŒ–åˆå§‹åŒ–å¯¹è±¡ï¼Œè®¾ç½® instance æŒ‡å‘å†…å­˜åœ°å€æ—¶ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œæœ‰æŒ‡ä»¤é‡æ’ã€‚åœ¨åˆ¤æ–­ if (instance &#x3D;&#x3D; null) æ—¶å°±ä¼šæœ‰å‡ºé”™çš„å¯èƒ½ï¼Œå› ä¸ºè¿™ä¼šå¯èƒ½ instance å¯èƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–æˆåŠŸ</p><h3 id="å¯é‡å…¥æ€§"><a href="#å¯é‡å…¥æ€§" class="headerlink" title="å¯é‡å…¥æ€§"></a>å¯é‡å…¥æ€§</h3><p>synchronized æ˜¯å¯é‡å…¥é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…è®¸ä¸€ä¸ªçº¿ç¨‹äºŒæ¬¡è¯·æ±‚è‡ªå·±æŒæœ‰å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºï¼Œè¿™ç§æƒ…å†µç§°ä¸ºå¯é‡å…¥é”ğŸ”’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentryTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ReentryTest</span> <span class="hljs-variable">reentry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentryTest</span>();<br>        reentry.doA();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doA</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å­ç±»æ–¹æ³•ï¼šReentryTest.doA() ThreadIdï¼š&quot;</span> + Thread.currentThread().getId());<br>        doB();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doB</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.doA();<br>        System.out.println(<span class="hljs-string">&quot;å­ç±»æ–¹æ³•ï¼šReentryTest.doB() ThreadIdï¼š&quot;</span> + Thread.currentThread().getId());<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doA</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;çˆ¶ç±»æ–¹æ³•ï¼šA.doA() ThreadIdï¼š&quot;</span> + Thread.currentThread().getId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç»“æœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">å­ç±»æ–¹æ³•ï¼šReentryTest.doA() ThreadIdï¼š<span class="hljs-number">1</span><br>çˆ¶ç±»æ–¹æ³•ï¼šA.doA() ThreadIdï¼š<span class="hljs-number">1</span><br>å­ç±»æ–¹æ³•ï¼šReentryTest.doB() ThreadIdï¼š<span class="hljs-number">1</span><br><br>Process finished with exit code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™æ®µå•ä¾‹ä»£ç æ˜¯é€’å½’è°ƒç”¨å«æœ‰ synchronized é”çš„æ–¹æ³•ï¼Œä»è¿è¡Œæ­£å¸¸çš„æµ‹è¯•ç»“æœçœ‹ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿæ­»é”ã€‚æ‰€æœ‰å¯ä»¥è¯æ˜ synchronized æ˜¯å¯é‡å…¥é”ã€‚</p><p>synchronized é”å¯¹è±¡çš„æ—¶å€™æœ‰ä¸ªè®¡æ•°å™¨ï¼Œä»–ä¼šè®°å½•ä¸‹çº¿ç¨‹è·å–é”çš„æ¬¡æ•°ï¼Œåœ¨æ‰§è¡Œå®Œå¯¹åº”çš„ä»£ç å—ä¹‹åï¼Œè®¡æ•°å™¨å°±ä¼š-1ï¼Œç›´åˆ°è®¡æ•°å™¨æ¸…é›¶ï¼Œå°±é‡Šæ”¾é”äº†ã€‚</p><p>ä¹‹æ‰€ä»¥ï¼Œæ˜¯å¯ä»¥é‡å…¥ã€‚æ˜¯å› ä¸º synchronized é”å¯¹è±¡æœ‰ä¸ªè®¡æ•°å™¨ï¼Œä¼šéšç€çº¿ç¨‹è·å–é”å +1 è®¡æ•°ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å -1ï¼Œç›´åˆ°æ¸…é›¶é‡Šæ”¾é”</p><h2 id="é”å‡çº§è¿‡ç¨‹"><a href="#é”å‡çº§è¿‡ç¨‹" class="headerlink" title="é”å‡çº§è¿‡ç¨‹"></a>é”å‡çº§è¿‡ç¨‹</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207140941334.png" alt="å›¾ 15-7 synchronized é”å‡çº§è¿‡ç¨‹"></p><p>synchronized é”æœ‰å››ç§äº¤æ›¿å‡çº§çš„çŠ¶æ€ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§ï¼Œè¿™å‡ ä¸ªçŠ¶æ€éšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§</p><h3 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h3><p>åæ–œé”ä¼šå»¶ç¼“ JIT é¢„çƒ­è¿›ç¨‹ï¼Œæ‰€ä»¥å¾ˆå¤šæ€§èƒ½æµ‹è¯•ä¸­ä¼šæ˜¾å¼åœ°å…³é—­åæ–œé”ï¼Œåæ–œé”å¹¶ä¸é€‚åˆæ‰€æœ‰åº”ç”¨åœºæ™¯ï¼Œæ’¤é”€æ“ä½œï¼ˆrevokeï¼‰æ˜¯æ¯”è¾ƒé‡çš„è¡Œä¸ºï¼Œåªæœ‰å½“å­˜åœ¨è¾ƒå¤šä¸ä¼šçœŸæ­£ç«äº‰çš„ synchronized å—å„¿æ—¶ï¼Œæ‰èƒ½ä½“ç°å‡ºæ˜æ˜¾æ”¹å–„</p><h3 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h3><p>å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚</p><p>åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼ŒJVMè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œå®˜æ–¹ç§°ä¹‹ä¸º Displaced Mark Word</p><h3 id="è‡ªé€‰é”"><a href="#è‡ªé€‰é”" class="headerlink" title="è‡ªé€‰é”"></a>è‡ªé€‰é”</h3><p>è‡ªæ—‹é”æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUã€‚</p><p>è‡ªæ—‹é”çš„é»˜è®¤å¤§å°æ˜¯10æ¬¡ï¼Œå¯ä»¥è°ƒæ•´ï¼š<code>-XXï¼šPreBlockSpin</code></p><p>å¦‚æœè‡ªæ—‹næ¬¡å¤±è´¥äº†ï¼Œå°±ä¼šå‡çº§ä¸ºé‡é‡çº§çš„é”</p><h3 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h3>]]></content>
    
    
    <categories>
      
      <category>Javaé”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>synchronized</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>volatileå…³é”®å­—</title>
    <link href="/2022/07/13/2022-7-13-volatile/"/>
    <url>/2022/07/13/2022-7-13-volatile/</url>
    
    <content type="html"><![CDATA[<h1 id="volatileå…³é”®å­—"><a href="#volatileå…³é”®å­—" class="headerlink" title="volatileå…³é”®å­—"></a>volatileå…³é”®å­—</h1><ul><li>ä¿è¯å¯è§æ€§</li><li>é˜²æ­¢æŒ‡ä»¤é‡æ’</li><li>ä¸ä¿è¯åŸå­æ€§</li></ul><hr><ul><li>volatile å…³é”®å­—ä¼šæ§åˆ¶è¢«ä¿®é¥°çš„å˜é‡åœ¨å†…å­˜æ“ä½œä¸Šä¸»åŠ¨æŠŠå€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼ŒJVM ä¼šæŠŠè¯¥çº¿ç¨‹åº¦å¯¹åº”çš„ CPU å†…å­˜è®¾ç½®è¿‡æœŸï¼Œä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å€¼</li><li>volatile å¦‚ä½•é˜²æ­¢æŒ‡ä»¤é‡æ’ä¹Ÿæ˜¯å†…å­˜å±éšœï¼Œvolatile çš„å†…å­˜å±éšœæ˜¯åœ¨é•€é”¡æ“ä½œçš„å‰åå„æ·»åŠ ä¸€ä¸ª StroreStore å±éšœï¼Œä¹Ÿå°±æ˜¯å››ä¸ªä½ç½®ï¼Œæ¥ä¿è¯æ’åºæ—¶ä¸èƒ½æŠŠå†…å­˜å±éšœåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®</li><li>volatile å…³é”®å­—å¹¶ä¸èƒ½è§£å†³<code>åŸå­æ€§</code>ï¼Œå¦‚æœéœ€è¦è§£å†³åŸå­æ€§é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨ synchronzied æˆ–è€… lock</li></ul><h1 id="å¯è§æ€§æ¡ˆä¾‹"><a href="#å¯è§æ€§æ¡ˆä¾‹" class="headerlink" title="å¯è§æ€§æ¡ˆä¾‹"></a>å¯è§æ€§æ¡ˆä¾‹</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">VT</span> <span class="hljs-variable">vt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VT</span>();<br><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">Thread01</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(vt);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">Thread02</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">3000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException ignore) &#123;<br>                &#125;<br>                vt.sign = <span class="hljs-literal">true</span>;<br>                System.out.println(<span class="hljs-string">&quot;vt.sign = true é€šçŸ¥ while (!sign) ç»“æŸï¼&quot;</span>);<br>            &#125;<br>        &#125;);<br><br>        Thread01.start();<br>        Thread02.start();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VT</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">sign</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (!sign) &#123;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;hello&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è¿™æ®µä»£ç </strong>ï¼Œæ˜¯ä¸¤ä¸ªçº¿ç¨‹æ“ä½œä¸€ä¸ªå˜é‡ï¼Œç¨‹åºæƒ³è¦çš„æ˜¯å½“ sign åœ¨çº¿ç¨‹ Thread01 è¢«æ“ä½œ vt.sign &#x3D; true æ—¶ï¼ŒThread02 è¾“å‡º hello</p><p>ä½†æ˜¯å®é™…ä¸Šè¿™æ®µä»£ç å¹¶ä¸ä¼šè¾“å‡º hello ï¼Œè€Œæ˜¯ä¼šä¸€ç›´å¤„äºæ­»å¾ªç¯</p><h1 id="åŠ ä¸Švolatieå…³é”®å­—"><a href="#åŠ ä¸Švolatieå…³é”®å­—" class="headerlink" title="åŠ ä¸Švolatieå…³é”®å­—"></a>åŠ ä¸Švolatieå…³é”®å­—</h1><p>æˆ‘ä»¬ç»™ sign å…³é”®å­—åŠ ä¸Š volatie å…³é”®å­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VT</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">sign</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (!sign) &#123;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;ä½ å&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ ä¸Šä¹‹å volatile å…³é”®å­—æ˜¯ Java è™šæ‹Ÿæœºæä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œä»–æœ€ä¸ºä¸€ä¸ªä¿®é¥°ç¬¦å‡ºç°ï¼Œç”¨æ¥ä¿®é¥°å˜é‡ï¼Œä½†æ˜¯æ•´ç†ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡</p><p>åœ¨æ·»åŠ  volatile å…³é”®å­—åï¼Œç¨‹åºå°±ç¬¦åˆä¸å…¶çš„è¾“å‡ºäº† hello ã€‚ä»æˆ‘ä»¬å¯¹ volatile çš„å­¦ä¹ è®¤çŸ¥å¯ä»¥çŸ¥é“ã€‚volatile å…³é”®å­—æ˜¯ JVM æä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œç”¨æ¥ä¿®é¥°å˜é‡ï¼Œç”¨æ¥<strong>ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§</strong></p><p>æ­£åœ¨ä¿®é¥°åå¯ä»¥è®©å­—æ®µåœ¨çº¿ç¨‹è§è¯¾ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§è¢«ä¿®æ”¹å€¼åï¼Œå¯ä»¥åŠæ—¶çš„åœ¨å¦å¤–çš„çº¿ç¨‹ä¸­åšå‡ºç›¸åº”çš„ååº”</p><h1 id="âœ¨volatieæ€ä¹ˆä¿è¯çš„å¯è§æ€§"><a href="#âœ¨volatieæ€ä¹ˆä¿è¯çš„å¯è§æ€§" class="headerlink" title="âœ¨volatieæ€ä¹ˆä¿è¯çš„å¯è§æ€§"></a>âœ¨volatieæ€ä¹ˆä¿è¯çš„å¯è§æ€§</h1><p>æœ‰ volatie æ—¶çš„å†…å­˜å˜åŒ–</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207131407413.png" alt="image-20220713140704279"></p><p>å½“æˆ‘ä»¬æŠŠå˜é‡ä½¿ç”¨ volatile ä¿®é¥°æ—¶ï¼Œå½“çº¿ç¨‹01å¯¹å˜é‡è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šæŠŠå˜é‡å˜åŒ–çš„å€¼å¼ºåˆ¶åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œå½“çº¿ç¨‹02è·å–å€¼æ—¶ï¼Œä¼šæŠŠè‡ªå·±çš„å†…å­˜é‡Œçš„ sign å€¼è¿‡æœŸæ‰ï¼Œä¹‹åä»ä¸»å†…å­˜ä¸­è¯»å–ï¼Œæ‰€ä»¥æ·»åŠ å…³é”®å­—åç¨‹åºå¦‚é¢„æœŸè¾“å‡ºç»“æœ</p><h1 id="åç¼–è¯‘è§£è¯»å¯è§æ€§"><a href="#åç¼–è¯‘è§£è¯»å¯è§æ€§" class="headerlink" title="åç¼–è¯‘è§£è¯»å¯è§æ€§"></a>åç¼–è¯‘è§£è¯»å¯è§æ€§</h1><p>ç¼–è¯‘åçš„æ±‡ç¼–æŒ‡ä»¤ä¸­ï¼Œæœ‰ volatile å…³é”®å­—å’Œæ²¡æœ‰ volatile å…³é”®å­—ï¼Œä¸»è¦å·®åˆ«åœ¨äºå¤šäº†ä¸€ä¸ª lock addl $0x0,(%rsp)ï¼Œä¹Ÿå°±æ˜¯ lock çš„å‰ç¼€æŒ‡ä»¤ã€‚<br>lock æŒ‡ä»¤ç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼Œå®ƒä¿è¯å¦‚ä¸‹ä¸‰ç‚¹ï¼š</p><ol><li>å°†æœ¬å¤„ç†å™¨çš„ç¼“å­˜å†™å…¥å†…å­˜ã€‚</li><li>é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ã€‚</li><li>å¦‚æœæ˜¯å†™å…¥åŠ¨ä½œä¼šå¯¼è‡´å…¶ä»–å¤„ç†å™¨ä¸­å¯¹åº”çš„å†…å­˜æ— æ•ˆã€‚</li></ol><p>é‚£ä¹ˆï¼Œè¿™é‡Œçš„ 1ã€3 å°±æ˜¯ç”¨æ¥ä¿è¯è¢«ä¿®é¥°çš„å˜é‡ï¼Œä¿è¯å†…å­˜å¯è§æ€§ã€‚</p><p><strong>âœ¨æ€»ç»“</strong></p><ul><li>volatile å…³é”®å­—ä¼šæ§åˆ¶è¢«ä¿®é¥°çš„å˜é‡åœ¨å†…å­˜æ“ä½œä¸Šä¸»åŠ¨æŠŠå€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼ŒJVM ä¼šæŠŠè¯¥çº¿ç¨‹åº¦å¯¹åº”çš„ CPU å†…å­˜è®¾ç½®è¿‡æœŸï¼Œä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å€¼</li><li>volatile å¦‚ä½•é˜²æ­¢æŒ‡ä»¤é‡æ’ä¹Ÿæ˜¯å†…å­˜å±éšœï¼Œvolatile çš„å†…å­˜å±éšœæ˜¯åœ¨é•€é”¡æ“ä½œçš„å‰åå„æ·»åŠ ä¸€ä¸ª StroreStore å±éšœï¼Œä¹Ÿå°±æ˜¯å››ä¸ªä½ç½®ï¼Œæ¥ä¿è¯æ’åºæ—¶ä¸èƒ½æŠŠå†…å­˜å±éšœåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®</li><li>volatile å…³é”®å­—å¹¶ä¸èƒ½è§£å†³<code>åŸå­æ€§</code>ï¼Œå¦‚æœéœ€è¦è§£å†³åŸå­æ€§é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨ synchronzied æˆ–è€… lock</li></ul><h1 id="ä¸åŠ volatileä¹Ÿå¯è§"><a href="#ä¸åŠ volatileä¹Ÿå¯è§" class="headerlink" title="ä¸åŠ volatileä¹Ÿå¯è§"></a>ä¸åŠ volatileä¹Ÿå¯è§</h1><p>è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VT</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">sign</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (!sign) &#123;<br>            System.out.println(<span class="hljs-string">&quot;ä½ å¥½&quot;</span>);<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;ä½ å&quot;</span>);<br>    &#125;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹åå»æ‰äº† <code>volatile</code> å…³é”®å­—ï¼Œå¹¶åœ¨whileå¾ªç¯ä¸­æ·»åŠ ä¸€æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">...<br>ä½ å¥½<br>ä½ å¥½<br>ä½ å¥½<br>vt.sign = <span class="hljs-literal">true</span> é€šçŸ¥ <span class="hljs-keyword">while</span> (!sign) ç»“æŸï¼<br>ä½ å<br><br>Process finished with exit code <span class="hljs-number">0</span>   <span class="hljs-number">55555</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™è¾“å‡ºåˆå˜å¾—æ­£å¸¸äº†ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹å¯è§äº†</p><p>å› ä¸º print æ–¹æ³•åŠ äº† synchronized å…³é”®å­—ï¼ˆå½“ç„¶ println ä¹ŸåŠ äº†ï¼Œæ¢è¡Œæ“ä½œä¹Ÿä¼šæŒæœ‰é”ï¼‰</p><p>è€Œ synchronized æ–¹æ³•ä¹Ÿæ˜¯èƒ½ä¿è¯äº†è¯¥åŒæ­¥å—ä¸­çš„å˜é‡çš„å¯è§æ€§çš„ï¼Œæ‰€ä»¥ä¸‹æ¬¡ signä»ä¸»å­˜ä¸­è¯»å‡º true å°±è·³å‡ºäº† while </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">println</span><span class="hljs-params">(String x)</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        print(x);<br>        newLine();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>sychronizedå¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Javaé”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>volatile</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TreadLoaclæºç åˆ†æ</title>
    <link href="/2022/07/10/2022-7-10-ThreadLocal%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <url>/2022/07/10/2022-7-10-ThreadLocal%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="TreadLoaclæºç åˆ†æ"><a href="#TreadLoaclæºç åˆ†æ" class="headerlink" title="TreadLoaclæºç åˆ†æ"></a>TreadLoaclæºç åˆ†æ</h1><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><h2 id="SimpleDateFormat"><a href="#SimpleDateFormat" class="headerlink" title="SimpleDateFormat"></a>SimpleDateFormat</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seckillSku</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">dateStr</span> <span class="hljs-operator">=</span> f.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>    <span class="hljs-comment">// ä¸šåŠ¡æµç¨‹</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ ·å†™å…¶å®æ˜¯ä¸å¯¹çš„ï¼Œå› ä¸º<code>SimpleDateFormat</code>ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œä¹Ÿå°±ä¼šå¯¼è‡´æˆ‘ä»¬æœ€åæ ¼å¼åŒ–å‡ºæ¥çš„æ•°æ®å¹¶ä¸å‡†ç¡®</p><h2 id="é“¾è·¯è¿½è¸ª"><a href="#é“¾è·¯è¿½è¸ª" class="headerlink" title="é“¾è·¯è¿½è¸ª"></a>é“¾è·¯è¿½è¸ª</h2><blockquote><p>è¿™ä¸ªæ²¡æœ‰äº†è§£è¿‡</p></blockquote><h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;<br><br>    <span class="hljs-comment">// We don&#x27;t use a fast path as with get() because it is at</span><br>    <span class="hljs-comment">// least as common to use set() to create new entries as</span><br>    <span class="hljs-comment">// it is to replace existing ones, in which case, a fast</span><br>    <span class="hljs-comment">// path would fail more often than not.</span><br><br>    Entry[] tab = table; <span class="hljs-comment">// æ•°ç»„å­˜æ”¾æ•°æ®</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> key.threadLocalHashCode &amp; (len-<span class="hljs-number">1</span>); <span class="hljs-comment">// Hashå€¼è®¡ç®—ä¸‹æ ‡</span><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[i];<br>         <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»è¿™éƒ¨åˆ†æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>ThreadLocal </code>åº•å±‚é‡‡ç”¨çš„æ˜¯æ•°ç»„ç»“æ„å­˜å‚¨æ•°æ®ï¼ŒåŒæ—¶è¿˜æœ‰å“ˆå¸Œå€¼è®¡ç®—ä¸‹æ ‡ï¼Œè¿™è¯´æ˜å®ƒæ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨çš„æ•°ç»„ç»“æ„</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207101818554.png" alt="image-20220710181846492"></p><ol><li>å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ã€‚</li><li>Entryï¼Œå…¶å®æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨å®ç°ï¼Œ<code>static class Entryextends WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code>ã€‚è¿™è¯´æ˜åªè¦æ²¡ç”¨å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå‘ç”Ÿ GC æ—¶å°±ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</li><li>æ•°æ®å…ƒç´ é‡‡ç”¨å“ˆå¸Œæ•£åˆ—æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œä¸è¿‡è¿™é‡Œçš„æ•£åˆ—ä½¿ç”¨çš„æ˜¯<strong>æ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•£åˆ—æ³•</strong></li><li>å¦å¤–ç”±äºè¿™é‡Œä¸åŒäº HashMap çš„æ•°æ®ç»“æ„ï¼Œå‘ç”Ÿå“ˆå¸Œç¢°æ’ä¸ä¼šå­˜æˆé“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼Œè€Œæ˜¯ä½¿ç”¨æ‹‰é“¾æ³•è¿›è¡Œå­˜å‚¨ã€‚ä¹Ÿå°±æ˜¯åŒä¸€ä¸ªä¸‹æ ‡ä½ç½®å‘ç”Ÿå†²çªæ—¶ï¼Œåˆ™+1 å‘åå¯»å€ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºä½ç½®æˆ–åƒåœ¾å›æ”¶ä½ç½®è¿›è¡Œå­˜å‚¨</li></ol><h1 id="æ•£åˆ—ç®—æ³•"><a href="#æ•£åˆ—ç®—æ³•" class="headerlink" title="æ•£åˆ—ç®—æ³•"></a>æ•£åˆ—ç®—æ³•</h1><p><code>ThreadLocal </code>æ˜¯åŸºäºæ•°ç»„ç»“æ„çš„æ‹‰é“¾æ³•å­˜å‚¨çš„ï¼Œé‚£å°±ä¸€å®šä¼šæœ‰å“ˆå¸Œçš„è®¡ç®—ã€‚ä½†æˆ‘ä»¬ç¿»é˜…æºç åï¼Œå‘ç°è¿™ä¸ªå“ˆå¸Œè®¡ç®—ä¸ HashMap ä¸­çš„æ•£åˆ—æ±‚æ•°ç»„ä¸‹æ ‡è®¡ç®—çš„å“ˆå¸Œæ–¹å¼ä¸ä¸€æ ·</p><h2 id="ç¥ç§˜çš„æ•°å­—0x61c88647"><a href="#ç¥ç§˜çš„æ•°å­—0x61c88647" class="headerlink" title="ç¥ç§˜çš„æ•°å­—0x61c88647"></a>ç¥ç§˜çš„æ•°å­—0x61c88647</h2><blockquote><p>tipï¼šæ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•£åˆ—æ³•æ˜¯æ ¹æ®è¿™ä¸ªæ¥å®Œæˆçš„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">HASH_INCREMENT</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x61c88647</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Returns the next hash code.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextHashCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> nextHashCode.getAndAdd(HASH_INCREMENT);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ•°å­— 0x61c88647</strong>ï¼šè¿™ä¸ªå…¶å®æ˜¯é»„é‡‘åˆ†å‰²ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é»„é‡‘åˆ†å‰²ç‚¹ï¼š(âˆš5 - 1) / 2 = 0.6180339887 1.618:1 == 1:0.618</span><br>System.out.println(BigDecimal.valueOf(Math.pow(<span class="hljs-number">2</span>, <span class="hljs-number">32</span>) * <span class="hljs-number">0.6180339887</span>).intValue());<br><span class="hljs-comment">//-1640531527</span><br></code></pre></td></tr></table></figure><ul><li>å­¦è¿‡æ•°å­¦éƒ½åº”è¯¥çŸ¥é“ï¼Œé»„é‡‘åˆ†å‰²ç‚¹æ˜¯ï¼Œ(âˆš5 - 1) &#x2F; 2ï¼Œå– 10 ä½è¿‘ä¼¼0.6180339887</li><li>ä¹‹åç”¨ 2 ^ 32 * 0.6180339887ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼š-1640531527ï¼Œä¹Ÿå°±æ˜¯ 16 è¿›åˆ¶çš„ï¼Œ0x61c88647ã€‚è¿™ä¸ªæ•°å‘¢ä¹Ÿå°±æ˜¯è¿™ä¹ˆæ¥çš„</li></ul><h1 id="æºç è§£è¯»"><a href="#æºç è§£è¯»" class="headerlink" title="æºç è§£è¯»"></a>æºç è§£è¯»</h1><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;()<br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ–çš„è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±éœ€è¦çš„æ³›å‹è¿›è¡Œè®¾ç½®ã€‚ä½†åœ¨ ThreadLocal çš„æºç ä¸­æœ‰ä¸€ç‚¹éå¸¸é‡è¦ ï¼Œå°±æ˜¯è·å– threadLocal çš„å“ˆå¸Œå€¼çš„è·å–ï¼Œ<code>threadLocalHashCode</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">threadLocalHashCode</span> <span class="hljs-operator">=</span> nextHashCode(); <span class="hljs-comment">// è·å–hashå€¼</span><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextHashCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> nextHashCode.getAndAdd(HASH_INCREMENT);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æºç ä¸­ï¼Œåªè¦å®ä¾‹åŒ–ä¸€ä¸ª <code>ThreadLocal </code>ï¼Œå°±ä¼šè·å–ä¸€ä¸ªç›¸åº”çš„å“ˆå¸Œå€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_threadLocalHashCode</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>        ThreadLocal&lt;Object&gt; objectThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">threadLocalHashCode</span> <span class="hljs-operator">=</span> objectThreadLocal.getClass().getDeclaredField(<span class="hljs-string">&quot;threadLocalHashCode&quot;</span>);<br>        threadLocalHashCode.setAccessible(<span class="hljs-literal">true</span>);<br>        System.out.println(<span class="hljs-string">&quot;objectThreadLocalï¼š&quot;</span> + threadLocalHashCode.get(objectThreadLocal));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">objectThreadLocalï¼š1253254570<br>objectThreadLocalï¼š-1401181199<br>objectThreadLocalï¼š239350328<br>objectThreadLocalï¼š1879881855<br>objectThreadLocalï¼š-774553914<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå€¼çš„è·å–ï¼Œä¹Ÿå°±æ˜¯è®¡ç®— <code>ThreadLocalMap</code>ï¼Œå­˜å‚¨æ•°æ®æ—¶ï¼ŒThreadLocal çš„æ•°ç»„ä¸‹æ ‡ã€‚åªè¦æ˜¯è¿™åŒä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ setã€get æ—¶ï¼Œå°±å¯ä»¥è®¾ç½®å’Œè·å–å¯¹åº”çš„å€¼</p><h2 id="è®¾ç½®å…ƒç´ "><a href="#è®¾ç½®å…ƒç´ " class="headerlink" title="è®¾ç½®å…ƒç´ "></a>è®¾ç½®å…ƒç´ </h2><p>è¿™ä¸ªå¯ä»¥çœ‹å›¾å»ç†è§£</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207101825235.png" alt="image-20220710182524106"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;<br><br>    <span class="hljs-comment">// We don&#x27;t use a fast path as with get() because it is at</span><br>    <span class="hljs-comment">// least as common to use set() to create new entries as</span><br>    <span class="hljs-comment">// it is to replace existing ones, in which case, a fast</span><br>    <span class="hljs-comment">// path would fail more often than not.</span><br><br>    Entry[] tab = table; <span class="hljs-comment">// Entry æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡çš„å®ç°ç±»</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> key.threadLocalHashCode &amp; (len-<span class="hljs-number">1</span>); <span class="hljs-comment">// è®¡ç®—ä¸‹æ ‡</span><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[i];<br>         e != <span class="hljs-literal">null</span>;<br>         e = tab[i = nextIndex(i, len)]) &#123; <span class="hljs-comment">// å¾ªç¯åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span><br>        ThreadLocal&lt;?&gt; k = e.get();<br><br>        <span class="hljs-keyword">if</span> (k == key) &#123;<br>            e.value = value;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (k == <span class="hljs-literal">null</span>) &#123;<br>            replaceStaleEntry(key, value, i); <span class="hljs-comment">//   </span><br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br><br>    tab[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(key, value); <span class="hljs-comment">// å­˜åœ¨ç›´æ¥è®¾ç½®</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">sz</span> <span class="hljs-operator">=</span> ++size;<br>    <span class="hljs-keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)<br>        rehash();<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><p><code>key.threadLocalHashCode &amp; (len-1);</code>ï¼Œæ–æ³¢é‚£å¥‘æ•£åˆ—ï¼Œè®¡ç®—æ•°ç»„ä¸‹æ ‡</p></li><li><p><code>Entry</code>ï¼Œæ˜¯ä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡çš„å®ç°ç±»ï¼Œ<code>static class Entry extendsWeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code>ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨ä¸‹ï¼Œä¼šå‘ç”Ÿ<code>GC</code>ï¼Œåˆ é™¤ <code>key</code></p></li><li><p>for å¾ªç¯åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå½“å‰ä¸‹æ ‡ä¸å­˜åœ¨å…ƒç´ æ—¶ï¼Œç›´æ¥è®¾ç½®å…ƒç´  <code>tab[i] =new Entry(key, value); </code></p></li><li><p>å¦‚æœå…ƒç´ å­˜åœ¨ï¼Œåˆ™ä¼šåˆ¤æ–­æ˜¯å¦ key å€¼ç›¸ç­‰ <code>if (k == key)</code>ï¼Œç›¸ç­‰åˆ™æ›´æ–°å€¼</p></li><li><p>å¦‚æœä¸ç›¸ç­‰ï¼Œå°±åˆ°äº†æˆ‘ä»¬çš„ <code>replaceStaleEntry</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„æ¢æµ‹å¼æ¸…ç†è¿‡æœŸå…ƒç´ </p></li></ol><h2 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)<br>    rehash();<br></code></pre></td></tr></table></figure><p><strong>ä¸Šé¢çš„ä»£ç å°±æ˜¯åˆ¤æ–­æ˜¯å¦æ‰©å®¹</strong></p><ul><li>é¦–å…ˆï¼Œè¿›è¡Œå¯å‘å¼æ¸…ç†<strong>cleanSomeSlots</strong>ï¼ŒæŠŠè¿‡æœŸå…ƒç´ æ¸…ç†æ‰ï¼Œçœ‹ç©ºé—´æ˜¯å¦å¤Ÿ</li><li>ä¹‹åï¼Œåˆ¤æ–­<code> sz &gt;= threshold</code>ï¼Œå…¶ä¸­ <code>threshold = len * 2 / 3</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°ç»„ä¸­å¤©å¡«å……çš„å…ƒç´ ï¼Œå¤§äº <code>len * 2 / 3</code>ï¼Œå°±éœ€è¦æ‰©å®¹äº†ã€‚</li><li>æœ€åï¼Œå°±æ˜¯æˆ‘ä»¬è¦åˆ†æçš„é‡ç‚¹ï¼Œ<code>rehash();</code>ï¼Œæ‰©å®¹é‡æ–°è®¡ç®—å…ƒç´ ä½ç½®ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rehash</span><span class="hljs-params">()</span> &#123;<br>    expungeStaleEntries();<br><br>    <span class="hljs-comment">// Use lower threshold for doubling to avoid hysteresis</span><br>    <span class="hljs-keyword">if</span> (size &gt;= threshold - threshold / <span class="hljs-number">4</span>)<br>        resize();<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">expungeStaleEntries</span><span class="hljs-params">()</span> &#123;<br>    Entry[] tab = table;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; len; j++) &#123;<br>        <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[j];<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span> &amp;&amp; e.get() == <span class="hljs-literal">null</span>)<br>            expungeStaleEntry(j);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è¿™éƒ¨åˆ†æ˜¯ä¸»è¦æ˜¯æ¢æµ‹å¼æ¸…ç†è¿‡æœŸå…ƒç´ ï¼Œä»¥åŠåˆ¤æ–­æ¸…ç†åæ˜¯å¦æ»¡è¶³æ‰©å®¹æ¡ä»¶ï¼Œ <code>size &gt;= threshold * 3/4</code></li><li>æ»¡è¶³åæ‰§è¡Œæ‰©å®¹æ“ä½œï¼Œå…¶å®æ‰©å®¹å®Œçš„æ ¸å¿ƒæ“ä½œå°±æ˜¯é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼ŒæŠŠå…ƒç´ å¡«å……åˆ°æ–°çš„æ•°ç»„ä¸­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resize</span><span class="hljs-params">()</span> &#123;<br>    Entry[] oldTab = table;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldLen</span> <span class="hljs-operator">=</span> oldTab.length;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">newLen</span> <span class="hljs-operator">=</span> oldLen * <span class="hljs-number">2</span>;<br>    Entry[] newTab = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>[newLen];<br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; oldLen; ++j) &#123;<br>        <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> oldTab[j];<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>            ThreadLocal&lt;?&gt; k = e.get();<br>            <span class="hljs-keyword">if</span> (k == <span class="hljs-literal">null</span>) &#123;<br>                e.value = <span class="hljs-literal">null</span>; <span class="hljs-comment">// Help the GC</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> k.threadLocalHashCode &amp; (newLen - <span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">while</span> (newTab[h] != <span class="hljs-literal">null</span>)<br>                    h = nextIndex(h, newLen);<br>                newTab[h] = e;<br>                count++;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    setThreshold(newLen);<br>    size = count;<br>    table = newTab;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><p>é¦–å…ˆæŠŠæ•°ç»„é•¿åº¦æ‰©å®¹åˆ°åŸæ¥çš„ 2 å€ï¼Œ<code>oldLen * 2</code>ï¼Œå®ä¾‹åŒ–æ–°æ•°ç»„</p></li><li><p>éå† forï¼Œæ‰€æœ‰çš„æ—§æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œé‡æ–°æ”¾åˆ°æ–°æ•°ç»„ä¸­</p></li><li><p>åœ¨æ”¾ç½®æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿå“ˆå¸Œç¢°æ’ï¼Œåˆ™é“¾å¼æ³•é¡ºå»¶</p></li><li><p>åŒæ—¶è¿™è¿˜æœ‰æ£€æµ‹ key å€¼çš„æ“ä½œ <code>if (k == null)</code>ï¼Œæ–¹ä¾¿ GC</p></li></ol><h2 id="è·å–å…ƒç´ "><a href="#è·å–å…ƒç´ " class="headerlink" title="è·å–å…ƒç´ "></a>è·å–å…ƒç´ </h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207101917480.png" alt="image-20220710191734400"></p><p>æŒ‰ç…§ä¸åŒçš„æ•°æ®å…ƒç´ å­˜å‚¨æƒ…å†µï¼ŒåŸºæœ¬åŒ…æ‹¬å¦‚ä¸‹æƒ…å†µï¼›</p><ol><li>ç›´æ¥å®šä½åˆ°ï¼Œæ²¡æœ‰å“ˆå¸Œå†²çªï¼Œç›´æ¥è¿”å›å…ƒç´ å³å¯ã€‚</li><li>æ²¡æœ‰ç›´æ¥å®šä½åˆ°äº†ï¼Œkey ä¸åŒï¼Œéœ€è¦æ‹‰é“¾å¼å¯»æ‰¾ã€‚</li><li>æ²¡æœ‰ç›´æ¥å®šä½åˆ°äº†ï¼Œkey ä¸åŒï¼Œæ‹‰é“¾å¼å¯»æ‰¾ï¼Œé‡åˆ° GC æ¸…ç†å…ƒç´ ï¼Œéœ€è¦æ¢æµ‹å¼æ¸…ç†ï¼Œå†å¯»æ‰¾å…ƒç´ </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Entry <span class="hljs-title function_">getEntryAfterMiss</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key, <span class="hljs-type">int</span> i, Entry e)</span> &#123;<br>    Entry[] tab = table;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br><br>    <span class="hljs-keyword">while</span> (e != <span class="hljs-literal">null</span>) &#123;<br>        ThreadLocal&lt;?&gt; k = e.get();<br>        <span class="hljs-keyword">if</span> (k == key)<br>            <span class="hljs-keyword">return</span> e;<br>        <span class="hljs-keyword">if</span> (k == <span class="hljs-literal">null</span>)<br>            expungeStaleEntry(i);<br>        <span class="hljs-keyword">else</span><br>            i = nextIndex(i, len);<br>        e = tab[i];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…ƒç´ æ¸…ç†"><a href="#å…ƒç´ æ¸…ç†" class="headerlink" title="å…ƒç´ æ¸…ç†"></a>å…ƒç´ æ¸…ç†</h2><p><strong>æ¢æµ‹å¼æ¸…ç†</strong></p><p>æ¢æµ‹å¼æ¸…ç†ï¼Œæ˜¯ä»¥å½“å‰é‡åˆ°çš„ GC å…ƒç´ å¼€å§‹ï¼Œå‘åä¸æ–­çš„æ¸…ç†ã€‚ç›´åˆ°é‡åˆ° nullä¸ºæ­¢ï¼Œæ‰åœæ­¢ rehash è®¡ç®— Rehash until we encounter nullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">expungeStaleEntry</span><span class="hljs-params">(<span class="hljs-type">int</span> staleSlot)</span> &#123;<br>    Entry[] tab = table;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br><br>    <span class="hljs-comment">// expunge entry at staleSlot</span><br>    tab[staleSlot].value = <span class="hljs-literal">null</span>;<br>    tab[staleSlot] = <span class="hljs-literal">null</span>;<br>    size--;<br><br>    <span class="hljs-comment">// Rehash until we encounter null</span><br>    Entry e;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-keyword">for</span> (i = nextIndex(staleSlot, len);<br>         (e = tab[i]) != <span class="hljs-literal">null</span>;<br>         i = nextIndex(i, len)) &#123;<br>        ThreadLocal&lt;?&gt; k = e.get();<br>        <span class="hljs-keyword">if</span> (k == <span class="hljs-literal">null</span>) &#123;<br>            e.value = <span class="hljs-literal">null</span>;<br>            tab[i] = <span class="hljs-literal">null</span>;<br>            size--;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> k.threadLocalHashCode &amp; (len - <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">if</span> (h != i) &#123;<br>                tab[i] = <span class="hljs-literal">null</span>;<br><br>                <span class="hljs-comment">// Unlike Knuth 6.4 Algorithm R, we must scan until</span><br>                <span class="hljs-comment">// null because multiple entries could have been stale.</span><br>                <span class="hljs-keyword">while</span> (tab[h] != <span class="hljs-literal">null</span>)<br>                    h = nextIndex(h, len);<br>                tab[h] = e;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> i;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¢æµ‹å¼æ¸…ç†åœ¨è·å–å…ƒç´ ä¸­ä½¿ç”¨åˆ°ï¼› new ThreadLocal&lt;&gt;().get() -&gt;  map.getEntry(this) -&gt; getEntryAfterMiss(key, i, e) -&gt; expungeStaleEntry(i)</p><p><strong>å¯å‘å¼æ¸…ç†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Heuristically scan some cells looking for stale entries.</span><br><span class="hljs-comment"> * This is invoked when either a new element is added, or</span><br><span class="hljs-comment"> * another stale one has been expunged. It performs a</span><br><span class="hljs-comment"> * logarithmic number of scans, as a balance between no</span><br><span class="hljs-comment"> * scanning (fast but retains garbage) and a number of scans</span><br><span class="hljs-comment"> * proportional to number of elements, that would find all</span><br><span class="hljs-comment"> * garbage but would cause some insertions to take O(n) time.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> i a position known NOT to hold a stale entry. The</span><br><span class="hljs-comment"> * scan starts at the element after i.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> n scan control: &#123;<span class="hljs-doctag">@code</span> log2(n)&#125; cells are scanned,</span><br><span class="hljs-comment"> * unless a stale entry is found, in which case</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@code</span> log2(table.length)-1&#125; additional cells are scanned.</span><br><span class="hljs-comment"> * When called from insertions, this parameter is the number</span><br><span class="hljs-comment"> * of elements, but when from replaceStaleEntry, it is the</span><br><span class="hljs-comment"> * table length. (Note: all this could be changed to be either</span><br><span class="hljs-comment"> * more or less aggressive by weighting n instead of just</span><br><span class="hljs-comment"> * using straight log n. But this version is simple, fast, and</span><br><span class="hljs-comment"> * seems to work well.)</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> true if any stale entries have been removed.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">cleanSomeSlots</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">removed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    Entry[] tab = table;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br>    <span class="hljs-keyword">do</span> &#123;<br>        i = nextIndex(i, len);<br>        <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[i];<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span> &amp;&amp; e.get() == <span class="hljs-literal">null</span>) &#123; <br>            n = len;<br>            removed = <span class="hljs-literal">true</span>;<br>            i = expungeStaleEntry(i);<br>        &#125;<br>    &#125; <span class="hljs-keyword">while</span> ( (n &gt;&gt;&gt;= <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> removed;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯å‘å¼æ¸…ç†ï¼Œæœ‰è¿™ä¹ˆä¸€æ®µæ³¨é‡Šï¼Œå¤§æ¦‚æ„æ€æ˜¯ï¼›è¯•æ¢çš„æ‰«æä¸€äº›å•å…ƒæ ¼ï¼Œå¯»æ‰¾è¿‡æœŸå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¢«åƒåœ¾å›æ”¶çš„å…ƒç´ ã€‚å½“æ·»åŠ æ–°å…ƒç´ æˆ–åˆ é™¤å¦ä¸€ä¸ªè¿‡æ—¶å…ƒç´ æ—¶ï¼Œå°†è°ƒ<br>ç”¨æ­¤å‡½æ•°ã€‚å®ƒæ‰§è¡Œå¯¹æ•°æ‰«ææ¬¡æ•°ï¼Œä½œä¸ºä¸æ‰«æï¼ˆå¿«é€Ÿä½†ä¿ç•™åƒåœ¾ï¼‰å’Œä¸å…ƒç´ æ•°é‡æˆæ¯”ä¾‹çš„æ‰«ææ¬¡æ•°ä¹‹é—´çš„å¹³è¡¡ï¼Œè¿™å°†æ‰¾åˆ°æ‰€æœ‰åƒåœ¾ï¼Œä½†ä¼šå¯¼è‡´ä¸€äº›æ’å…¥èŠ±è´¹ Oï¼ˆnï¼‰æ—¶é—´</p>]]></content>
    
    
    <categories>
      
      <category>æºç </category>
      
    </categories>
    
    
    <tags>
      
      <tag>æºç </tag>
      
      <tag>TreadLoacl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå¤ä¹ ç¬”è®°</title>
    <link href="/2022/07/10/2022-7-10-%20Spring%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/07/10/2022-7-10-%20Spring%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Springå¤ä¹ ç¬”è®°"><a href="#Springå¤ä¹ ç¬”è®°" class="headerlink" title="Springå¤ä¹ ç¬”è®°"></a>Springå¤ä¹ ç¬”è®°</h1><p>Spring è¿™ä¸ªæ¡†æ¶æ˜¯ç”¨äºæ•´åˆå…¶å®ƒæ¡†æ¶æ‰€ä½¿ç”¨çš„ã€‚å®˜ç½‘åœ°å€ï¼š<a href="https://spring.io/">https://spring.io/</a></p><p>Spring æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ DI&#x2F;IoCï¼ŒAOPï¼Œäº‹åŠ¡ç®¡ç†ã€‚</p><h1 id="æ¡†æ¶"><a href="#æ¡†æ¶" class="headerlink" title="æ¡†æ¶"></a>æ¡†æ¶</h1><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111814592.png" alt="image-20220711181439482"></p><p>Springä¸­æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ Bean å¯¹è±¡ã€‚</p><h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><h2 id="1-ä¾èµ–æ³¨å…¥"><a href="#1-ä¾èµ–æ³¨å…¥" class="headerlink" title="1. ä¾èµ–æ³¨å…¥"></a>1. ä¾èµ–æ³¨å…¥</h2><p>ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection, DIï¼‰ï¼Œå®ƒåœ¨ Spring ä¸­æ˜¯é€šè¿‡å·¥å‚åŠé…ç½®æ–‡ä»¶æ¥å®ç°ï¼Œç›®çš„æ˜¯ä¸ºäº†ç»™å¯¹è±¡çš„æˆå‘˜è¿›è¡Œèµ‹å€¼ã€‚</p><p>åœ¨ä¸ä½¿ç”¨ä¾èµ–æ³¨å…¥æ—¶æ˜¯è¿™æ ·ç»™æˆå‘˜å¯¹è±¡èµ‹å€¼çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>user.setId(<span class="hljs-number">1</span>);<br>user.setName(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´æ˜¯å…ˆåˆ›å»ºå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å¯¹è±¡æˆå‘˜çš„ set æ–¹æ³•æ¥ç»™æˆå‘˜å¯¹è±¡èµ‹å€¼ã€‚</p><p>å¦‚æœä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xianoupeng.entity.User&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æå››&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¾èµ–æ³¨å…¥æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> è§£è€¦ï¼Œä»¥å‰æ˜¯æˆ‘ä»¬æ‰‹åŠ¨newå¯¹è±¡ï¼Œè¿™å«ç¡¬ç¼–ç ã€‚ä½¿ç”¨äº†é…ç½®æ–¹å¼åï¼Œå°±ä¸ç”¨æˆ‘ä»¬ç¡¬ç¼–ç äº†ï¼Œåˆ›å»ºå¯¹è±¡çš„æ—¶æœºæ˜¯äº¤ç»™Springæ¡†æ¶æ¥å®Œæˆã€‚<br><span class="hljs-bullet">2.</span> çµæ´»<br></code></pre></td></tr></table></figure><h2 id="2-æ§åˆ¶åè½¬"><a href="#2-æ§åˆ¶åè½¬" class="headerlink" title="2. æ§åˆ¶åè½¬"></a>2. æ§åˆ¶åè½¬</h2><p>æ§åˆ¶åè½¬ï¼ˆInversion of Control, IoCï¼‰ï¼Œå®ƒæ˜¯æ ¸å¿ƒï¼ŒæŒ‡çš„æ˜¯å¯¹è±¡æˆå‘˜å˜é‡çš„èµ‹å€¼çš„æ§åˆ¶æƒç”±åŸæ¥æˆ‘ä»¬è‡ªå·±åˆ›å»ºç°åœ¨å˜ä¸ºäº¤ç»™ Spring æ¥åˆ›å»ºã€‚</p><h2 id="3-å¸¸ç”¨æ³¨è§£"><a href="#3-å¸¸ç”¨æ³¨è§£" class="headerlink" title="3. å¸¸ç”¨æ³¨è§£"></a>3. å¸¸ç”¨æ³¨è§£</h2><h3 id="3-1-Configuration"><a href="#3-1-Configuration" class="headerlink" title="3.1 @Configuration"></a>3.1 @Configuration</h3><p>å®ƒæ˜¯æ ‡æ³¨åœ¨ç±»ä¸Šçš„ï¼Œè¢«å®ƒæ ‡æ³¨çš„ç±»å°±æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ƒçš„ä½¿ç”¨å°±ç›¸å½“äº applicationContext.xml æ–‡ä»¶çš„ä½œç”¨ã€‚</p><h3 id="3-2-Component"><a href="#3-2-Component" class="headerlink" title="3.2 @Component"></a>3.2 @Component</h3><p>è¿™ä¸ªæ³¨è§£æ˜¯è®© Spring å®¹å™¨åœ¨åŠ è½½æ—¶è‡ªåŠ¨ä¼šæ·»åŠ åˆ°å®¹å™¨é‡Œé¢çš„æ³¨è§£ã€‚å®ƒä¹Ÿæ˜¯æ ‡æ³¨åœ¨ç±»ä¸Šçš„ã€‚å®ƒåœ¨ Spring å®¹å™¨ä¸­å°±ç›¸å½“äºä¸€ä¸ª Bean æ ‡ç­¾ã€‚</p><h3 id="3-3-Reponstory"><a href="#3-3-Reponstory" class="headerlink" title="3.3 @Reponstory"></a>3.3 @Reponstory</h3><p>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨ä¹Ÿ @Component è¿™ä¸ªæ³¨è§£çš„ä½œç”¨å’ŒåŠŸèƒ½ä¸€æ ·ã€‚ä½†ä»è¯­ä¹‰å±‚é¢æ¥è¯´ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯ç”¨äºæ•°æ®è®¿é—®å±‚ï¼Œè€Œ @Component å¸¸ç”¨äºå±‚æ¬¡ä¸æ€æ˜ç¡®æˆ–æ²¡æœ‰å±‚æ¬¡çš„åœ°æ–¹ã€‚</p><h3 id="3-4-Service"><a href="#3-4-Service" class="headerlink" title="3.4 @Service"></a>3.4 @Service</h3><p>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨ä¹Ÿ @Component è¿™ä¸ªæ³¨è§£çš„ä½œç”¨å’ŒåŠŸèƒ½ä¸€æ ·ã€‚ä½†ä»è¯­ä¹‰å±‚é¢æ¥è¯´ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯ç”¨äºä¸šåŠ¡é€»è¾‘å±‚ã€‚</p><h3 id="3-5-Controller"><a href="#3-5-Controller" class="headerlink" title="3.5 @Controller"></a>3.5 @Controller</h3><p>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨ä¹Ÿ @Component è¿™ä¸ªæ³¨è§£çš„ä½œç”¨å’ŒåŠŸèƒ½ä¸€æ ·ã€‚ä½†ä»è¯­ä¹‰å±‚é¢æ¥è¯´ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯ç”¨äºè®¿é—®æ§åˆ¶å±‚ã€‚</p><h3 id="3-6-Bean"><a href="#3-6-Bean" class="headerlink" title="3.6 @Bean"></a>3.6 @Bean</h3><p>å®ƒæ˜¯æ ‡æ³¨åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šçš„ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥ç»™å®ƒä¸€ä¸ª name å±æ€§ï¼Œç”¨äºç»™è¿™ä¸ª Bean å¯¹è±¡å–ä¸€ä¸ªå”¯ä¸€çš„åç§°ï¼Œä¾¿äºè°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰ç»™å®š name å±æ€§ï¼Œé‚£ä¹ˆè¢«è¿™ä¸ªæ³¨è§£æ‰€æ ‡æ³¨çš„æ–¹æ³•æ‰€å¯¹åº”çš„åç§°å°±æ˜¯æ–¹æ³•åç§°ã€‚</p><h3 id="3-7-Autowired"><a href="#3-7-Autowired" class="headerlink" title="3.7 @Autowired"></a>3.7 @Autowired</h3><p>è¿™ä¸ªæ³¨è§£å¯ä»¥æ·»åŠ åˆ°æˆå‘˜å±æ€§ã€æ–¹æ³•å‚æ•°ã€æ„é€ æ–¹æ³•ä¸Šã€‚å®ƒçš„ä½œç”¨æ˜¯æŠŠè¢«æ ‡æ³¨çš„å¯¹è±¡è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼ˆè£…é…ï¼‰ã€‚è¢«å®ƒæ³¨è§£çš„å¯¹è±¡é»˜è®¤æ˜¯æŒ‰ç…§ç±»å‹æ¥è‡ªåŠ¨è£…é…ã€‚å¦‚æœå¸Œæœ›æŒ‰ç…§åç§°æ¥è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œé‚£ä¹ˆè¦æ¥åˆ @Qualifier æ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚</p><h3 id="3-8-Qualifier"><a href="#3-8-Qualifier" class="headerlink" title="3.8 @Qualifier"></a>3.8 @Qualifier</h3><p>å®ƒçš„ä½œç”¨æ˜¯é…åˆ @Autowired æ³¨è§£æ¥æŒ‰åç§°è¿›è¡Œè£…é…ï¼Œå®ƒä¸èƒ½ç‹¬ç«‹ä½¿ç”¨ã€‚å¦‚æœå¸Œæœ›èƒ½å¤Ÿç‹¬ç«‹ä½¿ç”¨ï¼Œåˆ™åªèƒ½æ”¾åˆ°å‚æ•°åˆ—è¡¨ä¸­ã€‚</p><h3 id="3-9-Value"><a href="#3-9-Value" class="headerlink" title="3.9 @Value"></a>3.9 @Value</h3><p>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯å¯¹åŸºæœ¬æ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹è¿›è¡Œæ³¨å…¥å€¼ã€‚</p><h3 id="3-10-ComponentScan"><a href="#3-10-ComponentScan" class="headerlink" title="3.10 @ComponentScan"></a>3.10 @ComponentScan</h3><p>è¿™ä¸ªæ³¨è§£æ˜¯ç”¨äºç±»ä¸Šçš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯¹æŒ‡å®šåè·¯å¾„è¿›è¡Œæ‰«æã€‚</p><h3 id="3-11-PropertySource"><a href="#3-11-PropertySource" class="headerlink" title="3.11 @PropertySource"></a>3.11 @PropertySource</h3><p>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨åŠ è½½ .properties æ–‡ä»¶ä¸­çš„é…ç½®ã€‚</p><p>å®šä¹‰ jdbc.properties é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">jdbc.driver</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">jdbc.username</span>=<span class="hljs-string">root</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰é…ç½®ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcConfig</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String driver;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h3><p>è¿™ä¸ªæ³¨è§£æ˜¯ç”¨äºæ ‡æ³¨åœ¨ç±»ä¸Šçš„ï¼Œä½œç”¨æ˜¯å¯¼å…¥å…¶å®ƒçš„é…ç½®ç±»ï¼Œå®ƒæ˜¯å¯ä»¥ä¸€æ¬¡å¯¼å…¥å¤šä¸ªé…ç½®ç±»ã€‚</p><p>é…ç½®ç±» Aï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigA</span> &#123;&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®ç±» Bï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigB</span> &#123;&#125;<br></code></pre></td></tr></table></figure><p>ä¸»é…ç½®ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Import(&#123;ConfigA.class, ConfigB.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Configure</span> &#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><h2 id="1-åˆ›å»ºå·¥ç¨‹"><a href="#1-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="1. åˆ›å»ºå·¥ç¨‹"></a>1. åˆ›å»ºå·¥ç¨‹</h2><p> <img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111814386.png" alt="image-20220711181430312"></p><h2 id="2-æ·»åŠ ä¾èµ–"><a href="#2-æ·»åŠ ä¾èµ–" class="headerlink" title="2. æ·»åŠ ä¾èµ–"></a>2. æ·»åŠ ä¾èµ–</h2><p>åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.24<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="3-ç¼–å†™é…ç½®æ–‡ä»¶"><a href="#3-ç¼–å†™é…ç½®æ–‡ä»¶" class="headerlink" title="3. ç¼–å†™é…ç½®æ–‡ä»¶"></a>3. ç¼–å†™é…ç½®æ–‡ä»¶</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xianoupeng.entity.User&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;åˆ˜å¤‡&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xianoupeng.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="4-ç¼–å†™å®ç°ç±»"><a href="#4-ç¼–å†™å®ç°ç±»" class="headerlink" title="4. ç¼–å†™å®ç°ç±»"></a>4. ç¼–å†™å®ç°ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String name;<br>&#125;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDao</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> &#123;<br>        System.out.println(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-æµ‹è¯•"><a href="#5-æµ‹è¯•" class="headerlink" title="5. æµ‹è¯•"></a>5. æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ExtendWith(SpringExtension.class)</span><br><span class="hljs-meta">@ContextConfiguration(&quot;classpath:spring.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringTest</span> &#123;<br>    <span class="hljs-comment">//@Autowired</span><br>    <span class="hljs-comment">//private ApplicationContext context;</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;spring.xml&quot;);</span><br><br>        <span class="hljs-comment">//UserDao userDao = context.getBean(UserDao.class);</span><br>        userDao.save(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>().setId(<span class="hljs-number">100</span>).setName(<span class="hljs-string">&quot;å¼ é£&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ ¸å¿ƒå®¹å™¨ç±»"><a href="#æ ¸å¿ƒå®¹å™¨ç±»" class="headerlink" title="æ ¸å¿ƒå®¹å™¨ç±»"></a>æ ¸å¿ƒå®¹å™¨ç±»</h1><h2 id="1-BeanFactory"><a href="#1-BeanFactory" class="headerlink" title="1. BeanFactory"></a>1. BeanFactory</h2><p>Springä¸­Beançš„åˆ›å»ºæ˜¯å…¸å‹çš„å·¥å‚æ¨¡å¼ï¼Œä¸€ç³»åˆ—çš„ Bean å·¥å‚ï¼Œå³ IoCå®¹å™¨ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111814409.png" alt="image-20220711181420309"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanFactory</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">FACTORY_BEAN_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&amp;&quot;</span>;<br><br>    Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String var1)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>    &lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(String var1, Class&lt;T&gt; var2)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>    Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String var1, Object... var2)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>    &lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(Class&lt;T&gt; var1)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>    &lt;T&gt; T <span class="hljs-title function_">getBean</span><span class="hljs-params">(Class&lt;T&gt; var1, Object... var2)</span> <span class="hljs-keyword">throws</span> BeansException;<br><br>    &lt;T&gt; ObjectProvider&lt;T&gt; <span class="hljs-title function_">getBeanProvider</span><span class="hljs-params">(Class&lt;T&gt; var1)</span>;<br><br>    &lt;T&gt; ObjectProvider&lt;T&gt; <span class="hljs-title function_">getBeanProvider</span><span class="hljs-params">(ResolvableType var1)</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsBean</span><span class="hljs-params">(String var1)</span>;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">(String var1)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isPrototype</span><span class="hljs-params">(String var1)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isTypeMatch</span><span class="hljs-params">(String var1, ResolvableType var2)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isTypeMatch</span><span class="hljs-params">(String var1, Class&lt;?&gt; var2)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>    <span class="hljs-meta">@Nullable</span><br>    Class&lt;?&gt; getType(String var1) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>    <span class="hljs-meta">@Nullable</span><br>    Class&lt;?&gt; getType(String var1, <span class="hljs-type">boolean</span> var2) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>    String[] getAliases(String var1);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-BeanDefinition"><a href="#2-BeanDefinition" class="headerlink" title="2. BeanDefinition"></a>2. BeanDefinition</h2><p>å®ƒæ˜¯ Spring IoC å®¹å™¨ç®¡ç†æˆ‘ä»¬å®šä¹‰çš„å„ç§ Bean å¯¹è±¡åŠå…¶ç›¸äº’ä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111814787.png" alt="image-20220711181408682"></p><h2 id="3-BeanDefinitionReader"><a href="#3-BeanDefinitionReader" class="headerlink" title="3. BeanDefinitionReader"></a>3. BeanDefinitionReader</h2><p>Bean çš„è§£æè¿‡ç¨‹éå¸¸å¤æ‚ï¼ŒåŠŸèƒ½è¢«åˆ†è§£å¾—å¾ˆç»†ï¼Œå› ä¸ºè¿™é‡Œéœ€è¦è¢«æ‰©å±•çš„åœ°æ–¹å¾ˆå¤šï¼Œå¿…é¡»ä¿è¯è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œä»¥åº”å¯¹å¯èƒ½å‘ç”Ÿçš„å˜åŒ–ã€‚</p><h1 id="IoCæºç "><a href="#IoCæºç " class="headerlink" title="IoCæºç "></a>IoCæºç </h1><p>ApplicatoinContext å…è®¸ä¸‹ä¸‹æ–‡åµŒå¥—ï¼Œé€šè¿‡ä¿æŒçˆ¶ä¸Šä¸‹æ–‡å°±å¯ä»¥ç»´æŒä¸€ä¸ªä¸Šä¸‹æ–‡å…³ç³»ã€‚</p><h2 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><p>é€šè¿‡ ClassPathXmlApplicationContext è¯·æ±‚é…ç½®æ–‡ä»¶çš„åœ°æ–¹æ¥è¿›å…¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;spring.xml&quot;</span>);<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹è¿™ä¸ªæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ClassPathXmlApplicationContext</span><span class="hljs-params">(String configLocation)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-built_in">this</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;configLocation&#125;, <span class="hljs-literal">true</span>, (ApplicationContext)<span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®è°ƒç”¨çš„æ˜¯æœ¬ç±»ä¸­çš„å¦ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ClassPathXmlApplicationContext</span><span class="hljs-params">(String[] configLocations, <span class="hljs-type">boolean</span> refresh, <span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-built_in">super</span>(parent);<br>    <span class="hljs-built_in">this</span>.setConfigLocations(configLocations);<br>    <span class="hljs-keyword">if</span> (refresh) &#123;<br>        <span class="hljs-built_in">this</span>.refresh();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ„é€ å™¨ä¸­ï¼Œæœ€å…³é”®çš„ä»£ç æ˜¯ <code>this.refresh();</code></p><p>ç‚¹å‡»è¿™ä¸ªæ–¹æ³•ï¼Œä¼šè¿›å…¥åˆ° AbstractApplicaitonContext ç±»ä¸­çš„ refresh() æ–¹æ³•ä¸­ã€‚</p><p>æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">AbstractApplicationContext</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//....çœç•¥</span><br>    <br>    <span class="hljs-comment">// åŠ è½½èµ„æºå¹¶è¿›è¡Œè§£æ</span><br>    <span class="hljs-built_in">this</span>.resourcePatternResolver = <span class="hljs-built_in">this</span>.getResourcePatternResolver();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç‚¹å‡»è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> ResourcePatternResolver <span class="hljs-title function_">getResourcePatternResolver</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathMatchingResourcePatternResolver</span>(<span class="hljs-built_in">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç‚¹å‡»è¿™ä¸ªæ–¹æ³•ï¼Œè¿›å…¥ PathMatchingResourcePatternResolver ç±»ä¸­çš„æœ‰å‚æ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">PathMatchingResourcePatternResolver</span><span class="hljs-params">(ResourceLoader resourceLoader)</span> &#123;<br>    Assert.notNull(resourceLoader, <span class="hljs-string">&quot;ResourceLoader must not be null&quot;</span>);<br>    <span class="hljs-built_in">this</span>.resourceLoader = resourceLoader;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ„é€ å™¨ä¸­è®¾ç½®äº† Spring èµ„æºåŠ è½½å™¨ã€‚</p><p>è®¾ç½®äº†å®¹å™¨çš„èµ„æºåŠ è½½å™¨åï¼Œæˆ‘ä»¬å°±è¦è¿›å…¥åˆ° ClassPathXmlApplicationContext ç±»ä¸­çš„ setConfigLocations() æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨å…¶çˆ¶ç±» AbstractRefreshableConfigApplicationContext çš„æ–¹æ³•è¿›è¡Œ Bean é…ç½®ä¿¡æ¯çš„å®šä½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConfigLocations</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String... locations)</span> &#123;<br>    <span class="hljs-keyword">if</span> (locations != <span class="hljs-literal">null</span>) &#123;<br>        Assert.noNullElements(locations, <span class="hljs-string">&quot;Config locations must not be null&quot;</span>);<br>        <span class="hljs-built_in">this</span>.configLocations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[locations.length];<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; locations.length; ++i) &#123;<br>            <span class="hljs-built_in">this</span>.configLocations[i] = <span class="hljs-built_in">this</span>.resolvePath(locations[i]).trim();<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">this</span>.configLocations = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>Spring å®¹å™¨å¯¹ Bean é…ç½®èµ„æºçš„è½½å…¥æ˜¯ä» refresh() æ–¹æ³•å¼€å§‹çš„ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException &#123;<br>    <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>.startupShutdownMonitor) &#123;<br>        <span class="hljs-type">StartupStep</span> <span class="hljs-variable">contextRefresh</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.context.refresh&quot;</span>);<br>        <span class="hljs-comment">// 1. è°ƒç”¨å®¹å™¨å‡†å¤‡åˆ·æ–°çš„æ–¹æ³•ï¼Œè·å–å®¹å™¨çš„å½“å‰æ—¶é—´ï¼ŒåŒæ—¶ç»™å®¹å™¨è®¾ç½®åŒæ­¥æ ‡è¯†</span><br>        <span class="hljs-built_in">this</span>.prepareRefresh();<br>        <span class="hljs-comment">// 2. å‘Šè¯‰å­ç±»å¯åŠ¨ refreshBeanFactory() æ–¹æ³•ï¼ŒBean å®šä¹‰èµ„æºæ–‡ä»¶çš„åŠ è½½ä»å®ƒçš„å­ç±»çš„ refreshBeanFactory() å¯åŠ¨</span><br>        <span class="hljs-type">ConfigurableListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.obtainFreshBeanFactory();<br>        <span class="hljs-comment">// 3. ä¸º BeanFactory é…ç½®å®¹å™¨ç‰¹æ€§ï¼Œä¾‹å¦‚ç±»åŠ è½½å™¨ã€äº‹ä»¶å¤„ç†å™¨ç­‰</span><br>        <span class="hljs-built_in">this</span>.prepareBeanFactory(beanFactory);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 4. ä¸ºå®¹å™¨çš„æŸäº›å­ç±»æŒ‡å®šç‰¹æ®Šçš„ post äº‹ä»¶å¤„ç†å™¨</span><br>            <span class="hljs-built_in">this</span>.postProcessBeanFactory(beanFactory);<br>            <span class="hljs-type">StartupStep</span> <span class="hljs-variable">beanPostProcess</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.context.beans.post-process&quot;</span>);<br>            <span class="hljs-comment">// 5. è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ BeanFactoryPostProcessor çš„ Bean</span><br>            <span class="hljs-built_in">this</span>.invokeBeanFactoryPostProcessors(beanFactory);<br>            <span class="hljs-comment">// 6. ä¸º BeanPost æ³¨å†Œ Post äº‹ä»¶å¤„ç†å™¨</span><br>            <span class="hljs-built_in">this</span>.registerBeanPostProcessors(beanFactory);<br>            beanPostProcess.end();<br>            <span class="hljs-comment">// 7. åˆå§‹åŒ–ä¿¡æ¯æºï¼Œå¦‚å›½é™…åŒ–ç›¸å…³</span><br>            <span class="hljs-built_in">this</span>.initMessageSource();<br>            <span class="hljs-comment">// 8. åˆå§‹åŒ–å®¹å™¨äº‹ä»¶ä¼ æ’­å™¨</span><br>            <span class="hljs-built_in">this</span>.initApplicationEventMulticaster();<br>            <span class="hljs-comment">// 9. è°ƒç”¨å­ç±»çš„æŸäº›ç‰¹æ®Š Bean çš„åˆå§‹åŒ–æ–¹æ³•</span><br>            <span class="hljs-built_in">this</span>.onRefresh();<br>            <span class="hljs-comment">// 10. ä¸ºäº‹ä»¶ä¼ æ’­å™¨æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨</span><br>            <span class="hljs-built_in">this</span>.registerListeners();<br>            <span class="hljs-comment">// 11. åˆå§‹åŒ–æ‰€æœ‰å‰©ä½™çš„å•ä¾‹ Bean</span><br>            <span class="hljs-built_in">this</span>.finishBeanFactoryInitialization(beanFactory);<br>            <span class="hljs-comment">// 12. åˆå§‹åŒ–å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†å™¨ï¼Œå¹¶å‘å¸ƒå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</span><br>            <span class="hljs-built_in">this</span>.finishRefresh();<br>        &#125; <span class="hljs-keyword">catch</span> (BeansException var10) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.logger.isWarnEnabled()) &#123;<br>                <span class="hljs-built_in">this</span>.logger.warn(<span class="hljs-string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> + var10);<br>            &#125;<br><span class="hljs-comment">// 13. é”€æ¯å·²åˆ›å»ºçš„ Bean</span><br>            <span class="hljs-built_in">this</span>.destroyBeans();<br>            <span class="hljs-comment">// 14. å–æ¶ˆåˆ·æ–°æ“ä½œï¼Œé‡ç½®å®¹å™¨çš„åŒæ­¥æ ‡è¯†</span><br>            <span class="hljs-built_in">this</span>.cancelRefresh(var10);<br>            <span class="hljs-keyword">throw</span> var10;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// 15. é‡ç½®å…¬å…±ç¼“å­˜</span><br>            <span class="hljs-built_in">this</span>.resetCommonCaches();<br>            contextRefresh.end();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ–¹æ³•ï¼Œå°±å®Œå…¨åŒ…å«äº† Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p><p>ç‚¹å‡» <code>obtainFreshBeanFactory()</code> è¿™ä¸ªæ–¹æ³•ï¼Œè¿›å…¥ AbstractApplicationContext ç±»ä¸­çš„ obtainFreshBeanFactory() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> ConfigurableListableBeanFactory <span class="hljs-title function_">obtainFreshBeanFactory</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨äº†å§”æ´¾æ¨¡å¼ï¼Œçˆ¶ç±»å®šä¹‰äº†æŠ½è±¡çš„ refreshBeanFactory() æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°å­ç±»æ¥å®Œæˆã€‚</span><br>    <span class="hljs-built_in">this</span>.refreshBeanFactory();<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.getBeanFactory();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ refreshBeanFactory() æ–¹æ³•ï¼Œè¿›å…¥ AbstractRefreshableApplicationContext ç±»ä¸­çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-comment">// å¦‚æœå·²ç»æœ‰å®¹å™¨ï¼Œåˆ™é”€æ¯å®¹å™¨ä¸­çš„ Beanï¼Œç„¶åå…³é—­å®¹å™¨</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.hasBeanFactory()) &#123;<br>        <span class="hljs-built_in">this</span>.destroyBeans();<br>        <span class="hljs-built_in">this</span>.closeBeanFactory();<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»º IoC å®¹å™¨</span><br>        <span class="hljs-type">DefaultListableBeanFactory</span> <span class="hljs-variable">beanFactory</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.createBeanFactory();<br>        beanFactory.setSerializationId(<span class="hljs-built_in">this</span>.getId());<br>        <span class="hljs-comment">// å¯¹ IoC å®¹å™¨è¿›è¡Œå®šåˆ¶åŒ–ï¼Œå¦‚è®¾ç½®å¯åŠ¨å‚æ•°ã€å¼€å¯æ³¨è§£çš„è‡ªåŠ¨è£…é…ç­‰ã€‚</span><br>        <span class="hljs-built_in">this</span>.customizeBeanFactory(beanFactory);<br>        <span class="hljs-comment">// è°ƒç”¨ Bean å®šä¹‰çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ä½¿ç”¨å§”æ´¾æ¨¡å¼ï¼Œå½“ç±»ä¸­å®šä¹‰äº†æŠ½è±¡çš„ loadBeanDefinitions() æ–¹æ³•æ—¶ï¼Œè°ƒç”¨å­ç±»å®¹å™¨å®ç°</span><br>        <span class="hljs-built_in">this</span>.loadBeanDefinitions(beanFactory);<br>        <span class="hljs-built_in">this</span>.beanFactory = beanFactory;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException var2) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationContextException</span>(<span class="hljs-string">&quot;I/O error parsing bean definition source for &quot;</span> + <span class="hljs-built_in">this</span>.getDisplayName(), var2);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è½½å…¥é…ç½®è·¯å¾„"><a href="#è½½å…¥é…ç½®è·¯å¾„" class="headerlink" title="è½½å…¥é…ç½®è·¯å¾„"></a>è½½å…¥é…ç½®è·¯å¾„</h2><p>ç‚¹å‡» <code>loadBeanDefinitions()</code> è¿™ä¸ªæ–¹æ³•å¹¶è¿›å…¥ AbstractXmlApplicationContext ç±»ä¸­çš„ loadBeanDefinitions() æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(DefaultListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException, IOException &#123;<br>    <span class="hljs-comment">// åˆ›å»º XmlBeanDefinitionReader å¯¹è±¡ï¼Œç”¨äºè¯»å– Bean ä¿¡æ¯ï¼Œå¹¶é€šè¿‡å›è°ƒè®¾ç½®åˆ°å®¹å™¨ä¸­ï¼Œå®¹å™¨ä½¿ç”¨è¯¥è¯»å–å™¨è¯»å– Bean é…ç½®èµ„æº</span><br>    <span class="hljs-type">XmlBeanDefinitionReader</span> <span class="hljs-variable">beanDefinitionReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XmlBeanDefinitionReader</span>(beanFactory);<br>    <span class="hljs-comment">// ä¸º Bean å¯¹è±¡è®¾ç½®èµ„æºåŠ è½½å™¨</span><br>    beanDefinitionReader.setEnvironment(<span class="hljs-built_in">this</span>.getEnvironment());<br>    beanDefinitionReader.setResourceLoader(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-comment">// ä¸º Bean è¯»å–å™¨è®¾ç½® SAX xml è§£æå™¨</span><br>    beanDefinitionReader.setEntityResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceEntityResolver</span>(<span class="hljs-built_in">this</span>));<br>    <span class="hljs-comment">// ä¸º Bean è¯»å–å™¨è¯»å– Bean å®šä¹‰çš„ xml èµ„æºæ–‡ä»¶æ—¶å¯åŠ¨ xml æ ¡éªŒæœºåˆ¶</span><br>    <span class="hljs-built_in">this</span>.initBeanDefinitionReader(beanDefinitionReader);<br>    <span class="hljs-comment">// Bean è¯»å–å™¨çœŸæ­£å®ç°åŠ è½½çš„æ–¹æ³•</span><br>    <span class="hljs-built_in">this</span>.loadBeanDefinitions(beanDefinitionReader);<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æ¬¡ç‚¹å‡» <code>loadBeanDefinitions()</code> è¿›å…¥æœ¬ç±»ä¸­çš„å¦ä¸€ä¸ªæ–¹æ³•ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(XmlBeanDefinitionReader reader)</span> <span class="hljs-keyword">throws</span> BeansException, IOException &#123;<br>    <span class="hljs-comment">// è¯»å– Bean é…ç½®èµ„æºå®šä½</span><br>    Resource[] configResources = <span class="hljs-built_in">this</span>.getConfigResources();<br>    <span class="hljs-keyword">if</span> (configResources != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// xml Bean è¯»å–å™¨è°ƒç”¨çˆ¶ç±» AbstractBeanDefinitionReader ä¸­è¯»å–å®šä½çš„ Bean èµ„æºæ–¹æ³•</span><br>        reader.loadBeanDefinitions(configResources);<br>    &#125;<br><span class="hljs-comment">// å¦‚æœå­ç±»ä¸­è·å–çš„ Bean é…ç½®èµ„æºä¸ºç©ºï¼Œåˆ™è·å– AbstractRefreshableConfigApplicationContext æ„é€ å™¨æ–¹æ³•ä¸­setConfigLocations() æ–¹æ³•é…ç½®çš„èµ„æº </span><br>    String[] configLocations = <span class="hljs-built_in">this</span>.getConfigLocations();<br>    <span class="hljs-keyword">if</span> (configLocations != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// xml Bean è¯»å–å™¨è°ƒç”¨å…¶çˆ¶ç±»ä¸­çš„ AbstractBeanDefinitionReader ä¸­è¯»å–å®šä½çš„ Bean èµ„æºæ–¹æ³•</span><br>        reader.loadBeanDefinitions(configLocations);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥çœ‹ä¸Šé¢çš„æºç å¯ä»¥å‘ç°ï¼Œä¸ç®¡åœ¨ Bean æ˜¯å¦è¯»å–åˆ° Bean å®šä½èµ„æºï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œçˆ¶ç±» AbstractBeanDefinitionReader ä¸­çš„ loadBeanDefinitions() æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(String... locations)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException &#123;<br>    Assert.notNull(locations, <span class="hljs-string">&quot;Location array must not be null&quot;</span>);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (String location : locations) &#123;<br>        count += loadBeanDefinitions(location);<br>    &#125;<br>    <span class="hljs-keyword">return</span> count;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ç»Ÿè®¡èµ„æºçš„ä¸ªæ•°ï¼ŒåŒæ—¶ä¹Ÿå†æ¬¡è°ƒç”¨äº† <code>loadBeanDefinitions()</code> æ–¹æ³•ï¼Œç‚¹å‡»åè¿›å…¥åˆ°æœ¬ç±»ä¸­çš„åŒåæ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(String location)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException &#123;<br>    <span class="hljs-keyword">return</span> loadBeanDefinitions(location, <span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æ¬¡è¿›å…¥ <code>loadBeanDefinitions()</code> æ–¹æ³•ï¼Œè¿›å…¥æœ¬ç±»ä¸­å¦ä¸€ä¸ªåŒåçš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(String location, <span class="hljs-meta">@Nullable</span> Set&lt;Resource&gt; actualResources)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException &#123;<br>    <span class="hljs-comment">// è·å–åœ¨ IoC å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­è®¾ç½®çš„èµ„æºåŠ è½½å™¨</span><br>    <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> getResourceLoader();<br>    <span class="hljs-keyword">if</span> (resourceLoader == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanDefinitionStoreException</span>(<br>            <span class="hljs-string">&quot;Cannot load bean definitions from location [&quot;</span> + location + <span class="hljs-string">&quot;]: no ResourceLoader available&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (resourceLoader <span class="hljs-keyword">instanceof</span> ResourcePatternResolver) &#123;<br>        <span class="hljs-comment">// èµ„æºæ¨¡å¼åŒ¹é…</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å°†æŒ‡å®šä½ç½®çš„ Bean é…ç½®ä¿¡æ¯è§£æä¸º Spring IoC å®¹å™¨å°è£…çš„èµ„æºï¼ŒåŠ è½½å¤šä¸ªæŒ‡å®šçš„ Bean é…ç½®ä¿¡æ¯</span><br>            Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location);<br>            <span class="hljs-comment">// ä½¿ç”¨å§”æ´¾æ¨¡å¼ï¼Œè°ƒç”¨å…¶å­ç±»çš„ XmlBeanDefinitionReader çš„æ–¹æ³•ï¼Œå®ç°åŠ è½½åŠŸèƒ½</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> loadBeanDefinitions(resources);<br>            <br>            <span class="hljs-comment">//......çœç•¥</span><br>            <br>            <span class="hljs-keyword">return</span> count;<br>        &#125;<br>        <span class="hljs-comment">//.....çœç•¥</span><br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å°†æŒ‡å®šä½ç½®çš„ Bean é…ç½®ä¿¡æ¯è§£æä¸º Spring IoC å®¹å™¨å°è£…çš„èµ„æºï¼ŒåŠ è½½å•ä¸ªæŒ‡å®šä½ç½®çš„ Bean é…ç½®ä¿¡æ¯</span><br>        <span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> resourceLoader.getResource(location);<br>        <span class="hljs-comment">// ä½¿ç”¨å§”æ´¾æ¨¡å¼ï¼Œè°ƒç”¨å…¶å­ç±»çš„ XmlBeanDefinitionReader çš„æ–¹æ³•ï¼Œå®ç°åŠ è½½åŠŸèƒ½</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> loadBeanDefinitions(resource);<br>        <br>        <span class="hljs-comment">//......çœç•¥</span><br>        <br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æ¬¡è¿›å…¥ <code>loadBeanDefinitions()</code>ï¼Œè¿›å…¥ XmlBeanDefinitionReader ç±»ä¸­çš„ loadBeanDefinitions()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(Resource resource)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException &#123;<br>    <span class="hljs-keyword">return</span> loadBeanDefinitions(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EncodedResource</span>(resource));<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åˆè°ƒç”¨äº†æœ¬ç±»ä¸­çš„ <code>loadBeanDefinitions()</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">loadBeanDefinitions</span><span class="hljs-params">(EncodedResource encodedResource)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException &#123;<br>    <span class="hljs-comment">//.....çœç•¥</span><br><br>    <span class="hljs-comment">// è·å– Resource å¯¹è±¡ è½¬æ¢ä¸º XML æ–‡ä»¶æµå¯¹è±¡</span><br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> encodedResource.getResource().getInputStream()) &#123;<br>        <span class="hljs-comment">// å°†æµè½¬æ¢æˆ InputSource</span><br>        <span class="hljs-type">InputSource</span> <span class="hljs-variable">inputSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(inputStream);<br>        <span class="hljs-keyword">if</span> (encodedResource.getEncoding() != <span class="hljs-literal">null</span>) &#123;<br>            inputSource.setEncoding(encodedResource.getEncoding());<br>        &#125;<br>        <span class="hljs-comment">// åŠ è½½</span><br>        <span class="hljs-keyword">return</span> doLoadBeanDefinitions(inputSource, encodedResource.getResource());<br>    &#125;<br>    <span class="hljs-comment">//.....çœç•¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç‚¹å‡» <code>doLoadBeanDefinitions()</code> æ–¹æ³•å¹¶è¿›å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">doLoadBeanDefinitions</span><span class="hljs-params">(InputSource inputSource, Resource resource)</span><br>    <span class="hljs-keyword">throws</span> BeanDefinitionStoreException &#123;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// å°† Resource è½¬æˆ Document å¯¹è±¡</span><br>        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> doLoadDocument(inputSource, resource);<br>        <span class="hljs-comment">// è§£æ Document å¯¹è±¡</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> registerBeanDefinitions(doc, resource);<br>        <br>        <span class="hljs-comment">//....çœç•¥</span><br>        <br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br>    <span class="hljs-comment">//......çœç•¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>registerBeanDefinitions()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(Document doc, Resource resource)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException &#123;<br>    <span class="hljs-comment">// åˆ›å»º Document è§£æå™¨è¿›è¡Œè§£æ</span><br>    <span class="hljs-type">BeanDefinitionDocumentReader</span> <span class="hljs-variable">documentReader</span> <span class="hljs-operator">=</span> createBeanDefinitionDocumentReader();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">countBefore</span> <span class="hljs-operator">=</span> getRegistry().getBeanDefinitionCount();<br>    <span class="hljs-comment">// ç”¨ Documentè§£æå™¨è¿›è¡Œè§£æ</span><br>    documentReader.registerBeanDefinitions(doc, createReaderContext(resource));<br>    <span class="hljs-keyword">return</span> getRegistry().getBeanDefinitionCount() - countBefore;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è§£æé…ç½®æ–‡ä»¶"><a href="#è§£æé…ç½®æ–‡ä»¶" class="headerlink" title="è§£æé…ç½®æ–‡ä»¶"></a>è§£æé…ç½®æ–‡ä»¶</h2><p>è¿›å…¥ <code>registerBeanDefinitions()</code>è¿™ä¸ªæ–¹æ³•ä¼šè¿›å…¥ BeanDefinitionDocumentReader æ¥å£ç±»ä¸­çš„ registerBeanDefinitions æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanDefinitionDocumentReader</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(Document doc, XmlReaderContext readerContext)</span><br><span class="hljs-keyword">throws</span> BeanDefinitionStoreException;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰¾åˆ°è¿™ä¸ªæ¥å£çš„å­ç±» BeanDefinitionDocumentReader å¯¹åº”çš„æ–¹æ³•å¹¶è¿›å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(Document doc, XmlReaderContext readerContext)</span> &#123;<br>    <span class="hljs-built_in">this</span>.readerContext = readerContext;<br>    <span class="hljs-comment">// è§£æ XML ä¸­é…ç½®çš„ä¿¡æ¯ï¼Œå¹¶å­˜å…¥åˆ° BeanDefinitionå¯¹è±¡ä¸­</span><br>    doRegisterBeanDefinitions(doc.getDocumentElement());<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>doRegisterBeanDefinitions()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doRegisterBeanDefinitions</span><span class="hljs-params">(Element root)</span> &#123;<br><span class="hljs-comment">// ....çœç•¥</span><br><br>    <span class="hljs-comment">// å¤„ç†ï¼ˆè§£æï¼‰XMLé…ç½®æ–‡ä»¶ä¹‹å‰çš„æ“ä½œ</span><br>preProcessXml(root);<br><span class="hljs-comment">// è§£æ</span><br>parseBeanDefinitions(root, <span class="hljs-built_in">this</span>.delegate);<br>postProcessXml(root);<br><br><span class="hljs-built_in">this</span>.delegate = parent;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯ <code>parseBeanDefinitions()</code> æ–¹æ³•ï¼Œè¿›å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseBeanDefinitions</span><span class="hljs-params">(Element root, BeanDefinitionParserDelegate delegate)</span> &#123;<br>    <span class="hljs-keyword">if</span> (delegate.isDefaultNamespace(root)) &#123;<br>        <span class="hljs-type">NodeList</span> <span class="hljs-variable">nl</span> <span class="hljs-operator">=</span> root.getChildNodes();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nl.getLength(); i++) &#123;<br>            <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> nl.item(i);<br>            <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> Element) &#123;<br>                <span class="hljs-type">Element</span> <span class="hljs-variable">ele</span> <span class="hljs-operator">=</span> (Element) node;<br>                <span class="hljs-keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;<br>                    <span class="hljs-comment">// é»˜è®¤æ ‡ç­¾è§£æ</span><br>                    parseDefaultElement(ele, delegate);<br>                &#125;<br>                <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// è‡ªå®šä¹‰æ ‡ç­¾è§£æ</span><br>                    delegate.parseCustomElement(ele);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        delegate.parseCustomElement(root);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>parseDefaultElement()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseDefaultElement</span><span class="hljs-params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;<br>    <span class="hljs-comment">// import æ ‡ç­¾</span><br>    <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;<br>        importBeanDefinitionResource(ele);<br>    &#125;<br>    <span class="hljs-comment">// alias æ ‡ç­¾</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;<br>        processAliasRegistration(ele);<br>    &#125;<br>    <span class="hljs-comment">// bean æ ‡ç­¾</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;<br>        processBeanDefinition(ele, delegate);<br>    &#125;<br>    <span class="hljs-comment">// beans æ ‡ç­¾</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;<br>        <span class="hljs-comment">// recurse</span><br>        doRegisterBeanDefinitions(ele);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»¥è§£æ <code>&lt;bean&gt;</code> æ ‡ç­¾ä¸ºä¾‹ï¼Œè¿›å…¥ <code>processBeanDefinition()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processBeanDefinition</span><span class="hljs-params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;<br><span class="hljs-comment">// å°† Element å°è£…æˆ BeanDefinition</span><br><span class="hljs-type">BeanDefinitionHolder</span> <span class="hljs-variable">bdHolder</span> <span class="hljs-operator">=</span> delegate.parseBeanDefinitionElement(ele);<br><span class="hljs-keyword">if</span> (bdHolder != <span class="hljs-literal">null</span>) &#123;<br>bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// å‘Spring IoC å®¹å™¨æ³¨å†Œè§£æå¾—åˆ°çš„ Bean å®šä¹‰ï¼Œè¿™æ˜¯ Bean å®šä¹‰å‘ IoC å®¹å™¨æ³¨å†Œå…¥å£</span><br>BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());<br>&#125;<br><span class="hljs-keyword">catch</span> (BeanDefinitionStoreException ex) &#123;<br>getReaderContext().error(<span class="hljs-string">&quot;Failed to register bean definition with name &#x27;&quot;</span> +<br>bdHolder.getBeanName() + <span class="hljs-string">&quot;&#x27;&quot;</span>, ele, ex);<br>&#125;<br><span class="hljs-comment">// åœ¨å®Œæˆå‘ Spring IoC å®¹å™¨æ³¨å†Œè§£æå¾—åˆ°çš„ Bean å®šä¹‰ä¹‹åï¼Œå‘é€æ³¨å†Œäº‹ä»¶</span><br>getReaderContext().fireComponentRegistered(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComponentDefinition</span>(bdHolder));<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç‚¹å‡» <code>parseBeanDefinitionElement()</code> æ–¹æ³•å¹¶è¿›å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> BeanDefinitionHolder <span class="hljs-title function_">parseBeanDefinitionElement</span><span class="hljs-params">(Element ele)</span> &#123;<br>    <span class="hljs-keyword">return</span> parseBeanDefinitionElement(ele, <span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å†ç‚¹å‡»è¿›å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">public</span> BeanDefinitionHolder <span class="hljs-title function_">parseBeanDefinitionElement</span><span class="hljs-params">(Element ele, <span class="hljs-meta">@Nullable</span> BeanDefinition containingBean)</span> &#123;<br>    <span class="hljs-comment">// è·å–&lt;bean&gt;å…ƒç´ ä¸­çš„ id å±æ€§</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> ele.getAttribute(ID_ATTRIBUTE);<br>    <span class="hljs-comment">// è·å–&lt;bean&gt;å…ƒç´ ä¸­çš„ name å±æ€§</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">nameAttr</span> <span class="hljs-operator">=</span> ele.getAttribute(NAME_ATTRIBUTE);<br><span class="hljs-comment">// è·å–&lt;bean&gt;å…ƒç´ ä¸­çš„ alias å±æ€§</span><br>    List&lt;String&gt; aliases = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-comment">// å°† &lt;bean&gt; å…ƒç´ ä¸­çš„æ‰€æœ‰ name å±æ€§å€¼å­˜æ”¾åˆ°åˆ«åä¸­</span><br>    <span class="hljs-keyword">if</span> (StringUtils.hasLength(nameAttr)) &#123;<br>        String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, MULTI_VALUE_ATTRIBUTE_DELIMITERS);<br>        aliases.addAll(Arrays.asList(nameArr));<br>    &#125;<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">beanName</span> <span class="hljs-operator">=</span> id;<br>    <span class="hljs-comment">// å¦‚æœ &lt;bean&gt; å…ƒç´ ä¸­æ²¡æœ‰é…ç½® id å±æ€§ï¼Œå°†åˆ«åä¸­çš„ç¬¬ä¸€ä¸ªå€¼èµ‹ç»™ beanName</span><br>    <span class="hljs-keyword">if</span> (!StringUtils.hasText(beanName) &amp;&amp; !aliases.isEmpty()) &#123;<br>        beanName = aliases.remove(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>            logger.trace(<span class="hljs-string">&quot;No XML &#x27;id&#x27; specified - using &#x27;&quot;</span> + beanName +<br>                         <span class="hljs-string">&quot;&#x27; as bean name and &quot;</span> + aliases + <span class="hljs-string">&quot; as aliases&quot;</span>);<br>        &#125;<br>    &#125;<br><span class="hljs-comment">// æ£€æŸ¥ &lt;bean&gt; å…ƒç´ æ‰€é…ç½®çš„ id æˆ–è€… name çš„å”¯ä¸€æ€§</span><br>    <span class="hljs-comment">// containingBean æ ‡è¯† &lt;bean&gt; å…ƒç´ ä¸­æ˜¯å¦åŒ…å«å­ &lt;bean&gt; å…ƒç´ </span><br>    <span class="hljs-keyword">if</span> (containingBean == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// æ£€æŸ¥ &lt;bean&gt; å…ƒç´ æ‰€é…ç½®çš„ idã€name æˆ–è€…åˆ«åæ˜¯å¦é‡å¤</span><br>        checkNameUniqueness(beanName, aliases, ele);<br>    &#125;<br><br>    <span class="hljs-comment">// è¯¦ç»†å¯¹ &lt;bean&gt; å…ƒç´ ä¸­é…ç½®çš„ Bean å®šä¹‰è¿›è¡Œè§£æ</span><br>    <span class="hljs-type">AbstractBeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> parseBeanDefinitionElement(ele, beanName, containingBean);<br><br>    <span class="hljs-keyword">if</span> (beanDefinition != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!StringUtils.hasText(beanName)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (containingBean != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">// å¦‚æœ &lt;bean&gt; å…ƒç´ ä¸­æ²¡æœ‰é…ç½® idã€name æˆ–è€…åˆ«åï¼Œä¸”æ²¡æœ‰åŒ…å«å­å…ƒç´ &lt;bean&gt; å…ƒç´ ï¼Œ</span><br>                    <span class="hljs-comment">// åˆ™ä¸ºè§£æçš„ Bean ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ beanName å¹¶æ³¨å†Œ</span><br>                    beanName = BeanDefinitionReaderUtils.generateBeanName(<br>                        beanDefinition, <span class="hljs-built_in">this</span>.readerContext.getRegistry(), <span class="hljs-literal">true</span>);<br>                &#125;<br>                <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// å¦‚æœ &lt;bean&gt; å…ƒç´ ä¸­æ²¡æœ‰é…ç½® idã€name æˆ–è€…åˆ«åï¼Œä¸”åŒ…å«å­å…ƒç´ &lt;bean&gt; å…ƒç´ ï¼Œ</span><br>                    <span class="hljs-comment">// åˆ™å°†è§£æçš„ Bean ä½¿ç”¨åˆ«åå‘ IoC å®¹å™¨æ³¨å†Œ</span><br>                    beanName = <span class="hljs-built_in">this</span>.readerContext.generateBeanName(beanDefinition);<br>                    <span class="hljs-comment">// ä¸ºè§£æçš„ Bean ä½¿ç”¨åˆ«åæ³¨å†Œæ—¶ï¼Œä¸ºäº†å‘åå…¼å®¹ Spring 1.2/2.0ï¼Œç»™åˆ«åæ·»åŠ ç±»ååç¼€</span><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">beanClassName</span> <span class="hljs-operator">=</span> beanDefinition.getBeanClassName();<br>                    <span class="hljs-keyword">if</span> (beanClassName != <span class="hljs-literal">null</span> &amp;&amp;<br>                        beanName.startsWith(beanClassName) &amp;&amp; beanName.length() &gt; beanClassName.length() &amp;&amp;<br>                        !<span class="hljs-built_in">this</span>.readerContext.getRegistry().isBeanNameInUse(beanClassName)) &#123;<br>                        aliases.add(beanClassName);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-comment">//....çœç•¥</span><br>            &#125;<br>            <span class="hljs-comment">//....çœç•¥</span><br>        &#125;<br>        String[] aliasesArray = StringUtils.toStringArray(aliases);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanDefinitionHolder</span>(beanDefinition, beanName, aliasesArray);<br>    &#125;<br><span class="hljs-comment">// å½“è§£æå‡ºé”™æ—¶ï¼Œè¿”å› null</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="DIæºç "><a href="#DIæºç " class="headerlink" title="DIæºç "></a>DIæºç </h1><h2 id="ä¾èµ–æ³¨å…¥å‘ç”Ÿæ—¶é—´"><a href="#ä¾èµ–æ³¨å…¥å‘ç”Ÿæ—¶é—´" class="headerlink" title="ä¾èµ–æ³¨å…¥å‘ç”Ÿæ—¶é—´"></a>ä¾èµ–æ³¨å…¥å‘ç”Ÿæ—¶é—´</h2><p>å½“ Spring IoC å®¹å™¨å®Œæˆäº† Bean å®šä¹‰èµ„æºçš„å®šä½ã€è½½å…¥å’Œè§£ææ³¨å†Œåï¼ŒIoC å®¹å™¨å°±å¯ä»¥ç®¡ç† Bean å®šä¹‰çš„ç›¸å…³æ•°æ®äº†ã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶ IoC å®¹å™¨è¿˜æ²¡æœ‰å¯¹æ‰€ç®¡ç†çš„ Bean è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œä¾èµ–æ³¨å…¥æ˜¯åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹äº§ç”Ÿçš„ï¼š</p><p>1ï¼‰å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨ getBean() æ–¹æ³•æ—¶ï¼ŒIoC å®¹å™¨è§¦å‘ä¾èµ–æ³¨å…¥ã€‚</p><p>2ï¼‰å½“ç”¨æˆ·åœ¨é…ç½®æ–‡ä»¶ä¸­å°† <code>&lt;bean&gt;</code>å…ƒç´ é…ç½®äº† <code>lazy-init=false</code> å±æ€§æ—¶ï¼ŒIoC å®¹å™¨æ‰ä¼šè¿›è¡Œé¢„å®ä¾‹åŒ–ï¼Œè§¦å‘ä¾èµ–æ³¨å…¥ã€‚</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111813030.png" alt="image-20220711181326945"></p><h2 id="å…¥å£-1"><a href="#å…¥å£-1" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;spring.xml&quot;</span>);<br><br><span class="hljs-type">UserDao</span> <span class="hljs-variable">userDao</span> <span class="hljs-operator">=</span> (UserDao) context.getBean(<span class="hljs-string">&quot;userDao&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="æ‰§è¡Œ-Bean-å®ä¾‹åŒ–"><a href="#æ‰§è¡Œ-Bean-å®ä¾‹åŒ–" class="headerlink" title="æ‰§è¡Œ Bean å®ä¾‹åŒ–"></a>æ‰§è¡Œ Bean å®ä¾‹åŒ–</h2><p>ç‚¹å‡»ä¸Šé¢ä¸­çš„ getBean() æ–¹æ³•ï¼Œè¿›å…¥ AbstractBeanFactory ç±»ä¸­çš„ getBean()  æ–¹æ³•ä¸­ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-comment">// çœŸæ­£å‘ IoC å®¹å™¨è·å–è¢«ç®¡ç†çš„ Bean</span><br>    <span class="hljs-keyword">return</span> doGetBean(name, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‡†å¤‡ä¾èµ–æ³¨å…¥"><a href="#å‡†å¤‡ä¾èµ–æ³¨å…¥" class="headerlink" title="å‡†å¤‡ä¾èµ–æ³¨å…¥"></a>å‡†å¤‡ä¾èµ–æ³¨å…¥</h2><p>è¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒæ˜¯è·å– IoC å®¹å™¨ä¸­æŒ‡å®šåç§°å’Œå‚æ•°çš„ Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> &lt;T&gt; T <span class="hljs-title function_">doGetBean</span><span class="hljs-params">(</span><br><span class="hljs-params">    String name, <span class="hljs-meta">@Nullable</span> Class&lt;T&gt; requiredType, <span class="hljs-meta">@Nullable</span> Object[] args, <span class="hljs-type">boolean</span> typeCheckOnly)</span><br>    <span class="hljs-keyword">throws</span> BeansException &#123;<br><br>    <span class="hljs-comment">// æ ¹æ®æŒ‡å®šåç§°è·å–è¢«ç®¡ç†çš„ Bean åç§°ï¼Œå‰¥ç¦»æŒ‡å®šåç§°ä¸­å¯¹å®¹å™¨çš„ç›¸å…³ä¾èµ–ï¼Œå¦‚æœæŒ‡å®šçš„æ˜¯åˆ«åï¼Œå°†åˆ«åè½¬æ¢ä¸ºè§„èŒƒçš„ Bean åç§°</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">beanName</span> <span class="hljs-operator">=</span> transformedBeanName(name);<br>    Object beanInstance;<br><br>    <span class="hljs-comment">// å…ˆä»ç¼“å­˜ä¸­è¯»å–æ˜¯å¦å·²ç»æœ‰è¢«åˆ›å»ºè¿‡å•ä¾‹æ¨¡å¼çš„ Bean,å¯¹äºæ•´ä¸ª IoC å®¹å™¨å•ä¾‹ Bean åªä¼šåˆ›å»ºä¸€æ¬¡</span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">sharedInstance</span> <span class="hljs-operator">=</span> getSingleton(beanName);<br>    <span class="hljs-keyword">if</span> (sharedInstance != <span class="hljs-literal">null</span> &amp;&amp; args == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>            <span class="hljs-comment">// å¦‚æœåœ¨å®¹å™¨ä¸­å·²æœ‰æŒ‡å®šåç§°çš„å•ä¾‹æ¨¡å¼çš„ Beanè¢«åˆ›å»ºï¼Œç›´æ¥è¿”å›å·²ç»åˆ›å»ºçš„Beanå¯¹è±¡</span><br>            <span class="hljs-keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;<br>                <span class="hljs-comment">///</span><br>            &#125;<br>            <span class="hljs-comment">//</span><br>        &#125;<br>        <span class="hljs-comment">// è·å–ç»™å®šçš„ Bean çš„å®ä¾‹å¯¹è±¡ï¼Œä¸»è¦å®Œæˆ FactoryBean çš„ç›¸å…³å¤„ç†</span><br>        <span class="hljs-comment">// æ³¨æ„ï¼šBeanFactoryæ˜¯ç®¡ç† Bean çš„å·¥å‚ï¼Œè€Œ FactoryBean æ˜¯åˆ›å»ºå¯¹è±¡çš„å·¥å‚ Beanï¼Œä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ã€‚</span><br>        beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// ç¼“å­˜ä¸­æ²¡æœ‰çœŸæ­£åœ¨åˆ›å»ºçš„å•ä¾‹æ¨¡å¼çš„ Beanï¼Œè€Œæ˜¯å­˜åœ¨åŸå‹æ¨¡å‹çš„ Beanï¼Œä½†æ˜¯ç”±äºæœ‰å¾ªç¯å¼•ç”¨å¯¼è‡´å®ä¾‹åŒ–å¯¹è±¡åˆ›å»ºå¤±è´¥</span><br>        <span class="hljs-keyword">if</span> (isPrototypeCurrentlyInCreation(beanName)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCurrentlyInCreationException</span>(beanName);<br>        &#125;<br><br>        <span class="hljs-comment">// å¯¹ IoC å®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šåç§°çš„ BeanDefinition è¿›è¡Œæ£€æŸ¥ï¼Œé¦–å…ˆæ£€æŸ¥æ˜¯å¦èƒ½åœ¨å½“å‰çš„ BeanFactory ä¸­è·å–æ‰€éœ€è¦çš„</span><br>        <span class="hljs-comment">// Bean,å¦‚æœä¸èƒ½åˆ™å§”æ‰˜å½“å‰å®¹å™¨çš„çˆ¶å®¹å™¨å»æŸ¥æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°åˆ™æ²¿ç€å®¹å™¨çš„ç»§æ‰¿å…³ç³»å‘çˆ¶å®¹å™¨æŸ¥æ‰¾ã€‚</span><br>        <span class="hljs-type">BeanFactory</span> <span class="hljs-variable">parentBeanFactory</span> <span class="hljs-operator">=</span> getParentBeanFactory();<br>        <span class="hljs-keyword">if</span> (parentBeanFactory != <span class="hljs-literal">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;<br>            <span class="hljs-comment">// è§£ææŒ‡å®š Bean åç§°çš„åŸå§‹åç§°</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">nameToLookup</span> <span class="hljs-operator">=</span> originalBeanName(name);<br>            <span class="hljs-keyword">if</span> (parentBeanFactory <span class="hljs-keyword">instanceof</span> AbstractBeanFactory) &#123;<br>                <span class="hljs-keyword">return</span> ((AbstractBeanFactory) parentBeanFactory).doGetBean(<br>                    nameToLookup, requiredType, args, typeCheckOnly);<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// å§”æ‰˜çˆ¶å®¹å™¨æ ¹æ®æŒ‡å®šåç§°å’Œæ˜¾ç¤ºçš„å‚æ•°æŸ¥æ‰¾</span><br>                <span class="hljs-keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (requiredType != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// å§”æ‰˜çˆ¶å®¹å™¨æ ¹æ®æŒ‡å®šåç§°å’Œç±»å‹æŸ¥æ‰¾</span><br>                <span class="hljs-keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// åˆ›å»ºçš„ Bean æ˜¯å¦éœ€è¦è¿›è¡Œç±»å‹éªŒè¯ï¼Œä¸€èˆ¬ä¸éœ€è¦</span><br>        <span class="hljs-keyword">if</span> (!typeCheckOnly) &#123;<br>            <span class="hljs-comment">// å‘å®¹å™¨æ ‡è®°æŒ‡å®šçš„ Bean å·²ç»è¢«åˆ›å»º</span><br>            markBeanAsCreated(beanName);<br>        &#125;<br><br>        <span class="hljs-type">StartupStep</span> <span class="hljs-variable">beanCreation</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationStartup.start(<span class="hljs-string">&quot;spring.beans.instantiate&quot;</span>)<br>            .tag(<span class="hljs-string">&quot;beanName&quot;</span>, name);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (requiredType != <span class="hljs-literal">null</span>) &#123;<br>                beanCreation.tag(<span class="hljs-string">&quot;beanType&quot;</span>, requiredType::toString);<br>            &#125;<br>            <span class="hljs-comment">// æ ¹æ®æŒ‡å®š Bean åç§°è·å¾—å…¶çˆ¶çº§ Bean å®šä¹‰ï¼Œä¸»è¦è§£å†³ Bean ç»§æ‰¿æ—¶å­ç±»å’Œçˆ¶ç±»å…¬å…±å±æ€§é—®é¢˜</span><br>            <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">mbd</span> <span class="hljs-operator">=</span> getMergedLocalBeanDefinition(beanName);<br>            checkMergedBeanDefinition(mbd, beanName, args);<br><br>            <span class="hljs-comment">// è·å–å½“å‰ Bean æ‰€ä¾èµ–çš„ Bean åç§°</span><br>            String[] dependsOn = mbd.getDependsOn();<br>            <span class="hljs-comment">// å¦‚æœå½“å‰ Bean æœ‰ä¾èµ–</span><br>            <span class="hljs-keyword">if</span> (dependsOn != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">for</span> (String dep : dependsOn) &#123;<br>                    <span class="hljs-keyword">if</span> (isDependent(beanName, dep)) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,<br>                                                        <span class="hljs-string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>                    &#125;<br>                    <span class="hljs-comment">// æŠŠè¢«ä¾èµ–çš„ Bean æ³¨å†Œç»™å½“å‰ä¾èµ–çš„ Bean</span><br>                    registerDependentBean(dep, beanName);<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-comment">// é€’å½’è°ƒç”¨ getBean() æ–¹æ³•ï¼Œè·å–å½“å‰ Bean çš„æ‰€æœ‰ä¾èµ–</span><br>                        getBean(dep);<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,<br>                                                        <span class="hljs-string">&quot;&#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="hljs-string">&quot;&#x27;&quot;</span>, ex);<br>                    &#125;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// åˆ›å»ºå•ä¾‹æ¨¡å¼çš„ Bean å®ä¾‹å¯¹è±¡</span><br>            <span class="hljs-keyword">if</span> (mbd.isSingleton()) &#123;<br>                sharedInstance = getSingleton(beanName, () -&gt; &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-keyword">return</span> createBean(beanName, mbd, args);<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>                        <span class="hljs-comment">// Explicitly remove instance from singleton cache: It might have been put there</span><br>                        <span class="hljs-comment">// eagerly by the creation process, to allow for circular reference resolution.</span><br>                        <span class="hljs-comment">// Also remove any beans that received a temporary reference to the bean.</span><br>                        destroySingleton(beanName);<br>                        <span class="hljs-keyword">throw</span> ex;<br>                    &#125;<br>                &#125;);<br>                beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);<br>            &#125;<br><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mbd.isPrototype()) &#123;<br>                <span class="hljs-comment">// It&#x27;s a prototype -&gt; create a new instance.</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">prototypeInstance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    beforePrototypeCreation(beanName);<br>                    prototypeInstance = createBean(beanName, mbd, args);<br>                &#125;<br>                <span class="hljs-keyword">finally</span> &#123;<br>                    afterPrototypeCreation(beanName);<br>                &#125;<br>                beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);<br>            &#125;<br><br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">scopeName</span> <span class="hljs-operator">=</span> mbd.getScope();<br>                <span class="hljs-keyword">if</span> (!StringUtils.hasLength(scopeName)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;No scope name defined for bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>                &#125;<br>                <span class="hljs-type">Scope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.scopes.get(scopeName);<br>                <span class="hljs-keyword">if</span> (scope == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;No Scope registered for scope name &#x27;&quot;</span> + scopeName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">scopedInstance</span> <span class="hljs-operator">=</span> scope.get(beanName, () -&gt; &#123;<br>                        beforePrototypeCreation(beanName);<br>                        <span class="hljs-keyword">try</span> &#123;<br>                            <span class="hljs-keyword">return</span> createBean(beanName, mbd, args);<br>                        &#125;<br>                        <span class="hljs-keyword">finally</span> &#123;<br>                            afterPrototypeCreation(beanName);<br>                        &#125;<br>                    &#125;);<br>                    beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);<br>                &#125;<br>                <span class="hljs-keyword">catch</span> (IllegalStateException ex) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScopeNotActiveException</span>(beanName, scopeName, ex);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>            beanCreation.tag(<span class="hljs-string">&quot;exception&quot;</span>, ex.getClass().toString());<br>            beanCreation.tag(<span class="hljs-string">&quot;message&quot;</span>, String.valueOf(ex.getMessage()));<br>            cleanupAfterBeanCreationFailure(beanName);<br>            <span class="hljs-keyword">throw</span> ex;<br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            beanCreation.end();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> adaptBeanInstance(name, beanInstance, requiredType);<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å‘ IoC å®¹å™¨è·å– Bean çš„æ–¹æ³•çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Spring ä¸­å¦‚æœ Bean å®šä¹‰ä¸ºå•ä¾‹æ¨¡å¼ï¼Œåˆ™å®¹å™¨åœ¨åˆ›å»ºä¹‹å‰å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œä»¥ç¡®ä¿æ•´ä¸ªå®¹å™¨ä¸­åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚å¦‚æœ Bean å®šä¹‰ä¸ºåŸå‹æ¨¡å¼ï¼Œåˆ™å®¹å™¨æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ã€‚</p><h2 id="å¼€å§‹å®ä¾‹åŒ–"><a href="#å¼€å§‹å®ä¾‹åŒ–" class="headerlink" title="å¼€å§‹å®ä¾‹åŒ–"></a>å¼€å§‹å®ä¾‹åŒ–</h2><p>ç‚¹å‡»ä¸Šé¢ä»£ç ä¸­çš„ <code>return createBean(beanName, mbd, args);</code> æ–¹æ³•ï¼Œè¿›å…¥AbstractAutowireCapableBeanFactory ç±»ä¸­çš„ createBean() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">createBean</span><span class="hljs-params">(String beanName, RootBeanDefinition mbd, <span class="hljs-meta">@Nullable</span> Object[] args)</span><br>    <span class="hljs-keyword">throws</span> BeanCreationException &#123;<br><br>    <span class="hljs-comment">//....çœç•¥</span><br>    <br>    <span class="hljs-type">RootBeanDefinition</span> <span class="hljs-variable">mbdToUse</span> <span class="hljs-operator">=</span> mbd;<br><br>    <span class="hljs-comment">// åˆ¤æ–­æ‰€éœ€è¦åˆ›å»ºçš„ Beanæ˜¯å¦å¯ä»¥å®ä¾‹åŒ–ï¼Œå³æ˜¯å¦è¦é€šè¿‡å½“å‰çš„ç±»åŠ è½½å™¨åŠ è½½</span><br>    Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);<br>    <span class="hljs-keyword">if</span> (resolvedClass != <span class="hljs-literal">null</span> &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != <span class="hljs-literal">null</span>) &#123;<br>        mbdToUse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RootBeanDefinition</span>(mbd);<br>        mbdToUse.setBeanClass(resolvedClass);<br>    &#125;<br><br>    <span class="hljs-comment">// æ ¡éªŒå’Œå‡†å¤‡ Bean ä¸­çš„æ–¹æ³•è¦†ç›–</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        mbdToUse.prepareMethodOverrides();<br>    &#125;<br>    <span class="hljs-comment">//...çœç•¥</span><br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœ Bean é…ç½®äº†åˆå§‹åŒ–å‰å’Œåˆå§‹åŒ–åçš„å¤„ç†å™¨ï¼Œåˆ™è¯•å›¾è¿”å›ä¸€ä¸ªéœ€è¦åˆ›å»ºçš„ Bean ä»£ç†å¯¹è±¡</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> resolveBeforeInstantiation(beanName, mbdToUse);<br>        <span class="hljs-keyword">if</span> (bean != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> bean;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//.....çœç•¥</span><br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»º Bean å…¥å£</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">beanInstance</span> <span class="hljs-operator">=</span> doCreateBean(beanName, mbdToUse, args);<br>        <span class="hljs-comment">//.....çœç•¥</span><br>        <span class="hljs-keyword">return</span> beanInstance;<br>    &#125;<br>    <span class="hljs-comment">//.....çœç•¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>doCreateBean()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">doCreateBean</span><span class="hljs-params">(String beanName, RootBeanDefinition mbd, <span class="hljs-meta">@Nullable</span> Object[] args)</span><br><span class="hljs-keyword">throws</span> BeanCreationException &#123;<br><br><span class="hljs-comment">// å°è£…è¢«åˆ›å»ºçš„ Bean å¯¹è±¡</span><br><span class="hljs-type">BeanWrapper</span> <span class="hljs-variable">instanceWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (mbd.isSingleton()) &#123;<br>instanceWrapper = <span class="hljs-built_in">this</span>.factoryBeanInstanceCache.remove(beanName);<br>&#125;<br><span class="hljs-keyword">if</span> (instanceWrapper == <span class="hljs-literal">null</span>) &#123;<br>instanceWrapper = createBeanInstance(beanName, mbd, args);<br>&#125;<br><span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> instanceWrapper.getWrappedInstance();<br>    <span class="hljs-comment">// è·å–å®ä¾‹åŒ–å¯¹è±¡çš„ç±»å‹</span><br>Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();<br><span class="hljs-keyword">if</span> (beanType != NullBean.class) &#123;<br>mbd.resolvedTargetType = beanType;<br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨ PostProcess åç½®å¤„ç†å™¨</span><br><span class="hljs-keyword">synchronized</span> (mbd.postProcessingLock) &#123;<br><span class="hljs-keyword">if</span> (!mbd.postProcessed) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);<br>&#125;<br><span class="hljs-comment">//......çœç•¥</span><br>mbd.postProcessed = <span class="hljs-literal">true</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// å‘å®¹å™¨ä¸­ç¼“å­˜å•ä¾‹æ¨¡å¼çš„ Bean å¯¹è±¡ï¼Œä»¥é˜²æ­¢å¾ªç¯å¼•ç”¨</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">earlySingletonExposure</span> <span class="hljs-operator">=</span> (mbd.isSingleton() &amp;&amp; <span class="hljs-built_in">this</span>.allowCircularReferences &amp;&amp;<br>isSingletonCurrentlyInCreation(beanName));<br><span class="hljs-keyword">if</span> (earlySingletonExposure) &#123;<br><span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br><span class="hljs-comment">//</span><br>&#125;<br>            <span class="hljs-comment">// ä½¿ç”¨ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œä¸ºäº†é˜²æ­¢å¾ªç¯å¼•ç”¨ï¼Œå°½æ—©æŒæœ‰å¯¹è±¡çš„å¼•ç”¨</span><br>addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));<br>&#125;<br><br><span class="hljs-comment">// Bean å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œä¾èµ–æ³¨å…¥åœ¨æ­¤å¤„è§¦å‘ï¼Œè¿™ä¸ª exposedObject å¯¹è±¡åœ¨åˆå§‹åŒ–å®Œæˆåè¿”å›ä¾èµ–æ³¨å…¥å®Œæˆçš„ Bean</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">exposedObject</span> <span class="hljs-operator">=</span> bean;<br><span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å°† Bean å®ä¾‹å¯¹è±¡å°è£…ï¼Œå¹¶ä¸”å°† Bean å®šä¹‰ä¸­é…ç½®çš„å±æ€§èµ‹ç»™å®ä¾‹å¯¹è±¡</span><br>populateBean(beanName, mbd, instanceWrapper);<br>            <span class="hljs-comment">// åˆå§‹åŒ– Bean å¯¹è±¡</span><br>exposedObject = initializeBean(beanName, exposedObject, mbd);<br>&#125;<br><span class="hljs-comment">//.........</span><br><br><span class="hljs-keyword">if</span> (earlySingletonExposure) &#123;<br>            <span class="hljs-comment">// è·å–æŒ‡å®šåç§°çš„å·²æ³¨å†Œçš„å•ä¾‹æ¨¡å¼çš„ Bean å¯¹è±¡</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">earlySingletonReference</span> <span class="hljs-operator">=</span> getSingleton(beanName, <span class="hljs-literal">false</span>);<br><span class="hljs-keyword">if</span> (earlySingletonReference != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (exposedObject == bean) &#123;<br>                    <span class="hljs-comment">// å®Œæˆåˆå§‹åŒ–</span><br>exposedObject = earlySingletonReference;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123;<br>String[] dependentBeans = getDependentBeans(beanName);<br>Set&lt;String&gt; actualDependentBeans = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(dependentBeans.length);<br><span class="hljs-keyword">for</span> (String dependentBean : dependentBeans) &#123;<br><span class="hljs-keyword">if</span> (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;<br>actualDependentBeans.add(dependentBean);<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span> (!actualDependentBeans.isEmpty()) &#123;<br><span class="hljs-comment">//......</span><br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// æ³¨å†Œå®Œæˆä¾èµ–æ³¨å…¥çš„ Bean</span><br><span class="hljs-keyword">try</span> &#123;<br>registerDisposableBeanIfNecessary(beanName, bean, mbd);<br>&#125;<br><span class="hljs-comment">//.....</span><br><br><span class="hljs-keyword">return</span> exposedObject;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æºç æ³¨é‡Šå¯ä»¥çœ‹åˆ°ï¼Œå…·ä½“çš„ä¾èµ–æ³¨å…¥å®ç°å…¶å®å°±åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ä¸­ï¼š</p><p>1ï¼‰createBeanInstance() æ–¹æ³•ï¼Œç”Ÿæˆ Bean æ‰€åŒ…å«çš„ Java å¯¹è±¡å®ä¾‹ã€‚</p><p>2ï¼‰populateBean() æ–¹æ³•ï¼Œå¯¹ Bean å±æ€§çš„ä¾èµ–æ³¨å…¥è¿›è¡Œå¤„ç†ã€‚</p><p>è¿›å…¥ createBeanInstance() æ–¹æ³•ï¼Œç„¶åç‚¹å‡» instantiate() æ–¹æ³•ï¼Œè¿›å…¥ SimpleInstantiationStrategy ç±»ä¸­çš„ instantiate() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">instantiate</span><span class="hljs-params">(RootBeanDefinition bd, <span class="hljs-meta">@Nullable</span> String beanName, BeanFactory owner)</span> &#123;<br>    <span class="hljs-comment">// å¦‚æœ Bean å®šä¹‰ä¸­æ²¡æœ‰æ–¹æ³•è¦†ç›–ï¼Œå°±ä¸éœ€è¦ CGLib çˆ¶ç±»çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">if</span> (!bd.hasMethodOverrides()) &#123;<br>        Constructor&lt;?&gt; constructorToUse;<br>        <span class="hljs-keyword">synchronized</span> (bd.constructorArgumentLock) &#123;<br>            <span class="hljs-comment">// è·å–å¯¹è±¡çš„æ„é€ æ–¹æ³•æˆ–å·¥å‚æ–¹æ³•</span><br>            constructorToUse = (Constructor&lt;?&gt;) bd.resolvedConstructorOrFactoryMethod;<br>            <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ„é€ å™¨æ–¹æ³•æˆ–å·¥å‚æ–¹æ³•</span><br>            <span class="hljs-keyword">if</span> (constructorToUse == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// ä½¿ç”¨ JDK çš„åå°„æœºåˆ¶ï¼Œåˆ¤æ–­è¦å®ä¾‹åŒ–çš„ Bean æ˜¯å¦æ˜¯æ¥å£</span><br>                <span class="hljs-keyword">final</span> Class&lt;?&gt; clazz = bd.getBeanClass();<br>                <span class="hljs-keyword">if</span> (clazz.isInterface()) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanInstantiationException</span>(clazz, <span class="hljs-string">&quot;Specified class is an interface&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-literal">null</span>) &#123;<br>                        constructorToUse = AccessController.doPrivileged(<br>                            (PrivilegedExceptionAction&lt;Constructor&lt;?&gt;&gt;) clazz::getDeclaredConstructor);<br>                    &#125;<br>                    <span class="hljs-keyword">else</span> &#123;<br>                        constructorToUse = clazz.getDeclaredConstructor();<br>                    &#125;<br>                    bd.resolvedConstructorOrFactoryMethod = constructorToUse;<br>                &#125;<br>                <span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanInstantiationException</span>(clazz, <span class="hljs-string">&quot;No default constructor found&quot;</span>, ex);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// ä½¿ç”¨ BeanUtils è¿›è¡Œå®ä¾‹åŒ–ï¼Œé€šè¿‡åå°„æœºåˆ¶è°ƒç”¨ æ„é€ å™¨æ–¹æ³•.newInstance(arg) è¿›è¡Œå®ä¾‹åŒ–</span><br>        <span class="hljs-keyword">return</span> BeanUtils.instantiateClass(constructorToUse);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ CGLib æ¥å®ä¾‹åŒ–å¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> instantiateWithMethodInjection(bd, beanName, owner);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h1><p>åœ¨ Spring ä¸­Beançš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸º 4 ç±»ï¼š</p><ul><li>Bean è‡ªèº«æ–¹æ³•</li><li>Bean ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•</li><li>å®¹å™¨çº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•</li><li>å·¥å‚åå¤„ç†å™¨æ¥å£æ–¹æ³•</li></ul><table><thead><tr><th>Spring Bean ç”Ÿå‘½å‘¨æœŸ</th><th>ç›¸å…³æ¥å£åŠæ–¹æ³•</th></tr></thead><tbody><tr><td>Bean è‡ªèº«æ–¹æ³•</td><td>Bean æœ¬èº«ä¸šåŠ¡çš„æ–¹æ³•ï¼š<br>é…ç½®æ–‡ä»¶ä¸­ init-method å’Œ destroy-method æŒ‡å®šçš„æ–¹æ³•</td></tr><tr><td>Bean ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•</td><td>InitializingBean æ¥å£<br>DisposableBean æ¥å£<br>BeanNameAware æ¥å£<br>ApplicationContextAware æ¥å£<br>BeanFactoryAware æ¥å£<br>å…¶å®ƒ</td></tr><tr><td>å®¹å™¨çº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•<br>ä¸€èˆ¬ç§°ä¸ºåå¤„ç†å™¨</td><td>InstantiationAwareBeanPostProcessor æ¥å£å®ç°<br>BeanPostProcessor æ¥å£å®ç°</td></tr><tr><td>å·¥å‚çº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•<br>ä¹Ÿå¯ä»¥å½’ä¸ºå®¹å™¨çº§</td><td>AspectJWeavingEnabler<br>ConfigurationClassPostProcessor<br>CustomAutowireConfigurer ç­‰</td></tr></tbody></table><p>ä¸€ä¸ª Bean çš„ç”Ÿå‘½å‘¨æœŸéœ€è¦ç»å†ä»¥ä¸‹æ—¶åºï¼š</p><ul><li>init-methodï¼šæŒ‡å®šæŸä¸ªæ–¹æ³•åœ¨ Bean å®ä¾‹åŒ–å®Œæˆï¼Œä¾èµ–å…³ç³»è®¾ç½®ç»“æŸåæ‰§è¡Œ</li><li>detroy-methodï¼šæŒ‡å®šæŸä¸ªæ–¹æ³•åœ¨ Bean é”€æ¯ä¹‹å‰è¢«æ‰§è¡Œ</li><li>InitializingBean æ¥å£ï¼šåœ¨ Bean å®ä¾‹åŒ–å®Œæˆï¼Œä¾èµ–å…³ç³»è®¾ç½®ç»“æŸåæ‰§è¡Œï¼Œåœ¨ init-method ä¹‹å‰æ‰§è¡Œ</li><li>DisposableBean æ¥å£ï¼šåœ¨æŒ‡å®š Bean Bean é”€æ¯ä¹‹å‰è¢«æ‰§è¡Œï¼Œå®ƒæ˜¯åœ¨ detroy-method ä¹‹å‰æ‰§è¡Œ</li><li>ApplicationContextAware æ¥å£ï¼šåœ¨å®ä¾‹åŒ– Bean æ—¶ï¼Œä¸º Bean æ³¨å…¥ ApplicationContext</li></ul><h1 id="é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–"><a href="#é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–" class="headerlink" title="é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–"></a>é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–</h1><h2 id="ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–ï¼Ÿ</h2><p>æ‰€è°“å¾ªç¯ä¾èµ–ï¼Œå°±æ˜¯ A çš„åˆ›å»ºä¾èµ–äº B çš„åˆ›å»ºï¼ŒB çš„åˆ›å»ºåˆä¾èµ–äº C çš„åˆ›å»ºï¼Œè€Œ C çš„åˆ›å»ºåˆä¾èµ–äº A çš„åˆ›å»ºã€‚</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111809026.png" alt="image-20220711180949895"></p><p>è¿™å°±å½¢æˆäº†å¾ªç¯ä¾èµ–</p><h2 id="åœ¨Springä¸­ä½¿ç”¨å¾ªç¯ä¾èµ–"><a href="#åœ¨Springä¸­ä½¿ç”¨å¾ªç¯ä¾èµ–" class="headerlink" title="åœ¨Springä¸­ä½¿ç”¨å¾ªç¯ä¾èµ–"></a>åœ¨Springä¸­ä½¿ç”¨å¾ªç¯ä¾èµ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> BService bService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(bService);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AService aService;<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(&quot;com.xianoupeng&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CycleDITest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);<br>        <span class="hljs-type">AService</span> <span class="hljs-variable">aService</span> <span class="hljs-operator">=</span> (AService) context.getBean(<span class="hljs-string">&quot;AService&quot;</span>);<br>        aService.show();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æµ‹è¯•å‘ç°ï¼Œåœ¨ Spring ä¸­å·²ç»å¸®æˆ‘ä»¬è§£å†³ä¸€äº›å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚</p><h2 id="åˆ†æè§£å†³å¾ªç¯ä¾èµ–çš„è§£å†³"><a href="#åˆ†æè§£å†³å¾ªç¯ä¾èµ–çš„è§£å†³" class="headerlink" title="åˆ†æè§£å†³å¾ªç¯ä¾èµ–çš„è§£å†³"></a>åˆ†æè§£å†³å¾ªç¯ä¾èµ–çš„è§£å†³</h2><p>åœ¨ Spring ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡éœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š</p><p>1ï¼‰åˆ©ç”¨æ„é€ å™¨åˆ›å»ºä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼ˆä¹Ÿå«åŸå§‹å¯¹è±¡ï¼‰</p><p>2ï¼‰ç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼ï¼Œä¹Ÿå°±å¡«å……å¯¹è±¡çš„å±æ€§å€¼</p><p>3ï¼‰å¡«å……å…¶ä»–å±æ€§</p><p>4ï¼‰åˆå§‹åŒ–å‰ã€åˆå§‹åŒ–å®Œæˆï¼Œä»¥åŠå…¶å®ƒæ“ä½œ</p><p>5ï¼‰åˆå§‹åŒ–å</p><p>6ï¼‰æŠŠåˆ›å»ºå¹¶åˆå§‹åŒ–çš„å¯¹è±¡æ”¾åˆ°å•ä¾‹æ± ä¸­ï¼ˆsingletoObjectsï¼‰é‡Œé¢ã€‚</p><p>åœ¨ Spring ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ª Map å¯¹è±¡æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼š</p><p>1ã€ä¸€çº§ç¼“å­˜ï¼šsingletonObjectsï¼Œåœ¨è¿™çº§ç¼“å­˜ä¸­å·²ç»ç»å†å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸçš„ Bean å¯¹è±¡</p><p>2ã€äºŒçº§ç¼“å­˜ï¼šearlySingletonObjectsï¼Œæ¯”ä¸€çº§ç¼“å­˜å¤šäº†ä¸€ä¸ª earlyï¼Œè¡¨ç¤ºç¼“å­˜çš„æ˜¯æ—©æœŸçš„ Bean å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ Bean çš„ç”Ÿå‘½å‘¨æœŸè¿˜æ²¡æœ‰èµ°å®Œå°±æŠŠè¿™ä¸ª Bean æ”¾åˆ°äº†äºŒçº§ç¼“å­˜ä¸­ã€‚</p><p>3ã€ä¸‰çº§ç¼“å­˜ï¼šsingletonFactoriesï¼Œç¼“å­˜çš„æ˜¯ ObjectFactory ï¼Œè¡¨ç¤ºå¯¹è±¡å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºæŸä¸ªå¯¹è±¡ã€‚</p><p>å®é™…ä¸Šï¼Œå¤§å¤šæ•°æ®å¼€å‘éƒ¨ä¸‹ä½¿ç”¨ä¸€çº§ç¼“å­˜å°±å¯ä»¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå¦‚æœåœ¨å¾ªç¯ä¾èµ–ä¸­å­˜åœ¨ä¸€äº›å¾ªç¯çš„å±æ€§éœ€è¦æ³¨å…¥ï¼Œæ¯”å¦‚ AOP ç›¸å…³çš„æ•°æ®éœ€è¦æ³¨å…¥ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ ä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111810393.png" alt="image-20220711181002276"></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥å‘ç”Ÿï¼ŒSpring åœ¨å¤„ç†å¾ªç¯ä¾èµ–é—®é¢˜æ—¶ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜å°±å·²ç»è§£å†³ï¼Œä½†å®ƒä¸èƒ½è§£å†³å¤æ‚çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚è¦æƒ³è§£å†³å¤æ‚çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå°±éœ€è¦ç”¨åˆ°ä¸‰çº§ç¼“å­˜ã€‚</p><p>å¤„ç†å¾ªç¯ä¾èµ–é—®é¢˜çš„æºç ï¼š</p><p>AbstractAutowireCapableBeanFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">doCreateBean</span><span class="hljs-params">(String beanName, RootBeanDefinition mbd, <span class="hljs-meta">@Nullable</span> Object[] args)</span><br><span class="hljs-keyword">throws</span> BeanCreationException &#123;<br><br><span class="hljs-comment">// Instantiate the bean.</span><br><span class="hljs-type">BeanWrapper</span> <span class="hljs-variable">instanceWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (mbd.isSingleton()) &#123;<br>instanceWrapper = <span class="hljs-built_in">this</span>.factoryBeanInstanceCache.remove(beanName);<br>&#125;<br><span class="hljs-keyword">if</span> (instanceWrapper == <span class="hljs-literal">null</span>) &#123;<br>instanceWrapper = createBeanInstance(beanName, mbd, args);<br>&#125;<br><span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> instanceWrapper.getWrappedInstance();<br>Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();<br><span class="hljs-keyword">if</span> (beanType != NullBean.class) &#123;<br>mbd.resolvedTargetType = beanType;<br>&#125;<br><br><span class="hljs-comment">// Allow post-processors to modify the merged bean definition.</span><br><span class="hljs-keyword">synchronized</span> (mbd.postProcessingLock) &#123;<br><span class="hljs-keyword">if</span> (!mbd.postProcessed) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);<br>&#125;<br><span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,<br><span class="hljs-string">&quot;Post-processing of merged bean definition failed&quot;</span>, ex);<br>&#125;<br>mbd.postProcessed = <span class="hljs-literal">true</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// å…³é”®ä»£ç </span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">earlySingletonExposure</span> <span class="hljs-operator">=</span> (mbd.isSingleton() &amp;&amp; <span class="hljs-built_in">this</span>.allowCircularReferences &amp;&amp;<br>isSingletonCurrentlyInCreation(beanName));<br><span class="hljs-keyword">if</span> (earlySingletonExposure) &#123;<br><span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>logger.trace(<span class="hljs-string">&quot;Eagerly caching bean &#x27;&quot;</span> + beanName +<br><span class="hljs-string">&quot;&#x27; to allow for resolving potential circular references&quot;</span>);<br>&#125;<br>addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));<br>&#125;<br><br><span class="hljs-comment">// Initialize the bean instance.</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">exposedObject</span> <span class="hljs-operator">=</span> bean;<br><span class="hljs-keyword">try</span> &#123;<br>populateBean(beanName, mbd, instanceWrapper);<br>exposedObject = initializeBean(beanName, exposedObject, mbd);<br>&#125;<br><span class="hljs-comment">//.....</span><br><br><span class="hljs-keyword">if</span> (earlySingletonExposure) &#123;<br>            <span class="hljs-comment">// æ ¸å¿ƒ</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">earlySingletonReference</span> <span class="hljs-operator">=</span> getSingleton(beanName, <span class="hljs-literal">false</span>);<br><span class="hljs-keyword">if</span> (earlySingletonReference != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (exposedObject == bean) &#123;<br>exposedObject = earlySingletonReference;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123;<br>String[] dependentBeans = getDependentBeans(beanName);<br>Set&lt;String&gt; actualDependentBeans = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(dependentBeans.length);<br><span class="hljs-keyword">for</span> (String dependentBean : dependentBeans) &#123;<br><span class="hljs-keyword">if</span> (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;<br>actualDependentBeans.add(dependentBean);<br>&#125;<br>&#125;<br><span class="hljs-comment">///......</span><br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// .....</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ getSingleton() æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">getSingleton</span><span class="hljs-params">(String beanName, <span class="hljs-type">boolean</span> allowEarlyReference)</span> &#123;<br><span class="hljs-comment">// ä»ä¸€çº§ç¼“å­˜ä¸­è·å–</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">singletonObject</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.singletonObjects.get(beanName);<br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ­£åœ¨åˆ›å»ºä¸­</span><br><span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;<br>            <span class="hljs-comment">// ä»äºŒç¼“å­˜ä¸­è·å–</span><br>singletonObject = <span class="hljs-built_in">this</span>.earlySingletonObjects.get(beanName);<br>            <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¹¶ä¸”å…è®¸å¾ªç¯å¼•ç”¨</span><br><span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span> &amp;&amp; allowEarlyReference) &#123;<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.singletonObjects) &#123;<br><span class="hljs-comment">// åŒé‡åŠ é”</span><br>singletonObject = <span class="hljs-built_in">this</span>.singletonObjects.get(beanName);<br><span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span>) &#123;<br>singletonObject = <span class="hljs-built_in">this</span>.earlySingletonObjects.get(beanName);<br><span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-comment">// ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–</span><br>ObjectFactory&lt;?&gt; singletonFactory = <span class="hljs-built_in">this</span>.singletonFactories.get(beanName);<br><span class="hljs-keyword">if</span> (singletonFactory != <span class="hljs-literal">null</span>) &#123;<br>                                <span class="hljs-comment">// æ‰§è¡Œ lambda è¡¨è¾¾å¼</span><br>singletonObject = singletonFactory.getObject();<br><span class="hljs-built_in">this</span>.earlySingletonObjects.put(beanName, singletonObject);<br><span class="hljs-built_in">this</span>.singletonFactories.remove(beanName);<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> singletonObject;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><p>AOPï¼ˆAspect Oriented Programmingï¼‰é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è¡¥å……ã€‚</p><p>åœ¨ Spring ä¸­ï¼ŒAOP çš„å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œè¦æ±‚è¢«å¢å¼ºï¼ˆä»£ç†ï¼‰å¯¹è±¡å¿…é¡»å®ç°æ¥å£</li><li>ä½¿ç”¨ CGLib åŠ¨æ€ä»£ç†</li></ul><p>åœ¨ Spring ä¸­ä¸¤ç§æ–¹å¼éƒ½æœ‰ï¼Œå¦‚æœè¢«ä»£ç†å¯¹è±¡å®ç°äº†æ¥å£å°±ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™å°±ä½¿ç”¨ CGLib åŠ¨æ€ä»£ç†ã€‚é»˜è®¤ä½¿ç”¨çš„æ˜¯ JDK åŠ¨æ€ä»£ç†ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ä½¿ç”¨ä½•ç§ä»£ç†æ–¹å¼ã€‚</p><h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><h3 id="1-æ¨ªåˆ‡å…³æ³¨ç‚¹"><a href="#1-æ¨ªåˆ‡å…³æ³¨ç‚¹" class="headerlink" title="1. æ¨ªåˆ‡å…³æ³¨ç‚¹"></a>1. æ¨ªåˆ‡å…³æ³¨ç‚¹</h3><p>ç®€å•çš„è¯´ï¼Œæ¨ªåˆ‡å…³æ³¨ç‚¹å°±æ˜¯å¯ä»¥å¯¹æŸäº›æ–¹æ³•è¿›è¡Œæ‹¦æˆªï¼Œæ‹¦æˆªåå¯¹åŸæ–¹æ³•è¿›è¡Œå¢å¼ºçš„å¤„ç†ã€‚</p><h3 id="2-åˆ‡é¢"><a href="#2-åˆ‡é¢" class="headerlink" title="2. åˆ‡é¢"></a>2. åˆ‡é¢</h3><p>åˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡ï¼Œè¿™ä¸ªå…³æ³¨ç‚¹å¯èƒ½ä¼šæ¨ªåˆ‡å¤šä¸ªå¯¹è±¡ã€‚ç®€å•çš„è¯´å°±æ˜¯ç”¨äºå¢å¼ºçš„ç±»ã€‚</p><h3 id="3-è¿æ¥ç‚¹"><a href="#3-è¿æ¥ç‚¹" class="headerlink" title="3. è¿æ¥ç‚¹"></a>3. è¿æ¥ç‚¹</h3><p>è¿æ¥ç‚¹æ˜¯åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æŸä¸ªç‰¹å®šçš„ç‚¹ï¼Œå¦‚æŸä¸ªæ–¹æ³•è°ƒç”¨æ—¶æˆ–è€…å¤„ç†å¼‚å¸¸çš„æ—¶ã€‚</p><h3 id="4-åˆ‡å…¥ç‚¹"><a href="#4-åˆ‡å…¥ç‚¹" class="headerlink" title="4. åˆ‡å…¥ç‚¹"></a>4. åˆ‡å…¥ç‚¹</h3><p>åœ¨åˆ‡é¢ä¸Šæ‹¦æˆªåˆ°æŸä¸ªç‰¹å®šçš„è¿æ¥ç‚¹ä¹‹åæ‰§è¡Œçš„åŠ¨ä½œã€‚</p><h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><p>åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aspects<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>aopalliance<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aopalliance<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ç¼–å†™æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Fruit</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¼–å†™ä¸¤ä¸ªå®ç°ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.service.impl;<br><span class="hljs-keyword">import</span> org.example.service.Fruit;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Apple</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Fruit</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æ¨¡æ‹Ÿåƒæ°´æœçš„è¿‡ç¨‹</span><br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;åƒè‹¹æœ&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Banana</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Fruit</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æ¨¡æ‹Ÿåƒé¦™è•‰çš„è¿‡ç¨‹</span><br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;åƒé¦™è•‰&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¼–å†™åˆ‡é¢</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.aop;<br><br><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FruitHandler</span> &#123;<br>    <span class="hljs-comment">// æ‰“å°å¼€å§‹åƒæ°´æœæ—¶é—´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startEatFruitDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">startDate</span> <span class="hljs-operator">=</span> sdf.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹åƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š&quot;</span> + startDate);<br>    &#125;<br>    <span class="hljs-comment">// æ‰“å°ç»“æŸåƒæ°´æœæ—¶é—´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">endEatFruitDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">endDate</span> <span class="hljs-operator">=</span> sdf.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        System.out.println(<span class="hljs-string">&quot;ç»“æŸåƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š&quot;</span> + endDate);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¼–å†™é…ç½®æ–‡ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fruit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.service.impl.Apple&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fruit1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.service.impl.Banana&quot;</span>/&gt;</span><br><br><span class="hljs-comment">&lt;!-- é…ç½®åˆ‡é¢ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fruitHandler&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.aop.FruitHandler&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ç¼–å†™å†™æµ‹è¯•ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.aop.test;<br><br><span class="hljs-keyword">import</span> org.example.service.Fruit;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.test.context.ContextConfiguration;<br><span class="hljs-keyword">import</span> org.springframework.test.context.junit.jupiter.SpringExtension;<br><br><span class="hljs-meta">@ExtendWith(SpringExtension.class)</span><br><span class="hljs-meta">@ContextConfiguration(&quot;classpath:spring.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AOPTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Fruit fruit;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Fruit fruit1;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test01</span><span class="hljs-params">()</span> &#123;<br>        fruit.eat();<br><br>        System.out.println(<span class="hljs-string">&quot;-----------ä¼‘æ¯ä¸€ä¼š--------------&quot;</span>);<br><br>        fruit1.eat();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œåè¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">åƒè‹¹æœ<br>-------------------ä¼‘æ¯ä¸€ä¼š------------------<br>åƒé¦™è•‰<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¸Œæœ›åœ¨è¾“å‡ºåƒè‹¹æœæ—¶æŠŠèŠ±è´¹çš„æ—¶é—´ä¹Ÿè¾“å‡ºï¼Œåˆ™éœ€è¦æ·»åŠ å¦‚ä¸‹é…ç½®ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- é…ç½®AOP --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- é…ç½®åˆ‡é¢ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;fruitHandler&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pt&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* org.example.service..*.*(..))&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;startEatFruitDate&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pt&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:after-returning</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;endEatFruitDate&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pt&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›ä½¿ç”¨ AOP çš„æ³¨è§£æ–¹å¼ï¼Œåˆ™éœ€è¦åšä»¥ä¸‹è°ƒæ•´ï¼š</p><p>1ï¼‰åœ¨åˆ‡é¢ä¸Šæ·»åŠ  @Aspect æ³¨è§£ï¼Œç„¶ååœ¨é€šè¿‡&#x2F;å¢å¼º æ–¹æ³•ä¸Šæ·»åŠ ç›¸åº”çš„å¢å¼ºçš„æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.aop;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><br><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Aspect</span> <span class="hljs-comment">// è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FruitHandler</span> &#123;<br><br>    <span class="hljs-meta">@Before(&quot;execution(* org.example.service..*.*(..))&quot;)</span><br>    <span class="hljs-comment">// æ‰“å°å¼€å§‹åƒæ°´æœæ—¶é—´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startEatFruitDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">startDate</span> <span class="hljs-operator">=</span> sdf.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹åƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š&quot;</span> + startDate);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterReturning(&quot;execution(* org.example.service..*.*(..))&quot;)</span><br>    <span class="hljs-comment">// æ‰“å°ç»“æŸåƒæ°´æœæ—¶é—´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">endEatFruitDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">endDate</span> <span class="hljs-operator">=</span> sdf.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        System.out.println(<span class="hljs-string">&quot;ç»“æŸåƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š&quot;</span> + endDate);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ï¼‰åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­å¼€å¯AOPæ³¨è§£æ”¯æŒï¼ŒåŒæ—¶ä¹‹å‰å–æ¶ˆ AOP çš„ç›¸å…³é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fruit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.service.impl.Apple&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fruit1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.service.impl.Banana&quot;</span>/&gt;</span><br><br><span class="hljs-comment">&lt;!-- é…ç½®åˆ‡é¢ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fruitHandler&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.aop.FruitHandler&quot;</span>/&gt;</span><br><br><span class="hljs-comment">&lt;!-- å¼€å¯ AOP æ³¨è§£çš„æ”¯æŒ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>3ï¼‰å†æ¬¡è¿è¡Œæµ‹è¯•ç¨‹åºå°±å¯ä»¥è¿›è¡Œæµ‹è¯•äº†</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">å¼€å§‹åƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š2022-07-11 10:54:17<br>åƒè‹¹æœ<br>ç»“æŸåƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š2022-07-11 10:54:18<br>-----------ä¼‘æ¯ä¸€ä¼š--------------<br>å¼€å§‹åƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š2022-07-11 10:54:18<br>åƒé¦™è•‰<br>ç»“æŸåƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š2022-07-11 10:54:19<br></code></pre></td></tr></table></figure><p>å…¶å®è¿˜å¯ä»¥ä¼˜åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.aop;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><br><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Aspect</span> <span class="hljs-comment">// è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FruitHandler</span> &#123;<br>    <span class="hljs-meta">@Pointcut(&quot;execution(* org.example.service..*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pt</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">//@Before(&quot;execution(* org.example.service..*.*(..))&quot;)</span><br>    <span class="hljs-meta">@Before(&quot;pt()&quot;)</span><br>    <span class="hljs-comment">// æ‰“å°å¼€å§‹åƒæ°´æœæ—¶é—´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startEatFruitDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">startDate</span> <span class="hljs-operator">=</span> sdf.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹åƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š&quot;</span> + startDate);<br>    &#125;<br><br>    <span class="hljs-comment">//@AfterReturning(&quot;execution(* org.example.service..*.*(..))&quot;)</span><br>    <span class="hljs-meta">@AfterReturning(&quot;pt()&quot;)</span><br>    <span class="hljs-comment">// æ‰“å°ç»“æŸåƒæ°´æœæ—¶é—´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">endEatFruitDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">endDate</span> <span class="hljs-operator">=</span> sdf.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        System.out.println(<span class="hljs-string">&quot;ç»“æŸåƒæ°´æœçš„æ—¶é—´æ˜¯ï¼š&quot;</span> + endDate);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="äº‹åŠ¡ç®¡ç†"><a href="#äº‹åŠ¡ç®¡ç†" class="headerlink" title="äº‹åŠ¡ç®¡ç†"></a>äº‹åŠ¡ç®¡ç†</h1><p>æ•°æ®åº“çš„äº‹åŠ¡æ˜¯æŒ‡å°†ä¸€ç³»åˆ—çš„æ•°æ®åº“æ“ä½œå½“ä½œä¸€ä¸ªé€»è¾‘å•å…ƒï¼Œè¿™ä¸ªå•å…ƒä¸­çš„æ•°æ®æ“ä½œè¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥ã€‚</p><h2 id="1-äº‹åŠ¡çš„ç‰¹ç‚¹"><a href="#1-äº‹åŠ¡çš„ç‰¹ç‚¹" class="headerlink" title="1. äº‹åŠ¡çš„ç‰¹ç‚¹"></a>1. äº‹åŠ¡çš„ç‰¹ç‚¹</h2><p>ä¸€ä¸ªäº‹åŠ¡å¤„ç†é€»è¾‘å•å…ƒè¦æˆä¸ºäº‹åŠ¡ï¼Œå¿…é¡»æ»¡è¶³ACIDå±æ€§ï¼š</p><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡å†…çš„æ“ä½œä¸å¯å†åˆ†ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>ä¸€è‡´æ€§ï¼ˆConisitencyï¼‰ï¼šäº‹åŠ¡æ‰§è¡Œåï¼Œæ•°æ®åº“çš„çŠ¶æ€ä¸å…¶ä»–ä¸šåŠ¡é€»è¾‘ä¿æŒä¸€è‡´ã€‚</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ¯ä¸ªäº‹åŠ¡è¿è¡Œéƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œäº’ä¸å¹²ç»•ã€‚</li><li>æŒä¹…æ€§ï¼ˆDruabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå°±ä¼šæ°¸ä¹…ä¿å­˜ä¸‹æ¥ã€‚</li></ul><h2 id="2-äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#2-äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="2. äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>2. äº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p>äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰ 4 ä¸ªï¼š</p><ul><li>READ_UNCOMMITEDï¼šè¯»å–æœªæäº¤ï¼Œä¼šäº§ç”Ÿâ€œè„è¯»â€æ•°æ®ï¼Œå¿…é¡»è¦é¿å…çš„ã€‚</li><li>READ_COMMITEDï¼šè¯»å·²æäº¤äº‹åŠ¡ï¼Œä¼šäº§ç”Ÿâ€œå¹»è¯»â€æ•°æ®ã€‚</li><li>REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œä¼šäº§ç”Ÿâ€œå¹»è¯»â€æ•°æ®ã€‚</li><li>SERIALIZABLEï¼šå®ƒæ˜¯ä¸€ä¸ªä¸²è¡Œè¯»ã€‚</li></ul><p>äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ä»ä¸Šå¾€ä¸‹çš„å®‰å…¨æ€§å¢åŠ ï¼Œä½†æ˜¯æ€§èƒ½é™ä½ã€‚</p><h2 id="3-äº‹åŠ¡ä¼ æ’­è¡Œä¸º"><a href="#3-äº‹åŠ¡ä¼ æ’­è¡Œä¸º" class="headerlink" title="3. äº‹åŠ¡ä¼ æ’­è¡Œä¸º"></a>3. äº‹åŠ¡ä¼ æ’­è¡Œä¸º</h2><p>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæœ‰ 7 ä¸ªï¼š</p><table><thead><tr><th>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºç±»å‹</th><th>è¯´        æ˜</th></tr></thead><tbody><tr><td>PROPAGATION_REQUIRED</td><td>å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚<br>å¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŠ å…¥åˆ°è¿™å°±ä¸ªäº‹åŠ¡ä¸­</td></tr><tr><td>PROPAGATION_SUPPORTS</td><td>æ”¯æŒå½“å‰äº‹åŠ¡ã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ</td></tr><tr><td>PROPAGATION_MANDATORY</td><td>ä½¿ç”¨å½“å‰çš„äº‹åŠ¡ã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>PROPAGATION_REQUIRES_NEW</td><td>æ–°å»ºäº‹åŠ¡ã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</td></tr><tr><td>PROPAGATION_NOT_SUPPORTED</td><td>ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</td></tr><tr><td>PROPAGATION_NEVER</td><td>ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>PROPAGATION_NESTED</td><td>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚<br>å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œä¸ PROPAGATION_REQUIRED ç±»ä¼¼çš„æ“ä½œã€‚<br>ä¸ PROPAGATION_REQUIRES_NEW çš„å·®åˆ«æ˜¯ PROPAGATION_REQUIRES_NEW å¦èµ·ä¸€ä¸ªäº‹åŠ¡ï¼Œå°†ä¼šä¸å…¶çˆ¶äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ã€‚<br>PROPAGATION_NESTED äº‹åŠ¡å’Œå…¶çˆ¶äº‹åŠ¡æ˜¯ç›¸ä¾çš„ï¼Œå…¶è¦ç­‰çˆ¶äº‹åŠ¡ä¸€èµ·æäº¤ã€‚</td></tr></tbody></table><h2 id="4-äº‹åŠ¡é…ç½®"><a href="#4-äº‹åŠ¡é…ç½®" class="headerlink" title="4. äº‹åŠ¡é…ç½®"></a>4. äº‹åŠ¡é…ç½®</h2><p>1ï¼‰XML é…ç½®æ–¹å¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml">   <span class="hljs-comment">&lt;!-- é…ç½®äº‹åŠ¡é€šçŸ¥ --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transactionManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>           <span class="hljs-comment">&lt;!-- é…ç½®å“ªäº›æ–¹æ³•éœ€è¦æœ‰äº‹åŠ¡ --&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;transfer&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span> <span class="hljs-attr">isolation</span>=<span class="hljs-string">&quot;DEFAULT&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;add*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;update*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;del*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span><br>           <span class="hljs-comment">&lt;!-- å“ªäº›æ–¹æ³•ä¸éœ€è¦æœ‰äº‹åŠ¡ --&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;get*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;SUPPORTS&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;find*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;SUPPORTS&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;SUPPORTS&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br>   <span class="hljs-comment">&lt;!-- é…ç½® AOP --&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pt&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.jock.tx.service..*.*(..))&quot;</span>/&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pt&quot;</span>/&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>2ï¼‰æ³¨è§£æ–¹å¼</p><p>Aã€åœ¨éœ€è¦æ·»åŠ äº‹åŠ¡çš„ç±»æˆ–æ–¹æ³•ä¸Šä½¿ç”¨ @Transactional(propagation &#x3D; Propagation.SUPPORTS, readOnly &#x3D; true)</p><p>Bã€åœ¨é…ç½®æ–‡ä»¶æ·»åŠ æ³¨è§£çš„æ”¯æŒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.jock.tx&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!-- æ·»åŠ äº‹åŠ¡æ³¨è§£æ”¯æŒ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h1 id="Spring-MVC-å¤ä¹ "><a href="#Spring-MVC-å¤ä¹ " class="headerlink" title="Spring MVC å¤ä¹ "></a>Spring MVC å¤ä¹ </h1><p>Spring MVC æ¡†æ¶ä¸­å°è£…çš„å°±æ˜¯ Servletã€‚</p><h2 id="æœ‰-web-xml-çš„æ–¹å¼"><a href="#æœ‰-web-xml-çš„æ–¹å¼" class="headerlink" title="æœ‰ web.xml çš„æ–¹å¼"></a>æœ‰ web.xml çš„æ–¹å¼</h2><h3 id="1ï¼‰åˆ›å»ºä¸€ä¸ªå·¥ç¨‹"><a href="#1ï¼‰åˆ›å»ºä¸€ä¸ªå·¥ç¨‹" class="headerlink" title="1ï¼‰åˆ›å»ºä¸€ä¸ªå·¥ç¨‹"></a>1ï¼‰åˆ›å»ºä¸€ä¸ªå·¥ç¨‹</h3><p> <img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111810726.png" alt="image-20220711181032626"></p><h3 id="2ï¼‰æ·»åŠ ä¾èµ–"><a href="#2ï¼‰æ·»åŠ ä¾èµ–" class="headerlink" title="2ï¼‰æ·»åŠ ä¾èµ–"></a>2ï¼‰æ·»åŠ ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>framework-spring-mvc-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3ï¼‰åˆ›å»º-web-xml-æ–‡ä»¶"><a href="#3ï¼‰åˆ›å»º-web-xml-æ–‡ä»¶" class="headerlink" title="3ï¼‰åˆ›å»º web.xml æ–‡ä»¶"></a>3ï¼‰åˆ›å»º web.xml æ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span><br><span class="hljs-string"><span class="hljs-tag">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="4ï¼‰åˆ›å»ºSpringé…ç½®æ–‡ä»¶"><a href="#4ï¼‰åˆ›å»ºSpringé…ç½®æ–‡ä»¶" class="headerlink" title="4ï¼‰åˆ›å»ºSpringé…ç½®æ–‡ä»¶"></a>4ï¼‰åˆ›å»ºSpringé…ç½®æ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.jock&quot;</span> <span class="hljs-attr">use-default-filters</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- åœ¨Springä¸­æ’é™¤æ‰«æ @Controller æ³¨è§£ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;annotation&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="5ï¼‰ç¼–å†™SpringMVCé…ç½®æ–‡ä»¶"><a href="#5ï¼‰ç¼–å†™SpringMVCé…ç½®æ–‡ä»¶" class="headerlink" title="5ï¼‰ç¼–å†™SpringMVCé…ç½®æ–‡ä»¶"></a>5ï¼‰ç¼–å†™SpringMVCé…ç½®æ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- å…³é—­é»˜è®¤çš„æ‰«æè§„åˆ™ï¼ŒæŒ‰æˆ‘ä»¬è‡ªå·±æŒ‡å®šçš„è§„åˆ™æ¥æ‰«æ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.jock&quot;</span> <span class="hljs-attr">use-default-filters</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">context:include-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;annotation&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- é…ç½®è§†å›¾è§£æå™¨ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/views/&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="6ï¼‰ç¼–å†™å®ç°ç±»"><a href="#6ï¼‰ç¼–å†™å®ç°ç±»" class="headerlink" title="6ï¼‰ç¼–å†™å®ç°ç±»"></a>6ï¼‰ç¼–å†™å®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.jock.entity;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.experimental.Accessors;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Accessors(chain = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7ï¼‰ç¼–å†™æ•°æ®è®¿é—®å±‚"><a href="#7ï¼‰ç¼–å†™æ•°æ®è®¿é—®å±‚" class="headerlink" title="7ï¼‰ç¼–å†™æ•°æ®è®¿é—®å±‚"></a>7ï¼‰ç¼–å†™æ•°æ®è®¿é—®å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.jock.dao;<br><br><span class="hljs-keyword">import</span> org.jock.entity.User;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> &#123;<br>    List&lt;User&gt; <span class="hljs-title function_">list</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.jock.dao.impl;<br><br><span class="hljs-keyword">import</span> org.jock.dao.UserDao;<br><span class="hljs-keyword">import</span> org.jock.entity.User;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDao</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Integer, User&gt; data;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">list</span><span class="hljs-params">()</span> &#123;<br>        List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;Integer, User&gt; entry : data.entrySet()) &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> entry.getValue();<br>            users.add(user);<br>        &#125;<br>        <span class="hljs-keyword">return</span> users;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        data.put(<span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>().setId(<span class="hljs-number">1</span>).setName(<span class="hljs-string">&quot;åˆ˜å¤‡&quot;</span>));<br>        data.put(<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>().setId(<span class="hljs-number">2</span>).setName(<span class="hljs-string">&quot;å…³ç¾½&quot;</span>));<br>        data.put(<span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>().setId(<span class="hljs-number">3</span>).setName(<span class="hljs-string">&quot;å¼ é£&quot;</span>));<br>        data.put(<span class="hljs-number">4</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>().setId(<span class="hljs-number">4</span>).setName(<span class="hljs-string">&quot;èµµäº‘&quot;</span>));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="8ï¼‰ç¼–å†™ä¸šåŠ¡å±‚"><a href="#8ï¼‰ç¼–å†™ä¸šåŠ¡å±‚" class="headerlink" title="8ï¼‰ç¼–å†™ä¸šåŠ¡å±‚"></a>8ï¼‰ç¼–å†™ä¸šåŠ¡å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.jock.service;<br><br><span class="hljs-keyword">import</span> org.jock.entity.User;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    List&lt;User&gt; <span class="hljs-title function_">getAll</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.jock.service.impl;<br><br><span class="hljs-keyword">import</span> org.jock.dao.UserDao;<br><span class="hljs-keyword">import</span> org.jock.entity.User;<br><span class="hljs-keyword">import</span> org.jock.service.UserService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getAll</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userDao.list();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="9ï¼‰ç¼–å†™æ§åˆ¶å™¨"><a href="#9ï¼‰ç¼–å†™æ§åˆ¶å™¨" class="headerlink" title="9ï¼‰ç¼–å†™æ§åˆ¶å™¨"></a>9ï¼‰ç¼–å†™æ§åˆ¶å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.jock.controller;<br><br><span class="hljs-keyword">import</span> org.jock.entity.User;<br><span class="hljs-keyword">import</span> org.jock.service.UserService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.ui.Model;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">list</span><span class="hljs-params">(Model model)</span> &#123;<br>        List&lt;User&gt; users = userService.getAll();<br>        model.addAttribute(<span class="hljs-string">&quot;user&quot;</span>, users.get(<span class="hljs-number">0</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="10ï¼‰åŠ è½½Springå®¹å™¨"><a href="#10ï¼‰åŠ è½½Springå®¹å™¨" class="headerlink" title="10ï¼‰åŠ è½½Springå®¹å™¨"></a>10ï¼‰åŠ è½½Springå®¹å™¨</h3><p>åœ¨ web.xml æ–‡ä»¶ä¸­åŠ è½½ Spring é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span><br><span class="hljs-string"><span class="hljs-tag">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>spring<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath*:spring*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>spring<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="11ï¼‰å¯åŠ¨æœåŠ¡æµ‹è¯•"><a href="#11ï¼‰å¯åŠ¨æœåŠ¡æµ‹è¯•" class="headerlink" title="11ï¼‰å¯åŠ¨æœåŠ¡æµ‹è¯•"></a>11ï¼‰å¯åŠ¨æœåŠ¡æµ‹è¯•</h3><p>åœ¨åœ°å€æ ä¸­è¾“å…¥ï¼š<a href="http://localhost:8080/framework-spring-mvc-xml/list">http://localhost:8080/framework-spring-mvc-xml/list</a></p><p>å¾—åˆ°ç»“æœä¸ºï¼š1 - åˆ˜å¤‡</p><h2 id="çº¯æ³¨è§£æ–¹å¼"><a href="#çº¯æ³¨è§£æ–¹å¼" class="headerlink" title="çº¯æ³¨è§£æ–¹å¼"></a>çº¯æ³¨è§£æ–¹å¼</h2><h3 id="1ï¼‰åˆ›å»ºå·¥ç¨‹"><a href="#1ï¼‰åˆ›å»ºå·¥ç¨‹" class="headerlink" title="1ï¼‰åˆ›å»ºå·¥ç¨‹"></a>1ï¼‰åˆ›å»ºå·¥ç¨‹</h3><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111812495.png" alt="image-20220711181241389"></p><h3 id="2ï¼‰æ·»åŠ ä¾èµ–-1"><a href="#2ï¼‰æ·»åŠ ä¾èµ–-1" class="headerlink" title="2ï¼‰æ·»åŠ ä¾èµ–"></a>2ï¼‰æ·»åŠ ä¾èµ–</h3><p>åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ ä¸ä¸Šé¢çš„ä¾èµ–ç›¸åŒã€‚</p><h3 id="3ï¼‰é…ç½®å®¹å™¨"><a href="#3ï¼‰é…ç½®å®¹å™¨" class="headerlink" title="3ï¼‰é…ç½®å®¹å™¨"></a>3ï¼‰é…ç½®å®¹å™¨</h3><p>æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª config åŒ…ï¼Œåœ¨è¿™ä¸ªåŒ…ä¸‹åˆ›å»ºä¸€ä¸ª ApplicationConifg.java ç±»ï¼Œå®ƒçš„ä½œç”¨å°±å¯¹åº” web.xml ä¸­çš„ ContextLoaderListener çš„åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jock.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.FilterType;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é…ç½®ç±»ï¼Œå®ƒçš„ä½œç”¨ä¸ spring.xml ç›¸åŒ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(</span><br><span class="hljs-meta">        value = &quot;com.jock&quot;,</span><br><span class="hljs-meta">        excludeFilters = &#123;@ComponentScan.Filter(type = FilterType.ANNOTATION, value = Controller.class)&#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationConfig</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ï¼‰ç¯å¢ƒé…ç½®"><a href="#4ï¼‰ç¯å¢ƒé…ç½®" class="headerlink" title="4ï¼‰ç¯å¢ƒé…ç½®"></a>4ï¼‰ç¯å¢ƒé…ç½®</h3><p>ç”±äºä» Servlet 3.x å¼€å§‹ï¼ŒWeb é¡¹ç›®å°±å¼€å§‹æ”¯æŒæ—  web.xml æ–‡ä»¶çš„æ–¹å¼ã€‚è™½ç„¶æ–‡ä»¶å¯ä»¥æ²¡æœ‰ï¼Œä½†å®ƒçš„åŠŸèƒ½éœ€è¦è½¬æ¢ä¸ºé…ç½®æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ config åŒ…ä¸‹å†åˆ›å»ºä¸€ä¸ª WebConfig.java æ–‡ä»¶ï¼Œå®ƒå¯¹åº” DispatcherServlet é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jock.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.FilterType;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.view.InternalResourceViewResolver;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®ƒç›¸å½“äº springmvc.xml æ–‡ä»¶</span><br><span class="hljs-comment"> * è¿™ä¸ªé…ç½®ç±»éœ€è¦å®ç° WebMvcConfigurer ç±»</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@EnableWebMvc</span> æ³¨è§£çš„ä½œç”¨æ˜¯å¼€å¯webåŠŸèƒ½</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebMvc</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.jock&quot;, includeFilters = &#123;</span><br><span class="hljs-meta">        @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = Controller.class)</span><br><span class="hljs-meta">&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-comment">// æ·»åŠ è§†å›¾è§£æå™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> InternalResourceViewResolver <span class="hljs-title function_">viewResolver</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">InternalResourceViewResolver</span> <span class="hljs-variable">viewResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InternalResourceViewResolver</span>();<br>        viewResolver.setPrefix(<span class="hljs-string">&quot;/WEB-INF/views/&quot;</span>);<br>        viewResolver.setSuffix(<span class="hljs-string">&quot;.jsp&quot;</span>);<br>        <span class="hljs-keyword">return</span> viewResolver;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5ï¼‰åŠ è½½å®¹å™¨"><a href="#5ï¼‰åŠ è½½å®¹å™¨" class="headerlink" title="5ï¼‰åŠ è½½å®¹å™¨"></a>5ï¼‰åŠ è½½å®¹å™¨</h3><p>åœ¨é¡¹ç›®ä¸­åˆ›å»º init åŒ…ï¼Œå¹¶åœ¨è¿™ä¸ªåŒ…ä¸‹åˆ›å»º SpringApplicationInitializerï¼Œæ­¤ç±»å®ç°äº† WebApplicationInitializer æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åŠ è½½è¿™ä¸ªæ¥å£çš„æ‰€æœ‰å®ç°ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jock.init;<br><br><span class="hljs-keyword">import</span> com.jock.config.ApplicationConfig;<br><span class="hljs-keyword">import</span> com.jock.config.WebConfig;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åŠ è½½å®¹å™¨ç±»ï¼Œè¿™ä¸ªç±»è¦ç»§æ‰¿ AbstractAnnotationConfigDispatcherServletInitializer ç±»ï¼Œå®ƒæ˜¯ WebApplicationInitializer æ¥å£çš„å­ç±»</span><br><span class="hljs-comment"> * ç„¶åé‡å†™ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</span><br><span class="hljs-comment"> * 1. getRootConfigClasses()ï¼šç”¨äºåŠ è½½ Spring çš„é…ç½®ç±»,ApplicationConfig.class</span><br><span class="hljs-comment"> * 2. getServletConfigClasses()ï¼šç”¨äºåŠ è½½ SpringMVC çš„é…ç½®ç±»ï¼ŒWebConfig.class</span><br><span class="hljs-comment"> * 3. getServletMappings()ï¼šç”¨äºæŒ‡å®šè¯·æ±‚çš„æ˜ å°„</span><br><span class="hljs-comment"> * å…¶å®è¿™ä¸ªç±»çš„ä½œç”¨å°±ç±»ä¼¼äº web.xml æ–‡ä»¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringApplicationInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;ApplicationConfig.class&#125;;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;WebConfig.class&#125;;<br>    &#125;<br><br>    <span class="hljs-comment">// url-mapping</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> String[] getServletMappings() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/&quot;</span>&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6ï¼‰ç¼–å†™å…¶å®ƒç¨‹åº"><a href="#6ï¼‰ç¼–å†™å…¶å®ƒç¨‹åº" class="headerlink" title="6ï¼‰ç¼–å†™å…¶å®ƒç¨‹åº"></a>6ï¼‰ç¼–å†™å…¶å®ƒç¨‹åº</h3><p>æ¥ä¸‹æ¥ç¼–å†™å®ä½“ç±»ã€è®¿é—®å±‚ã€ä¸šåŠ¡å±‚ã€æ§åˆ¶å±‚å’Œ index.jsp é¡µé¢ã€‚å†…å®¹å‚è€ƒ xml é¡¹ç›®ã€‚</p><h3 id="7ï¼‰å¯åŠ¨æµ‹è¯•"><a href="#7ï¼‰å¯åŠ¨æµ‹è¯•" class="headerlink" title="7ï¼‰å¯åŠ¨æµ‹è¯•"></a>7ï¼‰å¯åŠ¨æµ‹è¯•</h3><p>å¯åŠ¨é¡¹ç›®ï¼Œè¾“å…¥è®¿é—®åœ°å€ï¼š<a href="http://localhost:8080/framework-spring-mvc-annotation/list">http://localhost:8080/framework-spring-mvc-annotation/list</a> å°±å¯ä»¥æ­£å¸¸çš„è®¿é—®ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ WebConfig.java é…ç½®ç±»ä¸­ï¼Œæ·»åŠ é»˜è®¤çš„è¯·æ±‚èµ„æºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é…ç½®é»˜è®¤è®¿é—®è·¯å¾„</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> &#123;<br>    registry<br>            .addViewController(<span class="hljs-string">&quot;/&quot;</span>) <span class="hljs-comment">// æ·»åŠ è¯·æ±‚çš„è®¿é—®è·¯å¾„</span><br>            .setViewName(<span class="hljs-string">&quot;login&quot;</span>); <span class="hljs-comment">// è®¾ç½®è®¿é—®è·¯å¾„å¯¹åº”çš„è§†å›¾</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="SpringMVC-æ‰§è¡Œæµç¨‹"><a href="#SpringMVC-æ‰§è¡Œæµç¨‹" class="headerlink" title="SpringMVC æ‰§è¡Œæµç¨‹"></a>SpringMVC æ‰§è¡Œæµç¨‹</h2><h3 id="1-è¯·æ±‚æµç¨‹"><a href="#1-è¯·æ±‚æµç¨‹" class="headerlink" title="1. è¯·æ±‚æµç¨‹"></a>1. è¯·æ±‚æµç¨‹</h3><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111808370.png" alt="image-20220711145727052"></p><h3 id="2-åˆå§‹åŒ–è¿‡ç¨‹"><a href="#2-åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="2. åˆå§‹åŒ–è¿‡ç¨‹"></a>2. åˆå§‹åŒ–è¿‡ç¨‹</h3><p>ç”±äº DispatchServlet æ˜¯æ•´ä¸ª SpringMVC çš„æ ¸å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥è¿™ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DispatcherServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameworkServlet</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°çˆ¶ç±» HttpServletBean ä¸­çš„ init() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>    <span class="hljs-comment">// Set bean properties from init parameters.</span><br>    <span class="hljs-type">PropertyValues</span> <span class="hljs-variable">pvs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletConfigPropertyValues</span>(getServletConfig(), <span class="hljs-built_in">this</span>.requiredProperties);<br>    <span class="hljs-keyword">if</span> (!pvs.isEmpty()) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å®šä½èµ„æº</span><br>            <span class="hljs-type">BeanWrapper</span> <span class="hljs-variable">bw</span> <span class="hljs-operator">=</span> PropertyAccessorFactory.forBeanPropertyAccess(<span class="hljs-built_in">this</span>);<br>            <span class="hljs-comment">// åŠ è½½é…ç½®ä¿¡æ¯</span><br>            <span class="hljs-type">ResourceLoader</span> <span class="hljs-variable">resourceLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletContextResourceLoader</span>(getServletContext());<br>            bw.registerCustomEditor(Resource.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceEditor</span>(resourceLoader, getEnvironment()));<br>            initBeanWrapper(bw);<br>            bw.setPropertyValues(pvs, <span class="hljs-literal">true</span>);<br>        &#125;<br>        <span class="hljs-comment">//.....çœç•¥</span><br>    &#125;<br><br>    <span class="hljs-comment">// Let subclasses do whatever initialization they like.</span><br>    initServletBean();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ˜¯è·å– web.xml ä¸­é…ç½®çš„å±æ€§å‚æ•°ï¼Œå¹¶å°†è¿™äº›å±æ€§è®¾ç½®åˆ° DispatcherServlet ä¸­ï¼Œinit() æ–¹æ³•ä¸­è¿˜åŒ…å«ä¸€ä¸ªæ¨¡æ¿æ–¹æ³• <code>initServletBean();</code>ï¼Œè¯¥æ–¹æ³•éœ€è¦å…¶å­ç±»æ¥å®ç°ã€‚</p><p>HttpServletBean ç±»çš„å­ç±»ä¸º FrameworkServlet ç±»ï¼Œå› æ­¤æˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ªç±»ä¸­çš„ initServletBean()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initServletBean</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>    getServletContext().log(<span class="hljs-string">&quot;Initializing Spring &quot;</span> + getClass().getSimpleName() + <span class="hljs-string">&quot; &#x27;&quot;</span> + getServletName() + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>    <span class="hljs-comment">//....çœç•¥</span><br>    <br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-built_in">this</span>.webApplicationContext = initWebApplicationContext();<br>        initFrameworkServlet();<br>    &#125;<br>    <span class="hljs-comment">//....çœç•¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯ <code>initWebApplicationContext()</code> æ–¹æ³•ï¼Œè¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> WebApplicationContext <span class="hljs-title function_">initWebApplicationContext</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">rootContext</span> <span class="hljs-operator">=</span><br>        WebApplicationContextUtils.getWebApplicationContext(getServletContext());<br>    <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">wac</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.webApplicationContext != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// A context instance was injected at construction time -&gt; use it</span><br>        wac = <span class="hljs-built_in">this</span>.webApplicationContext;<br>        <span class="hljs-keyword">if</span> (wac <span class="hljs-keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;<br>            <span class="hljs-type">ConfigurableWebApplicationContext</span> <span class="hljs-variable">cwac</span> <span class="hljs-operator">=</span> (ConfigurableWebApplicationContext) wac;<br>            <span class="hljs-keyword">if</span> (!cwac.isActive()) &#123;<br>                <span class="hljs-comment">// The context has not yet been refreshed -&gt; provide services such as</span><br>                <span class="hljs-comment">// setting the parent context, setting the application context id, etc</span><br>                <span class="hljs-keyword">if</span> (cwac.getParent() == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">// The context instance was injected without an explicit parent -&gt; set</span><br>                    <span class="hljs-comment">// the root application context (if any; may be null) as the parent</span><br>                    cwac.setParent(rootContext);<br>                &#125;<br>                configureAndRefreshWebApplicationContext(cwac);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (wac == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// No context instance was injected at construction time -&gt; see if one</span><br>        <span class="hljs-comment">// has been registered in the servlet context. If one exists, it is assumed</span><br>        <span class="hljs-comment">// that the parent context (if any) has already been set and that the</span><br>        <span class="hljs-comment">// user has performed any initialization such as setting the context id</span><br>        wac = findWebApplicationContext();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (wac == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// No context instance is defined for this servlet -&gt; create a local one</span><br>        wac = createWebApplicationContext(rootContext);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.refreshEventReceived) &#123;<br>        <span class="hljs-comment">// Either the context is not a ConfigurableApplicationContext with refresh</span><br>        <span class="hljs-comment">// support or the context injected at construction time had already been</span><br>        <span class="hljs-comment">// refreshed -&gt; trigger initial onRefresh manually here.</span><br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.onRefreshMonitor) &#123;<br>            onRefresh(wac);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.publishContext) &#123;<br>        <span class="hljs-comment">// Publish the context as a servlet context attribute.</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">attrName</span> <span class="hljs-operator">=</span> getServletContextAttributeName();<br>        getServletContext().setAttribute(attrName, wac);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> wac;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­å¯ä»¥å‘ç°ï¼Œéƒ½æ—¶åœ¨åˆ›å»º WebApplicationContext å¯¹è±¡ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å« <code>createWebApplicationContext(rootContext);</code> è¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> WebApplicationContext <span class="hljs-title function_">createWebApplicationContext</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> WebApplicationContext parent)</span> &#123;<br>    <span class="hljs-keyword">return</span> createWebApplicationContext((ApplicationContext) parent);<br>&#125;<br><br><br><span class="hljs-keyword">protected</span> WebApplicationContext <span class="hljs-title function_">createWebApplicationContext</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> &#123;<br>    Class&lt;?&gt; contextClass = getContextClass();<br>    <span class="hljs-comment">//....çœç•¥</span><br>    <br>    <span class="hljs-type">ConfigurableWebApplicationContext</span> <span class="hljs-variable">wac</span> <span class="hljs-operator">=</span><br>        (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);<br><br>    wac.setEnvironment(getEnvironment());<br>    wac.setParent(parent);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">configLocation</span> <span class="hljs-operator">=</span> getContextConfigLocation();<br>    <span class="hljs-keyword">if</span> (configLocation != <span class="hljs-literal">null</span>) &#123;<br>        wac.setConfigLocation(configLocation);<br>    &#125;<br>    configureAndRefreshWebApplicationContext(wac);<br><br>    <span class="hljs-keyword">return</span> wac;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥æ–¹æ³•ä¸­ä½¿ç”¨ BeanUtils å·¥å…·ç±»çš„ instantiateClass() æ–¹æ³•æ¥é€šè¿‡åå°„çš„æœºåˆ¶åˆ›å»º Web ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå³ ConfigurableWebApplicationContext å¯¹è±¡ã€‚å¹¶ä¸”å°† web.xml ä¸­çš„é…ç½®çš„ contextConfigLocation å˜é‡è®¾ç½®åˆ°è¯¥å¯¹è±¡ä¸­ã€‚æœ€åˆ·æ–°å®¹å™¨ã€‚</p><p>ç‚¹å‡» <code>configureAndRefreshWebApplicationContext(wac)</code> æ–¹æ³•å¹¶è¿›å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureAndRefreshWebApplicationContext</span><span class="hljs-params">(ConfigurableWebApplicationContext wac)</span> &#123;<br>    <span class="hljs-keyword">if</span> (ObjectUtils.identityToString(wac).equals(wac.getId())) &#123;<br>        <span class="hljs-comment">// The application context id is still set to its original default value</span><br>        <span class="hljs-comment">// -&gt; assign a more useful id based on available information</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.contextId != <span class="hljs-literal">null</span>) &#123;<br>            wac.setId(<span class="hljs-built_in">this</span>.contextId);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Generate default id...</span><br>            wac.setId(ConfigurableWebApplicationContext.APPLICATION_CONTEXT_ID_PREFIX +<br>                      ObjectUtils.getDisplayString(getServletContext().getContextPath()) + <span class="hljs-string">&#x27;/&#x27;</span> + getServletName());<br>        &#125;<br>    &#125;<br><br>    wac.setServletContext(getServletContext());<br>    wac.setServletConfig(getServletConfig());<br>    wac.setNamespace(getNamespace());<br>    wac.addApplicationListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SourceFilteringListener</span>(wac, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextRefreshListener</span>()));<br><br>    <span class="hljs-comment">// The wac environment&#x27;s #initPropertySources will be called in any case when the context</span><br>    <span class="hljs-comment">// is refreshed; do it eagerly here to ensure servlet property sources are in place for</span><br>    <span class="hljs-comment">// use in any post-processing or initialization that occurs below prior to #refresh</span><br>    <span class="hljs-type">ConfigurableEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> wac.getEnvironment();<br>    <span class="hljs-keyword">if</span> (env <span class="hljs-keyword">instanceof</span> ConfigurableWebEnvironment) &#123;<br>        ((ConfigurableWebEnvironment) env).initPropertySources(getServletContext(), getServletConfig());<br>    &#125;<br><br>    postProcessWebApplicationContext(wac);<br>    applyInitializers(wac);<br>    wac.refresh();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æœ€åä¸€è¡Œæ˜¯ <code>wac.refresh();</code> ï¼Œä½œç”¨æ˜¯è¿›è¡Œå®¹å™¨çš„åˆ·æ–°æ“ä½œï¼Œç‚¹å‡»è¿™ä¸ªæ–¹æ³•è¿›å…¥å°±å¯ä»¥è¿›å…¥ IoC å®¹å™¨äº†ã€‚åé¢çš„ä»£ç å°±ä¸å†åˆ†æï¼Œæ˜¨å¤©å·²ç»åˆ†æè¿‡äº†ã€‚</p><p>å›åˆ° FrameworkServlet ç±»ä¸­çš„ initWebApplicationContext() æ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> WebApplicationContext <span class="hljs-title function_">initWebApplicationContext</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">rootContext</span> <span class="hljs-operator">=</span><br>        WebApplicationContextUtils.getWebApplicationContext(getServletContext());<br>    <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">wac</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-comment">//....çœç•¥</span><br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.refreshEventReceived) &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>.onRefreshMonitor) &#123;<br>            onRefresh(wac);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//....çœç•¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>onRefresh(wac);</code> æ–¹æ³•ä¸­ï¼Œä¼šè¿›å…¥  DispatchServlet ç±»ä¸­ onRefresh() æ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onRefresh</span><span class="hljs-params">(ApplicationContext context)</span> &#123;<br>    initStrategies(context);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒä¼šè°ƒç”¨æœ¬ç±»ä¸­ initStrategies() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initStrategies</span><span class="hljs-params">(ApplicationContext context)</span> &#123;<br>    <span class="hljs-comment">// åˆå§‹åŒ–ç”¨æˆ·å¤„ç†æ–‡ä»¶ä¸Šä¼ </span><br>    initMultipartResolver(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ–å¤„ç†å›½é™…åŒ–</span><br>    initLocaleResolver(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ–å¤„ç†ä¸»é¢˜</span><br>    initThemeResolver(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ–å¤„ç†è¯·æ±‚æ˜ å°„ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨ Controllerä¸­çš„æ–¹æ³•</span><br>    initHandlerMappings(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ–å‚æ•°é€‚é…å™¨</span><br>    initHandlerAdapters(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ–å¼‚å¸¸å¤„ç†è§£æå™¨</span><br>    initHandlerExceptionResolvers(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ–è§†å›¾é¢„å¤„ç†å™¨</span><br>    initRequestToViewNameTranslator(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ–è§†å›¾è§£æå™¨</span><br>    initViewResolvers(context);<br>    <span class="hljs-comment">// åˆå§‹åŒ– FlashMap æ˜ å°„ç®¡ç†å™¨</span><br>    initFlashMapManager(context);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿ç­–ç•¥æ–¹æ³•ã€‚å¯¹äºåˆå§‹åŒ–ç­–ç•¥æ–¹æ³• initStrategies() ï¼Œåœ¨ä¸æŒ‡å®šä¸ªæ€§åŒ–é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„é…ç½®è¿›è¡Œåˆå§‹åŒ–ï¼Œé»˜è®¤é…ç½®ä½äº DispatcherServlet.properties é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªé…ç½®æ–‡ä»¶åœ¨ spring-webmvc.jar æ–‡ä»¶ä¸­ã€‚</p><p> <img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207111808611.png" alt="image-20220711180810533"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">org.springframework.web.servlet.LocaleResolver</span>=<span class="hljs-string">org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</span><br><br><span class="hljs-attr">org.springframework.web.servlet.ThemeResolver</span>=<span class="hljs-string">org.springframework.web.servlet.theme.FixedThemeResolver</span><br><br><span class="hljs-attr">org.springframework.web.servlet.HandlerMapping</span>=<span class="hljs-string">org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\</span><br><span class="hljs-string">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping,\</span><br><span class="hljs-string">org.springframework.web.servlet.function.support.RouterFunctionMapping</span><br><br><span class="hljs-attr">org.springframework.web.servlet.HandlerAdapter</span>=<span class="hljs-string">org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</span><br><span class="hljs-string">org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</span><br><span class="hljs-string">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,\</span><br><span class="hljs-string">org.springframework.web.servlet.function.support.HandlerFunctionAdapter</span><br><br><br><span class="hljs-attr">org.springframework.web.servlet.HandlerExceptionResolver</span>=<span class="hljs-string">org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,\</span><br><span class="hljs-string">org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\</span><br><span class="hljs-string">org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</span><br><br><span class="hljs-attr">org.springframework.web.servlet.RequestToViewNameTranslator</span>=<span class="hljs-string">org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</span><br><br><span class="hljs-attr">org.springframework.web.servlet.ViewResolver</span>=<span class="hljs-string">org.springframework.web.servlet.view.InternalResourceViewResolver</span><br><br><span class="hljs-attr">org.springframework.web.servlet.FlashMapManager</span>=<span class="hljs-string">org.springframework.web.servlet.support.SessionFlashMapManager</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŸ¥çœ‹ç”¨äºå¤„ç†è¯·æ±‚æ˜ å°„çš„ <code>initHandlerMappings(context);</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initHandlerMappings</span><span class="hljs-params">(ApplicationContext context)</span> &#123;<br>    <span class="hljs-built_in">this</span>.handlerMappings = <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.detectAllHandlerMappings) &#123;<br>        <span class="hljs-comment">// Find all HandlerMappings in the ApplicationContext, including ancestor contexts.</span><br>        Map&lt;String, HandlerMapping&gt; matchingBeans =<br>            BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerMapping.class, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-keyword">if</span> (!matchingBeans.isEmpty()) &#123;<br>            <span class="hljs-built_in">this</span>.handlerMappings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(matchingBeans.values());<br>            <span class="hljs-comment">// We keep HandlerMappings in sorted order.</span><br>            AnnotationAwareOrderComparator.sort(<span class="hljs-built_in">this</span>.handlerMappings);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">HandlerMapping</span> <span class="hljs-variable">hm</span> <span class="hljs-operator">=</span> context.getBean(HANDLER_MAPPING_BEAN_NAME, HandlerMapping.class);<br>            <span class="hljs-built_in">this</span>.handlerMappings = Collections.singletonList(hm);<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;<br>            <span class="hljs-comment">// Ignore, we&#x27;ll add a default HandlerMapping later.</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Ensure we have at least one HandlerMapping, by registering</span><br>    <span class="hljs-comment">// a default HandlerMapping if no other mappings are found.</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handlerMappings == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-built_in">this</span>.handlerMappings = getDefaultStrategies(context, HandlerMapping.class);<br>        <span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>            logger.trace(<span class="hljs-string">&quot;No HandlerMappings declared for servlet &#x27;&quot;</span> + getServletName() +<br>                         <span class="hljs-string">&quot;&#x27;: using default strategies from DispatcherServlet.properties&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (HandlerMapping mapping : <span class="hljs-built_in">this</span>.handlerMappings) &#123;<br>        <span class="hljs-keyword">if</span> (mapping.usesPathPatterns()) &#123;<br>            <span class="hljs-built_in">this</span>.parseRequestPath = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šéƒ¨åˆ†å°±æ˜¯åˆå§‹åŒ–çš„è¿‡ç¨‹ã€‚</p><h3 id="3-æ‰§è¡Œè¿‡ç¨‹"><a href="#3-æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="3. æ‰§è¡Œè¿‡ç¨‹"></a>3. æ‰§è¡Œè¿‡ç¨‹</h3><p>æˆ‘åœ¨å­¦ä¹  JavaWeb æ—¶ï¼ŒçŸ¥é“ Servlet çš„è§„èŒƒï¼Œå®ƒæœ€é¡¶å±‚çš„æ¥å£æ˜¯ Servletï¼Œé‡Œé¢å«æœ‰ service() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ç”¨äºå¤„ç†è¯·æ±‚çš„æ–¹æ³•ã€‚</p><p>åœ¨ Spring MVC ä¸­çš„ FrameworkServlet ç±»ç»§æ‰¿äº† HttpServletï¼Œå¹¶é‡å†™äº† service() æ–¹æ³•ã€‚å› æ­¤æˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ªæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span><br>    <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br><br>    <span class="hljs-type">HttpMethod</span> <span class="hljs-variable">httpMethod</span> <span class="hljs-operator">=</span> HttpMethod.resolve(request.getMethod());<br>    <span class="hljs-keyword">if</span> (httpMethod == HttpMethod.PATCH || httpMethod == <span class="hljs-literal">null</span>) &#123;<br>        processRequest(request, response);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">super</span>.service(request, response);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ FrameworkServlet  æ˜¯ Spring ä¸­çš„ç±»ï¼Œå®ƒæ‰©å±•äº† HttpServletçš„åŠŸèƒ½ï¼Œæ–°å¢äº† <code>processRequest(request, response)</code> æ–¹æ³•ã€‚æˆ‘ä»¬å›åˆ° HttServletç±»ä¸­ï¼Œé™¤äº† service() æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ doGet()ã€doPost()ã€doDelete() ç­‰æ–¹æ³•ã€‚åœ¨ FrameworkServlet  ä¸­å·²ç»æŠŠè¿™äº›æ–¹æ³•è¿›è¡Œé‡å†™ï¼Œæ¯”å¦‚ doGet()å°±å»ï¼Œåœ¨ HttpServlet ä¸­å®šä¹‰ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span><br>    <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">protocol</span> <span class="hljs-operator">=</span> req.getProtocol();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> lStrings.getString(<span class="hljs-string">&quot;http.method_get_not_supported&quot;</span>);<br>    <span class="hljs-keyword">if</span> (protocol.endsWith(<span class="hljs-string">&quot;1.1&quot;</span>)) &#123;<br>        resp.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, msg);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        resp.sendError(HttpServletResponse.SC_BAD_REQUEST, msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œåœ¨ FrameworkServlet ç±»ä¸­é‡å†™ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span><br>    <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br><br>    processRequest(request, response);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±è¿›å…¥ <code>processRequest()</code> æ–¹æ³•æ¥è¿›è¡Œåˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRequest</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span><br>    <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br><br>    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    <span class="hljs-type">Throwable</span> <span class="hljs-variable">failureCause</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-type">LocaleContext</span> <span class="hljs-variable">previousLocaleContext</span> <span class="hljs-operator">=</span> LocaleContextHolder.getLocaleContext();<br>    <span class="hljs-type">LocaleContext</span> <span class="hljs-variable">localeContext</span> <span class="hljs-operator">=</span> buildLocaleContext(request);<br><br>    <span class="hljs-type">RequestAttributes</span> <span class="hljs-variable">previousAttributes</span> <span class="hljs-operator">=</span> RequestContextHolder.getRequestAttributes();<br>    <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">requestAttributes</span> <span class="hljs-operator">=</span> buildRequestAttributes(request, response, previousAttributes);<br><br>    <span class="hljs-type">WebAsyncManager</span> <span class="hljs-variable">asyncManager</span> <span class="hljs-operator">=</span> WebAsyncUtils.getAsyncManager(request);<br>    asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestBindingInterceptor</span>());<br><br>    initContextHolders(request, localeContext, requestAttributes);<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        doService(request, response);<br>    &#125;<br>    <span class="hljs-comment">//....çœç•¥</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åšäº†å¾ˆå¤šçš„äº‹æƒ…ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œå…¶ä¸­æˆ‘ä»¬å…ˆæœ€éœ€è¦å…³æ³¨çš„æ˜¯å¤„ç†è¯·æ±‚çš„ <code>doService()</code> æ–¹æ³•ã€‚ç‚¹å‡»è¿™ä¸ªæ–¹æ³•åå¯ä»¥å‘ç°å®ƒæ˜¯ FrameworkServlet ä¸­çš„ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doService</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span><br><span class="hljs-keyword">throws</span> Exception;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å…¶å®æ˜¯ DistatcherServlet è¿™ä¸ªå­ç±»æ¥å…·ä½“å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doService</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    logRequest(request);<br><br>    <span class="hljs-comment">// Keep a snapshot of the request attributes in case of an include,</span><br>    <span class="hljs-comment">// to be able to restore the original attributes after the include.</span><br>    Map&lt;String, Object&gt; attributesSnapshot = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">if</span> (WebUtils.isIncludeRequest(request)) &#123;<br>        attributesSnapshot = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Enumeration&lt;?&gt; attrNames = request.getAttributeNames();<br>        <span class="hljs-keyword">while</span> (attrNames.hasMoreElements()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">attrName</span> <span class="hljs-operator">=</span> (String) attrNames.nextElement();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) &#123;<br>                attributesSnapshot.put(attrName, request.getAttribute(attrName));<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Make framework objects available to handlers and view objects.</span><br>    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());<br>    request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, <span class="hljs-built_in">this</span>.localeResolver);<br>    request.setAttribute(THEME_RESOLVER_ATTRIBUTE, <span class="hljs-built_in">this</span>.themeResolver);<br>    request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.flashMapManager != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">FlashMap</span> <span class="hljs-variable">inputFlashMap</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.flashMapManager.retrieveAndUpdate(request, response);<br>        <span class="hljs-keyword">if</span> (inputFlashMap != <span class="hljs-literal">null</span>) &#123;<br>            request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));<br>        &#125;<br>        request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlashMap</span>());<br>        request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, <span class="hljs-built_in">this</span>.flashMapManager);<br>    &#125;<br><br>    <span class="hljs-type">RequestPath</span> <span class="hljs-variable">previousRequestPath</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.parseRequestPath) &#123;<br>        previousRequestPath = (RequestPath) request.getAttribute(ServletRequestPathUtils.PATH_ATTRIBUTE);<br>        ServletRequestPathUtils.parseAndCache(request);<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        doDispatch(request, response);<br>    &#125;<br>    <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;<br>            <span class="hljs-comment">// Restore the original attribute snapshot, in case of an include.</span><br>            <span class="hljs-keyword">if</span> (attributesSnapshot != <span class="hljs-literal">null</span>) &#123;<br>                restoreAttributesAfterInclude(request, attributesSnapshot);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.parseRequestPath) &#123;<br>            ServletRequestPathUtils.setParsedRequestPath(previousRequestPath, request);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ FrameworkServlet ç±»ä¸­çš„ doService() æ–¹æ³•å…¶å®è°ƒç”¨äº† DispatcherSeverlet ç±»ä¸­çš„ doDispatch() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°†å¯»æ‰¾åˆé€‚çš„å¤„ç†æ–¹å¼æ¥æ‰§è¡Œè¯·æ±‚ã€‚è¿›å…¥ doDipatch() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doDispatch</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">processedRequest</span> <span class="hljs-operator">=</span> request;<br>    <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">mappedHandler</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">multipartRequestParsed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-type">WebAsyncManager</span> <span class="hljs-variable">asyncManager</span> <span class="hljs-operator">=</span> WebAsyncUtils.getAsyncManager(request);<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// è§†å›¾å¯¹è±¡</span><br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">Exception</span> <span class="hljs-variable">dispatchException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦ä¸ºæ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚</span><br>            processedRequest = checkMultipart(request);<br>            multipartRequestParsed = (processedRequest != request);<br><br>            <span class="hljs-comment">// 2. è·å–å½“å‰è¯·æ±‚çš„ Controllerï¼ˆä¹Ÿå°±æ˜¯ Handlerï¼‰ï¼Œå³å¤„ç†å™¨</span><br>            mappedHandler = getHandler(processedRequest);<br>            <span class="hljs-keyword">if</span> (mappedHandler == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// å¦‚å¤„ç†å™¨æ²¡æœ‰æ‰¾åˆ°åˆ™æŠ›å‡º 404 é”™è¯¯</span><br>                noHandlerFound(processedRequest, response);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// 3. è·å–å¤„ç†è¯·æ±‚çš„å¤„ç†å™¨é€‚é…å™¨ HandleAdapter</span><br>            <span class="hljs-type">HandlerAdapter</span> <span class="hljs-variable">ha</span> <span class="hljs-operator">=</span> getHandlerAdapter(mappedHandler.getHandler());<br><br>            <span class="hljs-comment">// å¤„ç† last-moddified è¯·æ±‚å¤´</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> request.getMethod();<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isGet</span> <span class="hljs-operator">=</span> HttpMethod.GET.matches(method);<br>            <span class="hljs-keyword">if</span> (isGet || HttpMethod.HEAD.matches(method)) &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">lastModified</span> <span class="hljs-operator">=</span> ha.getLastModified(request, mappedHandler.getHandler());<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletWebRequest</span>(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// 4. å®ç°å¤„ç†è¯·æ±‚çš„å¤„ç†å™¨ï¼Œæ‰§è¡Œåä¼šè¿”å›è§†å›¾å¯¹è±¡</span><br>            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());<br><br>            <span class="hljs-keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// ç»“æœè§†å›¾å¯¹è±¡çš„å¤„ç†</span><br>            applyDefaultViewName(processedRequest, mv);<br>            mappedHandler.applyPostHandle(processedRequest, response, mv);<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            dispatchException = ex;<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Throwable err) &#123;<br>            <span class="hljs-comment">// As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,</span><br>            <span class="hljs-comment">// making them available for @ExceptionHandler methods and other scenarios.</span><br>            dispatchException = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedServletException</span>(<span class="hljs-string">&quot;Handler dispatch failed&quot;</span>, err);<br>        &#125;<br>        <span class="hljs-comment">// å¤„ç†ç»“æœ</span><br>        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);<br>    &#125;<br>    <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);<br>    &#125;<br>    <span class="hljs-keyword">catch</span> (Throwable err) &#123;<br>        triggerAfterCompletion(processedRequest, response, mappedHandler,<br>                               <span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedServletException</span>(<span class="hljs-string">&quot;Handler processing failed&quot;</span>, err));<br>    &#125;<br>    <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;<br>            <span class="hljs-comment">// Instead of postHandle and afterCompletion</span><br>            <span class="hljs-keyword">if</span> (mappedHandler != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// è¯·æ±‚æˆåŠŸå“åº”ä¹‹åçš„æ–¹æ³•ã€‚</span><br>                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Clean up any resources used by a multipart request.</span><br>            <span class="hljs-keyword">if</span> (multipartRequestParsed) &#123;<br>                cleanupMultipart(processedRequest);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åˆ†æ getHandler() æ–¹æ³•ï¼Œçœ‹å®ƒæ˜¯å¦‚ä½•æ¥æ‰¾åˆ°è¯·æ±‚å¯¹åº”çš„å¤„ç†ç¨‹åºçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-keyword">protected</span> HandlerExecutionChain <span class="hljs-title function_">getHandler</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handlerMappings != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (HandlerMapping mapping : <span class="hljs-built_in">this</span>.handlerMappings) &#123;<br>            <span class="hljs-type">HandlerExecutionChain</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> mapping.getHandler(request);<br>            <span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> handler;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¸­æ˜¯æŠŠé»˜è®¤åŠ è½½ï¼ˆDipathcerServlet.propertiesï¼‰æˆ–è€…æˆ‘ä»¬è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ï¼ˆå¤„ç†å™¨ï¼‰ï¼Œç„¶åè¿›è¡Œé€ä¸ªéå†ï¼Œå¦‚æœæŸä¸ªå¤„ç†å™¨èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œè¯·æ±‚ï¼Œåˆ™ç»“æŸéå†å¹¶è¿”å›ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¤ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LinkedListã€ArrayListæ’å…¥åˆ†æ</title>
    <link href="/2022/07/08/2022-7-8-LinkedList%E3%80%81ArrayList%E6%8F%92%E5%85%A5%E5%88%86%E6%9E%90/"/>
    <url>/2022/07/08/2022-7-8-LinkedList%E3%80%81ArrayList%E6%8F%92%E5%85%A5%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Begin"><a href="#Begin" class="headerlink" title="Begin"></a>Begin</h1><p><code>ArrayList</code>åŸºäºæ•°ç»„è¿›è¡Œå®ç°ï¼Œ<code>LinkedList</code>åŸºäºé“¾è¡¨è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥åŸºäºæ•°æ®ç»“æ„çš„ä¸åŒï¼Œéå†å’ŒæŸ¥æ‰¾å¤šçš„æƒ…å†µä¸‹ç”¨ <code>ArrayList</code>ã€æ’å…¥å’Œåˆ é™¤é¢‘ç¹çš„æƒ…å†µä¸‹ç”¨ <code>LinkedList</code>ï¼Œä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³è¿™<code>LinkedList</code>çš„æ’å…¥æ•ˆç‡ä¸€å®šæ¯”<code>ArrayList</code>å¥½ï¼Œå½“æˆ‘ä»¬åªéœ€è¦åœ¨ç»“å°¾æ’æ•°æ®æ—¶ï¼Œ<code>ArryList</code>çš„æ•ˆç‡æ˜¯é«˜äº<code>LinkedList</code>çš„</p><p>æ‰€ä»¥è¿˜éœ€è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æ</p><h1 id="LinkedListæ•°æ®ç»“æ„"><a href="#LinkedListæ•°æ®ç»“æ„" class="headerlink" title="LinkedListæ•°æ®ç»“æ„"></a>LinkedListæ•°æ®ç»“æ„</h1><p><code>LinkedList</code>ï¼Œæ˜¯åŸºäºé“¾è¡¨å®ç°ï¼Œç”±åŒå‘é“¾æ¡<code>next</code>ã€<code>prev</code>ï¼ŒæŠŠæ•°æ®èŠ‚ç‚¹ç©¿æ’èµ·æ¥ã€‚æ‰€ä»¥ï¼Œåœ¨æ’å…¥æ•°æ®æ—¶ï¼Œæ˜¯ä¸éœ€è¦åƒæˆ‘ä»¬ä¸Šä¸€ç« ä»‹ç»çš„<code>ArrayList</code>é‚£æ ·ï¼Œæ‰©å®¹æ•°ç»„</p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081133374.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;E&gt; &#123;<br>    E item;<br>    Node&lt;E&gt; next;<br>    Node&lt;E&gt; prev;<br><br>    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;<br>        <span class="hljs-built_in">this</span>.item = element;<br>        <span class="hljs-built_in">this</span>.next = next;<br>        <span class="hljs-built_in">this</span>.prev = prev;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h1><p>ä¸<code>ArrayList</code>ä¸åŒï¼Œ<code>LinkedList</code>çš„åˆå§‹åŒ–ä¸éœ€è¦åˆ›å»ºæ•°ç»„ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä¼ ç»™æ„é€ å‡½æ•°åˆå§‹åŒ–å¤šå°‘ä¸ªç©ºé—´çš„å…¥å‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">LinkedList</span><span class="hljs-params">()</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">LinkedList</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> &#123;<br>    <span class="hljs-built_in">this</span>();<br>    addAll(c);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆå§‹åŒ–æ–¹å¼ï¼›æ™®é€šæ–¹å¼</span><br>LinkedList&lt;String&gt; list01 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;String&gt;();<br>list01.add(<span class="hljs-string">&quot;1&quot;</span>);<br><br><span class="hljs-comment">// åˆå§‹åŒ–æ–¹å¼ï¼›Arrays.asList</span><br>LinkedList&lt;String&gt; list02 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;String&gt;(Arrays.asList(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>));<br><br><span class="hljs-comment">// åˆå§‹åŒ–æ–¹å¼ï¼›Collections.nCopies</span><br>LinkedList&lt;Integer&gt; list04 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;Integer&gt;(Collections.nCopies(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)); <span class="hljs-comment">// 10ä¸ª0</span><br></code></pre></td></tr></table></figure><h1 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h1><p><code>LinkedList</code>æ’å…¥æ–¹æ³•æ¯”è¾ƒå¤šï¼Œ<code>List</code>ä¸­æ¥å£é»˜è®¤æä¾›çš„æ˜¯<code>add</code>ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä½ç½®æ’å…¥ï¼Œä½†æ˜¯åœ¨<code>LinkedList</code>ä¸­è¿˜æä¾›äº†å¤´æ’<code>addFirst</code>å’Œå°¾æ’<code>addLast</code></p><h2 id="å¤´æ’"><a href="#å¤´æ’" class="headerlink" title="å¤´æ’"></a>å¤´æ’</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081143472.png" alt="image-20220708114308409"></p><ol><li><code>ArrayList</code>å¤´æ’æ—¶ï¼Œéœ€è¦æŠŠå…ƒç´ é€šè¿‡<code>Arrays.copyOf</code>çš„æ–¹å¼æŠŠæ•°ç»„å…ƒç´ ç§»ä½ï¼Œå¦‚æœå®¹é‡ä¸è¶³è¿˜éœ€è¦æ‰©å®¹</li><li><code>LinkedList</code>å¤´æ’æ—¶ï¼Œåˆ™ä¸éœ€è¦è€ƒè™‘æ‰©å®¹ä»¥åŠç§»ä½é—®é¢˜ï¼Œç›´æ¥æŠŠå…ƒç´ å®šä½é¦–ä½ï¼Œæ’å…¥å³å¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">linkFirst</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; f = first;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(<span class="hljs-literal">null</span>, e, f); <span class="hljs-comment">// æ–°çš„èŠ‚ç‚¹å…ƒç´ </span><br>    first = newNode;<br>    <span class="hljs-keyword">if</span> (f == <span class="hljs-literal">null</span>)<br>        last = newNode;<br>    <span class="hljs-keyword">else</span><br>        f.prev = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ’å…¥çš„æ—¶å€™åªéœ€è¦å»åˆ›å»ºæ–°çš„èŠ‚ç‚¹å…ƒç´ ï¼Œ<code>new Node&lt;&gt;(null,e,f)</code>ï¼Œæ¥ç€æŠŠæ–°çš„å¤´å…ƒç´ èµ‹å€¼ç»™<code>first</code>ï¼Œåé¢åˆ¤è¯»fèŠ‚ç‚¹å­˜åœ¨å¦ï¼Œä¸å­˜åœ¨å°±æŠŠå¤´æ’èŠ‚ç‚¹ä½œä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå­˜åœ¨åˆ™ç”¨<code>f.prev</code>é“¾æ¥å½“å‰èŠ‚ç‚¹</p><p><strong>å¯¹æ¯”</strong>ï¼š<code>LinkedList </code>æ›´ä¼˜</p><p>åœ¨åªè¿›è¡Œå¤´æ’çš„è§†ä¹ï¼Œ<code>ArrayList </code>éœ€è¦åšå¤§é‡çš„ä½ç§»å’Œå¤åˆ¶æ“ä½œï¼Œè€Œ<code>LinkedList </code>çš„ä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†ï¼Œè€—æ—¶åªæ˜¯å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡</p><h2 id="å°¾æ’"><a href="#å°¾æ’" class="headerlink" title="å°¾æ’"></a>å°¾æ’</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081148335.png" alt="image-20220708114844272"></p><ol><li><code>ArrayList </code>å°¾æ’æ—¶ï¼Œæ˜¯ä¸éœ€è¦æ•°æ®ä½ç§»çš„ï¼Œæ¯”è¾ƒè€—æ—¶çš„æ˜¯æ•°æ®çš„æ‰©å®¹æ—¶ï¼Œéœ€è¦æ‹·è´è¿ç§»</li><li><code>LinkedList</code> å°¾æ’æ—¶ï¼Œä¸å¤´æ’ç›¸æ¯”è€—æ—¶ç‚¹ä¼šåœ¨å¯¹è±¡çš„å®ä¾‹åŒ–ä¸Š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">linkLast</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; l = last;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(l, e, <span class="hljs-literal">null</span>);<br>    last = newNode;<br>    <span class="hljs-keyword">if</span> (l == <span class="hljs-literal">null</span>)<br>        first = newNode;<br>    <span class="hljs-keyword">else</span><br>        l.next = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¸å¤´æ’ä»£ç ç›¸æ¯”å‡ ä¹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåªæ˜¯<code>first</code>æ¢æˆ<code>last</code></li><li>è€—æ—¶åªæ˜¯åœ¨åˆ›å»ºèŠ‚ç‚¹ä¸Šï¼Œ<code>Node&lt;E&gt;</code></li></ul><p><strong>å¯¹æ¯”</strong>ï¼š<code>ArrayList </code>æ›´ä¼˜</p><h2 id="ä¸­é—´æ’"><a href="#ä¸­é—´æ’" class="headerlink" title="ä¸­é—´æ’"></a>ä¸­é—´æ’</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081346021.png" alt="image-20220708134635927"></p><ol><li><code>ArrayList</code>ä¸­é—´æ’å…¥ï¼Œé¦–å…ˆæˆ‘ä»¬çŸ¥é“ä»–çš„å®šä½æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ¯”è¾ƒè€—æ—¶çš„ç‚¹åœ¨äºæ•°æ®è¿ç§»å’Œå®¹é‡ä¸è¶³æ—¶å€™çš„æ‰©å®¹</li><li><code>LinkedList</code>ä¸­é—´æ’å…¥ï¼Œé“¾è¡¨çš„æ•°æ®å®é™…æ’å…¥æ—¶å€™å¹¶ä¸ä¼šæ€ä¹ˆè€—æ—¶ï¼Œä½†æ˜¯ä»–å®šä½çš„å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä»¥åŠå…ƒç´ çš„å®ä¾‹åŒ–æ¯”è¾ƒè€—æ—¶</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ’å…¥å…ƒç´ </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> &#123;<br>    checkPositionIndex(index);<br><br>    <span class="hljs-keyword">if</span> (index == size)<br>        linkLast(element);<br>    <span class="hljs-keyword">else</span><br>        linkBefore(element, node(index));<br>&#125;<br><br><span class="hljs-comment">// å®šä½å…ƒç´ </span><br>Node&lt;E&gt; <span class="hljs-title function_">node</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>    <span class="hljs-comment">// assert isElementIndex(index);</span><br><br>    <span class="hljs-keyword">if</span> (index &lt; (size &gt;&gt; <span class="hljs-number">1</span>)) &#123;<br>        Node&lt;E&gt; x = first;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; index; i++)<br>            x = x.next;<br>        <span class="hljs-keyword">return</span> x;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        Node&lt;E&gt; x = last;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> size - <span class="hljs-number">1</span>; i &gt; index; i--)<br>            x = x.prev;<br>        <span class="hljs-keyword">return</span> x;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ­£å¼æ’å…¥</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">linkBefore</span><span class="hljs-params">(E e, Node&lt;E&gt; succ)</span> &#123;<br>    <span class="hljs-comment">// assert succ != null;</span><br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; pred = succ.prev;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(pred, e, succ);<br>    succ.prev = newNode;<br>    <span class="hljs-keyword">if</span> (pred == <span class="hljs-literal">null</span>)<br>        first = newNode;<br>    <span class="hljs-keyword">else</span><br>        pred.next = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ‰¾åˆ°æŒ‡å®šä½ç½®æ’å…¥çš„è¿‡ç¨‹å°±æ¯”è¾ƒç®€å•äº†ï¼Œä¸å¤´æ’ã€å°¾æ’ï¼Œç›¸å·®ä¸å¤§</li><li>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œæ’å…¥ä¸­æ¯”è¾ƒè€—æ—¶çš„ç‚¹ä¼šåœ¨éå†å¯»æ‰¾æ’å…¥ä½ç½®ä¸Š</li></ul><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081352539.png" alt="image-20220708135241491"></p><p>é€šè¿‡æµ‹è¯•å¯ä»¥çœ‹åˆ° <code>Linkedlist </code>åœ¨ä¸­é—´æ’å…¥æ—¶ï¼Œéå†å¯»æ‰¾ä½ç½®è¿˜æ˜¯éå¸¸è€—æ—¶äº†ã€‚æ‰€ä»¥ä¸åŒçš„æƒ…å†µä¸‹ï¼Œéœ€è¦é€‰æ‹©ä¸åŒçš„ <code>List </code>é›†åˆåšä¸šåŠ¡</p><p><strong>å¯¹æ¯”</strong>ï¼š<code>ArrayList </code>æ›´ä¼˜</p><h1 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h1><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081355824.png" alt="image-20220708135526764"></p><p><strong>ä»¥<code>remove()</code>ä¸ºä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Object o)</span> &#123;<br>    <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="hljs-literal">null</span>; x = x.next) &#123;<br>            <span class="hljs-keyword">if</span> (x.item == <span class="hljs-literal">null</span>) &#123;<br>                unlink(x);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="hljs-literal">null</span>; x = x.next) &#123;<br>            <span class="hljs-keyword">if</span> (o.equals(x.item)) &#123;<br>                unlink(x);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-comment">// unlink(x)è§£é“¾</span><br>E <span class="hljs-title function_">unlink</span><span class="hljs-params">(Node&lt;E&gt; x)</span> &#123;<br>    <span class="hljs-comment">// assert x != null;</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">E</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> x.item;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; next = x.next;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; prev = x.prev;<br><br>    <span class="hljs-keyword">if</span> (prev == <span class="hljs-literal">null</span>) &#123;<br>        first = next;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        prev.next = next;<br>        x.prev = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (next == <span class="hljs-literal">null</span>) &#123;<br>        last = prev;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        next.prev = prev;<br>        x.next = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    x.item = <span class="hljs-literal">null</span>;<br>    size--;<br>    modCount++;<br>    <span class="hljs-keyword">return</span> element;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">xx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000000</span>; i++) &#123;<br>    list.add(i);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ™®é€šforå¾ªç¯"><a href="#æ™®é€šforå¾ªç¯" class="headerlink" title="æ™®é€šforå¾ªç¯"></a>æ™®é€šforå¾ªç¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_LinkedList_for0</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; list.size(); i++) &#123;<br>        xx += list.get(i);<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;è€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - startTime));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¢å¼ºforå¾ªç¯"><a href="#å¢å¼ºforå¾ªç¯" class="headerlink" title="å¢å¼ºforå¾ªç¯"></a>å¢å¼ºforå¾ªç¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_LinkedList_for1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    <span class="hljs-keyword">for</span> (Integer itr : list) &#123;<br>        xx += itr;<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;è€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - startTime));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Iteratorå¾ªç¯"><a href="#Iteratorå¾ªç¯" class="headerlink" title="Iteratorå¾ªç¯"></a>Iteratorå¾ªç¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_LinkedList_Iterator</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    Iterator&lt;Integer&gt; iterator = list.iterator();<br>    <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> iterator.next();<br>        xx += next;<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;è€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - startTime))<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="forEachå¾ªç¯"><a href="#forEachå¾ªç¯" class="headerlink" title="forEachå¾ªç¯"></a>forEachå¾ªç¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_LinkedList_forEach</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    list.forEach(integer -&gt; &#123;<br>        xx += integer;<br>    &#125;);<br>    System.out.println(<span class="hljs-string">&quot;è€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - startTime));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Streamæµ"><a href="#Streamæµ" class="headerlink" title="Streamæµ"></a>Streamæµ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_LinkedList_stream</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    list.stream().forEach(integer -&gt; &#123;<br>        xx += integer;<br>    &#125;);<br>    System.out.println(<span class="hljs-string">&quot;è€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - startTime));<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æºç </category>
      
    </categories>
    
    
    <tags>
      
      <tag>æºç </tag>
      
      <tag>LinkedList</tag>
      
      <tag>ArrayList</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŒç«¯é˜Ÿåˆ—ã€å»¶è¿Ÿé˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—</title>
    <link href="/2022/07/08/2022-7-8-%E5%8F%8C%E7%AB%AF%E9%98%9F%E5%88%97%E3%80%81%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E3%80%81%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/"/>
    <url>/2022/07/08/2022-7-8-%E5%8F%8C%E7%AB%AF%E9%98%9F%E5%88%97%E3%80%81%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E3%80%81%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/</url>
    
    <content type="html"><![CDATA[<h1 id="Begin"><a href="#Begin" class="headerlink" title="Begin"></a>Begin</h1><p>ç¨‹åºå¼€å‘ä¸­æ•°æ®ç»“æ„å¯ä»¥åˆ†ä¸ºè¿™å…«ç±»ï¼š<strong>æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€æ ‘ã€å †ã€å›¾</strong></p><table><thead><tr><th>ç±»å‹</th><th>å®ç°</th></tr></thead><tbody><tr><td>æ•°ç»„</td><td>ArrayList</td></tr><tr><td>é“¾è¡¨</td><td>LinkedList</td></tr><tr><td>æ ‘</td><td>2-3æ ‘ã€çº¢é»‘æ ‘</td></tr><tr><td>æ•£åˆ—è¡¨</td><td>HashMap</td></tr><tr><td>æ ˆ</td><td>Stack</td></tr><tr><td>é˜Ÿåˆ—</td><td>Queueã€Deque</td></tr></tbody></table><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081634845.png" alt="image-20220708163427762"></p><h1 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h1><blockquote><p>è¿™æ˜¯ä¸€ä¸ªå·²ç»è¢«æŠ›å¼ƒçš„å®ç°ç±»ï¼Œæ³¨æ„æ˜¯å®ç°ç±»ï¼Œå¹¶ä¸æ˜¯æŠ›å¼ƒäº†è¿™ç§æ•°æ®ç»“æ„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * The &lt;code&gt;Stack&lt;/code&gt; class represents a last-in-first-out</span><br><span class="hljs-comment"> * (LIFO) stack of objects. It extends class &lt;tt&gt;Vector&lt;/tt&gt; with five</span><br><span class="hljs-comment"> * operations that allow a vector to be treated as a stack. The usual</span><br><span class="hljs-comment"> * &lt;tt&gt;push&lt;/tt&gt; and &lt;tt&gt;pop&lt;/tt&gt; operations are provided, as well as a</span><br><span class="hljs-comment"> * method to &lt;tt&gt;peek&lt;/tt&gt; at the top item on the stack, a method to test</span><br><span class="hljs-comment"> * for whether the stack is &lt;tt&gt;empty&lt;/tt&gt;, and a method to &lt;tt&gt;search&lt;/tt&gt;</span><br><span class="hljs-comment"> * the stack for an item and discover how far it is from the top.</span><br><span class="hljs-comment"> * &lt;p&gt;</span><br><span class="hljs-comment"> * When a stack is first created, it contains no items.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;A more complete and consistent set of LIFO stack operations is</span><br><span class="hljs-comment"> * provided by the &#123;<span class="hljs-doctag">@link</span> Deque&#125; interface and its implementations, which</span><br><span class="hljs-comment"> * should be used in preference to this class.  For example:</span><br><span class="hljs-comment"> * &lt;pre&gt;   &#123;<span class="hljs-doctag">@code</span></span><br><span class="hljs-comment"> * âœ¨ Deque&lt;Integer&gt; stack = new ArrayDeque&lt;Integer&gt;();</span><br><span class="hljs-comment"> * &#125;&lt;/pre&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>  Jonathan Payne</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span>   JDK1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Stack</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Vector</span>&lt;E&gt; &#123; ... &#125;<br></code></pre></td></tr></table></figure><ul><li>ä»ä¸Šé¢æºç çš„æ³¨é‡Šå¯ä»¥è·å–åˆ°ï¼Œ<code>Stack</code>æ ˆæ˜¯åœ¨<code>JDK1.0</code>çš„æ—¶ä»£ï¼ŒåŸºäºç»§æ‰¿<code>Vector</code>å®ç°çš„æœ¬èº«<code>Vector</code>å°±æ˜¯ä¸€ä¸ªä¸è¢«æ¨èä½¿ç”¨çš„ç±»ï¼Œä¸»è¦åœ¨äºå®ƒçš„ä¸€äº›æ“ä½œæ–¹æ³•é”(<code>synchronized</code>)çš„åŠ›åº¦å¤ªç²—ï¼Œéƒ½æ˜¯æ”¾åˆ°æ–¹æ³•ä¸Š</li><li><code>Stack</code>æ ˆåº•å±‚æ˜¯ä½¿ç”¨<code>Vector</code>æ•°ç»„å®ç°ï¼Œåœ¨å­¦ä¹ <code>ArrayList</code>æ—¶å€™æˆ‘ä»¬çŸ¥é“ï¼Œæ•°ç»„ç»“æ„åœ¨å…ƒç´ æ·»åŠ å’Œåˆ é™¤éœ€è¦é€šè¿‡<code>System.arraycopy</code>ï¼Œè¿›è¡Œæ‰©å®¹æ“ä½œã€‚è€Œæœ¬èº«æ ˆçš„ç‰¹ç‚¹å°±æ˜¯é¦–å°¾å…ƒç´ çš„æ“ä½œï¼Œä¹Ÿä¸éœ€è¦éå†ï¼Œä½¿ç”¨æ•°ç»„ç»“æ„å…¶å®å¹¶ä¸å¤ªç†æƒ³</li><li>åŒæ˜¯è¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šä¹Ÿæ˜ç¡®æ ‡å‡ºæ¥ï¼Œæ¨èä½¿ç”¨<code>Deque&lt;Integer&gt; stack = new ArrayDeque&lt;Integer&gt;();</code>ï¼Œè™½ç„¶è¿™ä¹Ÿæ˜¯æ•°ç»„ç»“æ„ï¼Œä½†æ˜¯ä»–æ²¡æœ‰ç²—ç²’åº¦çš„é”ï¼ŒåŒæ—¶å¯ä»¥ç”³è¯·æŒ‡å®šç©ºé—´å¹¶ä¸”åœ¨æ‰©å®¹æ—¶ä¹Ÿè¦ä¼˜äº<code>Stack</code>ã€‚å¹¶ä¸”è¿™ä¸ªè¿˜æ˜¯ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ çµæ´»</li></ul><h1 id="ArrayDeque"><a href="#ArrayDeque" class="headerlink" title="ArrayDeque"></a>ArrayDeque</h1><p><code>ArrayDeque </code>æ˜¯åŸºäºæ•°ç»„å®ç°çš„å¯åŠ¨æ€æ‰©å®¹çš„åŒç«¯é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥åœ¨é˜Ÿåˆ—çš„å¤´å’Œå°¾åŒæ—¶æ’å…¥å’Œå¼¹å‡ºå…ƒç´ ã€‚å½“å…ƒç´ æ•°é‡è¶…è¿‡æ•°ç»„åˆå§‹åŒ–é•¿åº¦æ—¶ï¼Œåˆ™éœ€è¦æ‰©å®¹å’Œè¿ç§»æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŸºäºæ•°ç»„</span><br><span class="hljs-keyword">transient</span> Object[] elements; <span class="hljs-comment">// non-private to simplify nested class access</span><br></code></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¸¦å®¹é‡çš„åˆå§‹åŒ–</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArrayDeque</span><span class="hljs-params">(<span class="hljs-type">int</span> numElements)</span> &#123;<br>    allocateElements(numElements);<br>&#125;<br><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateSize</span><span class="hljs-params">(<span class="hljs-type">int</span> numElements)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">initialCapacity</span> <span class="hljs-operator">=</span> MIN_INITIAL_CAPACITY;<br>    <span class="hljs-comment">// Find the best power of two to hold elements.</span><br>    <span class="hljs-comment">// Tests &quot;&lt;=&quot; because arrays aren&#x27;t kept full.</span><br>    <span class="hljs-keyword">if</span> (numElements &gt;= initialCapacity) &#123;<br>        initialCapacity = numElements;<br>        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">1</span>);<br>        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">2</span>);<br>        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">4</span>);<br>        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="hljs-number">8</span>);<br>        initialCapacity |= (initialCapacity &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>        initialCapacity++;<br><br>        <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)   <span class="hljs-comment">// Too many elements, must back off</span><br>            initialCapacity &gt;&gt;&gt;= <span class="hljs-number">1</span>;<span class="hljs-comment">// Good luck allocating 2 ^ 30 elements</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> initialCapacity;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒéœ€è¦æ‰¾åˆ°ä½ å½“å‰ä¼ è¾“å€¼æœ€å°çš„ 2 çš„å€æ•°çš„ä¸€ä¸ªå®¹é‡ã€‚è¿™ä¸ HashMap çš„åˆå§‹åŒ–è¿‡ç¨‹ç›¸ä¼¼</p><h2 id="å…¥æ ˆ"><a href="#å…¥æ ˆ" class="headerlink" title="å…¥æ ˆ"></a>å…¥æ ˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFirst</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-keyword">if</span> (e == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br>    elements[head = (head - <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>)] = e;<br>    <span class="hljs-keyword">if</span> (head == tail)<br>        doubleCapacity();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLast</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-keyword">if</span> (e == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br>    elements[tail] = e;<br>    <span class="hljs-keyword">if</span> ( (tail = (tail + <span class="hljs-number">1</span>) &amp; (elements.length - <span class="hljs-number">1</span>)) == head)<br>        doubleCapacity();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†å…¥æ ˆå…ƒç´ ï¼Œå…¶å®å°±æ˜¯ç»™æ•°ç»„èµ‹å€¼</p><ol><li><p>åœ¨ addFirst()ä¸­ï¼Œå®šä½ä¸‹æ ‡ï¼Œhead &#x3D; (head - 1) &amp; (elements.length - 1)ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°ç»„é•¿åº¦æ˜¯ 2^n çš„å€æ•°ï¼Œæ‰€ä»¥ 2^n - 1 å°±æ˜¯ä¸€ä¸ªå…¨æ˜¯ 1 çš„äºŒè¿›åˆ¶æ•°ï¼Œå¯ä»¥ç”¨äºä¸è¿ç®—å¾—å‡ºæ•°ç»„ä¸‹æ ‡ã€‚</p></li><li><p>åŒæ · addLast()ä¸­ï¼Œä¹Ÿä½¿ç”¨äº†ç›¸åŒçš„æ–¹å¼å®šä½ä¸‹æ ‡ï¼Œåªä¸è¿‡å®ƒæ˜¯ä» 0 å¼€å§‹ï¼Œå¾€ä¸Šå¢åŠ </p></li><li><p>æœ€åï¼Œå½“å¤´(head)ä¸å°¾(tile)ç›¸ç­‰æ—¶ï¼Œæ•°ç»„åˆ™éœ€è¦ä¸¤å€æ‰©å®¹ <code>doubleCapacity</code></p></li><li><p><code>head = 0;tail = n;</code>ï¼Œheadå’Œtailåœ¨åˆå§‹åŒ–æ—¶è¢«èµ‹çš„å€¼ï¼Œå…¶å®æ˜¯å ç”¨äº†é¢å¤–çš„ä¸€ä¸ªæ ¼å­å»æ”¾å¤´ç»“ç‚¹</p></li></ol><h2 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doubleCapacity</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">assert</span> <span class="hljs-variable">head</span> <span class="hljs-operator">=</span>= tail;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> head;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> elements.length;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> n - p; <span class="hljs-comment">// number of elements to the right of p</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> n &lt;&lt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (newCapacity &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Sorry, deque too big&quot;</span>);<br>    Object[] a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[newCapacity];<br>    System.arraycopy(elements, p, a, <span class="hljs-number">0</span>, r);<br>    System.arraycopy(elements, <span class="hljs-number">0</span>, a, r, p);<br>    elements = a;<br>    head = <span class="hljs-number">0</span>;<br>    tail = n;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®ä»¥ä¸Šè¿™éƒ¨åˆ†æºç ï¼Œå°±æ˜¯è¿›è¡Œä¸¤å€<code>n &lt;&lt; 1</code>æ‰©å®¹ï¼ŒåŒæ—¶æŠŠä¸¤ç«¯æ•°æ®è¿ç§»è¿›æ–°çš„æ•°ç»„</p><h1 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h1><p><code>Linkedlist</code>å¤©ç”Ÿå°±å¯ä»¥æ”¯æŒåŒç«¯é˜Ÿåˆ—ï¼Œè€Œä¸”ä»å¤´å°¾å–æ•°æ®ä¹Ÿæ˜¯å®ƒæ—¶é—´å¤æ‚åº¦ O(1)çš„ã€‚åŒæ—¶æ•°æ®çš„æ’å…¥å’Œåˆ é™¤ä¹Ÿä¸éœ€è¦åƒæ•°ç»„é˜Ÿåˆ—é‚£æ ·æ‹·è´æ•°æ®ï¼Œè™½ç„¶ <code>Linkedlist</code>æœ‰è¿™äº›ä¼˜ç‚¹ï¼Œä½†ä¸èƒ½è¯´ <code>ArrayDeque </code>å› ä¸ºæœ‰æ•°ç»„å¤åˆ¶æ€§èƒ½æ¯”å®ƒä½</p><p><code>LinkedList</code>åœ¨åŠŸèƒ½ä½“ç°ä¸Šå’Œ<code>ArrayDeque</code>æ˜¯å·®ä¸å¤šçš„</p><h2 id="å…¥æ ˆã€å‡ºæ ˆæºç "><a href="#å…¥æ ˆã€å‡ºæ ˆæºç " class="headerlink" title="å…¥æ ˆã€å‡ºæ ˆæºç "></a>å…¥æ ˆã€å‡ºæ ˆæºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">linkFirst</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; f = first;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(<span class="hljs-literal">null</span>, e, f);<br>    first = newNode;<br>    <span class="hljs-keyword">if</span> (f == <span class="hljs-literal">null</span>)<br>        last = newNode;<br>    <span class="hljs-keyword">else</span><br>        f.prev = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">linkLast</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; l = last;<br>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(l, e, <span class="hljs-literal">null</span>);<br>    last = newNode;<br>    <span class="hljs-keyword">if</span> (l == <span class="hljs-literal">null</span>)<br>        first = newNode;<br>    <span class="hljs-keyword">else</span><br>        l.next = newNode;<br>    size++;<br>    modCount++;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯ç»™é“¾è¡¨çš„é¦–å°¾èŠ‚ç‚¹æ’å…¥å…ƒç´ ï¼Œå› ä¸ºè¿™æ˜¯é“¾è¡¨ç»“æ„ï¼Œæ‰€ä»¥ä¹Ÿä¸å­˜åœ¨æ‰©å®¹ï¼Œåªéœ€è¦æŠŠåŒå‘é“¾è·¯é“¾æ¥ä¸Šå³å¯</p><h1 id="DelayQueue"><a href="#DelayQueue" class="headerlink" title="DelayQueue"></a>DelayQueue</h1><p>åœ¨ <code>Java </code>çš„é˜Ÿåˆ—æ•°æ®ç»“æ„ä¸­ï¼Œè¿˜æœ‰ä¸€ç§é˜Ÿåˆ—æ˜¯å»¶æ—¶é˜Ÿåˆ—ï¼Œå¯ä»¥é€šè¿‡è®¾å®šå­˜æ”¾æ—¶é—´ï¼Œä¾æ¬¡è½®è®­è·å–</p><p>DelayQueue æ˜¯ä¸€ä¸ª BlockingQueue ï¼ˆæ— ç•Œé˜»å¡ï¼‰é˜Ÿåˆ—ï¼Œå®ƒæœ¬è´¨å°±æ˜¯å°è£…äº†ä¸€ä¸ª PriorityQueue ï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰ï¼Œå¹¶åŠ ä¸Šäº†å»¶æ—¶åŠŸèƒ½ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼ŒDelayQueue å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriorityQueueï¼‰å®ç°çš„ BlockingQueueï¼Œä¼˜å…ˆé˜Ÿåˆ—çš„æ¯”è¾ƒåŸºå‡†å€¼æ˜¯æ—¶é—´</p><p>å³ï¼š<strong>DelayQueue &#x3D; BlockingQueue + PriorityQueue + Delayed</strong></p><p>è¦å®ç° DelayQueue å»¶æ—¶é˜Ÿåˆ—ï¼Œé˜Ÿä¸­å…ƒç´ è¦ implements Delayed æ¥å£ï¼Œè¿™ä¸ªæ¥å£é‡Œåªæœ‰ä¸€ä¸ª getDelay æ–¹æ³•ï¼Œç”¨äºè®¾ç½®å»¶æœŸæ—¶é—´ã€‚Delayed ç”±å®ç°äº† Comparable æ¥å£ï¼Œ compareTo æ–¹æ³•è´Ÿè´£å¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œæ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestDelayed</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Delayed</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String str;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> time;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestDelayed</span><span class="hljs-params">(String str, <span class="hljs-type">long</span> time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-built_in">this</span>.str = str;<br>        <span class="hljs-built_in">this</span>.time = System.currentTimeMillis() + (time &gt; <span class="hljs-number">0</span> ? unit.toMillis(time) : <span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getDelay</span><span class="hljs-params">(TimeUnit unit)</span> &#123;<br>        <span class="hljs-keyword">return</span> time - System.currentTimeMillis();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Delayed o)</span> &#123;<br>        <span class="hljs-type">TestDelayed</span> <span class="hljs-variable">work</span> <span class="hljs-operator">=</span> (TestDelayed) o;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.time - work.time;<br>        <span class="hljs-keyword">if</span> (diff &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> str;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_DelayQueue</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    DelayQueue&lt;TestDelayed&gt; delayQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayQueue</span>&lt;TestDelayed&gt;();<br>    delayQueue.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestDelayed</span>(<span class="hljs-string">&quot;aaa&quot;</span>, <span class="hljs-number">5</span>, TimeUnit.SECONDS));<br>    delayQueue.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestDelayed</span>(<span class="hljs-string">&quot;ccc&quot;</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS));<br>    delayQueue.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestDelayed</span>(<span class="hljs-string">&quot;bbb&quot;</span>, <span class="hljs-number">3</span>, TimeUnit.SECONDS));<br><br>    logger.info(((TestDelayed) delayQueue.take()).getStr());<br>    logger.info(((TestDelayed) delayQueue.take()).getStr());<br>    logger.info(((TestDelayed) delayQueue.take()).getStr());<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…¥æ ˆ-1"><a href="#å…¥æ ˆ-1" class="headerlink" title="å…¥æ ˆ"></a>å…¥æ ˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">offer</span><span class="hljs-params">(E e)</span> &#123;<br>    <span class="hljs-comment">// ReentrantLock å¯é‡å…¥é”</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;<br>    lock.lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        q.offer(e);<br>        <span class="hljs-keyword">if</span> (q.peek() == e) &#123;<br>            leader = <span class="hljs-literal">null</span>;<br>            available.signal();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        lock.unlock();<br>    &#125;<br>&#125;<br><br>------PriorityQueue.java-----------<br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftUpUsingComparator</span><span class="hljs-params">(<span class="hljs-type">int</span> k, E x)</span> &#123;<br>    <span class="hljs-keyword">while</span> (k &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> (k - <span class="hljs-number">1</span>) &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> queue[parent];<br>        <span class="hljs-keyword">if</span> (comparator.compare(x, (E) e) &gt;= <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">break</span>;<br>        queue[k] = e;<br>        k = parent;<br>    &#125;<br>    queue[k] = x;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>DelayQueue </code>æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥åŠ¨æ€æ‰©å®¹ï¼Œå¦å¤–å®ƒæ’å…¥å…ƒç´ çš„é¡ºåºå¹¶ä¸å½±å“æœ€ç»ˆçš„è¾“å‡ºé¡ºåºã€‚</li><li>è€Œå…ƒç´ çš„æ’åºä¾èµ–äº <code>compareTo </code>æ–¹æ³•è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯ä¼‘çœ çš„æ—¶é—´é•¿çŸ­å†³å®šçš„ã€‚</li><li>åŒæ—¶åªæœ‰å®ç°äº† <code>Delayed </code>æ¥å£ï¼Œæ‰èƒ½å­˜æ”¾å…ƒç´ ã€‚</li></ul><h2 id="å‡ºæ ˆ"><a href="#å‡ºæ ˆ" class="headerlink" title="å‡ºæ ˆ"></a>å‡ºæ ˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;<br>    lock.lockInterruptibly();<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-type">E</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> q.peek();<br>            <span class="hljs-keyword">if</span> (first == <span class="hljs-literal">null</span>)<br>                available.await();<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> first.getDelay(NANOSECONDS);<br>                <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">0</span>)<br>                    <span class="hljs-keyword">return</span> q.poll();<br>                first = <span class="hljs-literal">null</span>; <span class="hljs-comment">// don&#x27;t retain ref while waiting</span><br>                <span class="hljs-keyword">if</span> (leader != <span class="hljs-literal">null</span>)<br>                    available.await();<br>                <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-type">Thread</span> <span class="hljs-variable">thisThread</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>                    leader = thisThread;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        available.awaitNanos(delay);<br>                    &#125; <span class="hljs-keyword">finally</span> &#123;<br>                        <span class="hljs-keyword">if</span> (leader == thisThread)<br>                            leader = <span class="hljs-literal">null</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (leader == <span class="hljs-literal">null</span> &amp;&amp; q.peek() != <span class="hljs-literal">null</span>)<br>            available.signal();<br>        lock.unlock();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å…¶å®ƒé˜Ÿåˆ—"><a href="#å…¶å®ƒé˜Ÿåˆ—" class="headerlink" title="å…¶å®ƒé˜Ÿåˆ—"></a>å…¶å®ƒé˜Ÿåˆ—</h1><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081954303.png" alt="image-20220708195416153"></p><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207081954758.png" alt="image-20220708195432687"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataQueueStack</span> &#123;<br>    <span class="hljs-keyword">private</span> BlockingQueue&lt;DataBean&gt; dataQueue = <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataQueueStack</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//å®ä¾‹åŒ–é˜Ÿåˆ—</span><br>        dataQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;DataBean&gt;(<span class="hljs-number">100</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dataBean</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">doOfferData</span><span class="hljs-params">(DataBean dataBean)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> dataQueue.offer(dataBean, <span class="hljs-number">2</span>, TimeUnit.SECONDS);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼¹å‡ºé˜Ÿåˆ—æ•°æ®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> DataBean <span class="hljs-title function_">doPollData</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> dataQueue.poll(<span class="hljs-number">2</span>, TimeUnit.SECONDS);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å¾—é˜Ÿåˆ—æ•°æ®ä¸ªæ•°</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">doGetQueueCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dataQueue.size();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è¿™æ˜¯ä¸€ä¸ª <code>LinkedBlockingQueue </code>é˜Ÿåˆ—ä½¿ç”¨æ¡ˆä¾‹ï¼Œä¸€æ–¹é¢å­˜å‚¨æ•°æ®ï¼Œä¸€æ–¹é¢ä»é˜Ÿåˆ—ä¸­è·å–è¿›è¡Œæ¶ˆè´¹ã€‚</li><li>å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥åœ¨è·å–å…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šè¿›è¡Œé˜»å¡ã€‚</li><li><code>LinkedBlockingQueue </code>æ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå†…éƒ¨ç”±ä¸¤ä¸ª <code>ReentrantLock </code>æ¥å®ç°å‡ºå…¥é˜Ÿåˆ—çš„çº¿ç¨‹å®‰å…¨ï¼Œç”±å„è‡ªçš„ <code>Condition </code>å¯¹è±¡çš„ <code>await </code>å’Œ <code>signal </code>æ¥å®ç°ç­‰å¾…å’Œå”¤é†’åŠŸèƒ½</li></ul>]]></content>
    
    
    <categories>
      
      <category>æºç </category>
      
    </categories>
    
    
    <tags>
      
      <tag>æºç </tag>
      
      <tag>é˜Ÿåˆ—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ‡é¢˜</title>
    <link href="/2022/07/07/2022-1-1-%E6%A8%A1%E6%9D%BF/"/>
    <url>/2022/07/07/2022-1-1-%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<p>content</p>]]></content>
    
    
    <categories>
      
      <category>åˆ†ç±»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ ‡ç­¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ArrayListæºç åˆ†æ</title>
    <link href="/2022/07/07/2022-7-7-ArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <url>/2022/07/07/2022-7-7-ArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArrayList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;<br>&#125;<br><br><span class="hljs-comment">// DEFAULTCAPACITY_EMPTY_ELEMENTDATA å·²ç»è¢«æå‰å®šä¹‰å¥½äº†</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;; <br><br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArrayList</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity)</span> &#123;<br>        <span class="hljs-keyword">if</span> (initialCapacity &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">this</span>.elementData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[initialCapacity];<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (initialCapacity == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">this</span>.elementData = EMPTY_ELEMENTDATA;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Illegal Capacity: &quot;</span>+<br>                                               initialCapacity);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><ul><li>é€šå¸¸æƒ…å†µç©ºæ„é€ å‡½æ•°åˆå§‹åŒ–ArrayListæ›´å¸¸ç”¨ï¼Œè¿™ç§æ–¹å¼æ•°ç»„çš„é•¿åº¦ä¼šåœ¨ä»¥ä¸€æ¬¡æ’å…¥æ•°æ®æ—¶å€™è¿›è¡Œè®¾ç½®</li><li>ç¬¬äºŒç§æƒ…å†µï¼Œå½“æˆ‘ä»¬å·²è¿‘çŸ¥é“è¦å¡«å…¥å¤šå°‘ä¸ªå…ƒç´ åˆ°ArrayListä¸­äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å“ˆå°±å¯ä»¥ç›´æ¥åˆå§‹åŒ–ä¸€ä¸ªé¢„å…ˆè®¾å®šå¥½çš„é•¿åº¦ï¼Œä»¥è¾¾åˆ°æä¾›æ€§èƒ½ï¼Œå‡å°‘ArrayListä¸­çš„æ‹·è´æ“ä½œï¼Œå½“ç„¶è¿™ç§æƒ…å†µä¸‹æ•°ç»„çš„é•¿åº¦ä¾æ—§ä¼šåœ¨ä»¥ä¸€æ¬¡æ’å…¥æ•°æ®æ—¶å€™è¿›è¡Œè®¾ç½®</li></ul><h2 id="æ™®é€šæ–¹å¼"><a href="#æ™®é€šæ–¹å¼" class="headerlink" title="æ™®é€šæ–¹å¼"></a>æ™®é€šæ–¹å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ArrayList&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>list.add(<span class="hljs-number">1</span>);<br>list.add(<span class="hljs-number">2</span>);<br>list.add(<span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure><h2 id="Arrays-asList"><a href="#Arrays-asList" class="headerlink" title="Arrays.asList"></a>Arrays.asList</h2><p>é€šè¿‡ <code>Arrays.asList</code> ä¼ é€’ç»™ <code>ArrayList </code>æ„é€ å‡½æ•°çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArrayList</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> &#123;<br>    elementData = c.toArray();<br>    <span class="hljs-keyword">if</span> ((size = elementData.length) != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span><br>        <span class="hljs-keyword">if</span> (elementData.getClass() != Object[].class)<br>            elementData = Arrays.copyOf(elementData, size, Object[].class);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// replace with empty array.</span><br>        <span class="hljs-built_in">this</span>.elementData = EMPTY_ELEMENTDATA;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡æ„é€ å‡½æ•°å¯ä»¥çœ‹åˆ°ï¼Œåªè¦å®ç° Collection ç±»çš„éƒ½å¯ä»¥ä½œä¸ºå…¥å‚</li><li>åœ¨é€šè¿‡è½¬ä¸ºæ•°ç»„ä»¥åŠæ‹·è´ Arrays.copyOf åˆ° Object[]é›†åˆä¸­åœ¨èµ‹å€¼ç»™å±æ€§elementData</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">t</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Integer&gt; list1 = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>    System.out.println(<span class="hljs-string">&quot;é€šè¿‡æ•°ç»„è½¬æ¢ï¼š&quot;</span> + (list1.toArray().getClass() == Object[].class));<br>    <br>    ArrayList&lt;Integer&gt; list2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));<br>    System.out.println(<span class="hljs-string">&quot;é€šè¿‡é›†åˆè½¬æ¢ï¼š&quot;</span> + (list2.toArray().getClass() == Object[].class));<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">é€šè¿‡æ•°ç»„è½¬æ¢ï¼šfalse</span><br><span class="hljs-comment">é€šè¿‡é›†åˆè½¬æ¢ï¼štrue</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p><code>public Object[] toArray()</code> è¿”å›çš„ç±»å‹ä¸ä¸€å®šå°±æ˜¯ <code>Object[]</code>ï¼Œå…¶ç±»å‹å–å†³äºå…¶è¿”å›çš„å®é™…ç±»å‹ï¼Œæ¯•ç«Ÿ <code>Object </code>æ˜¯çˆ¶ç±»ï¼Œå®ƒå¯ä»¥æ˜¯å…¶ä»–ä»»æ„ç±»å‹</p><p>å­ç±»å®ç°å’Œçˆ¶ç±»åŒåçš„æ–¹æ³•ï¼Œä»…ä»…è¿”å›å€¼ä¸ä¸€è‡´æ—¶ï¼Œé»˜è®¤è°ƒç”¨çš„æ˜¯å­ç±»çš„å®ç°æ–¹æ³•</p><p>é€ æˆè¿™ä¸ªç»“æœçš„åŸå› ï¼Œå¦‚ä¸‹ï¼›</p><ol><li><code>Arrays.asList</code> ä½¿ç”¨çš„æ˜¯ï¼š<code>Arrays.copyOf(this.a, size,(Class&lt;? extends T[]&gt;) a.getClass());</code></li><li><code>ArrayList</code> æ„é€ å‡½æ•°ä½¿ç”¨çš„æ˜¯ï¼š<code>Arrays.copyOf(elementData, size, Object[].class);</code></li></ol><hr><ul><li>Arrays.asList æ„å»ºçš„é›†åˆï¼Œä¸èƒ½èµ‹å€¼ç»™ ArrayList</li><li>Arrays.asList æ„å»ºçš„é›†åˆï¼Œä¸èƒ½å†æ·»åŠ å…ƒç´ </li><li>Arrays.asList æ„å»ºçš„é›†åˆï¼Œä¸èƒ½å†åˆ é™¤å…ƒç´ </li></ul><blockquote><p>åœ¨å®˜æ–¹æ–‡æ¡£å°±å·²ç»è¯´æ˜è¿”å›çš„æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„é›†åˆ</p></blockquote><p>å…¶å®é€ æˆä¸Šé¢ç»“æœçš„åŸå› æ˜¯è¿™ä¸¤ä¸ª<code>List</code>ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œè€Œä¸”<code>Arrays</code>ä¸‹çš„<code>ArrayList</code>æ˜¯ä¸€ä¸ªç§æœ‰ç±»ï¼Œåªèƒ½é€šè¿‡asListä½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬åˆ›å»º</p><p>è¿™ä¸ªArrayListä¸èƒ½æ·»åŠ å’Œåˆ é™¤ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒçš„å®ç°æ–¹å¼ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªæ•°ç»„</p><blockquote><p><code>Arrays </code>æ˜¯ä¸€ä¸ªå·¥å…·åŒ…ï¼Œé‡Œé¢è¿˜æœ‰ä¸€äº›éå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼›äºŒåˆ†æŸ¥æ‰¾<code>Arrays.binarySearch</code>ã€æ’åº <code>Arrays.sort</code> ç­‰</p></blockquote><h2 id="Collections-ncopies"><a href="#Collections-ncopies" class="headerlink" title="Collections.ncopies"></a>Collections.ncopies</h2><p><code>Collections.nCopies</code> æ˜¯é›†åˆæ–¹æ³•ä¸­ç”¨äºç”Ÿæˆå¤šå°‘ä»½æŸä¸ªæŒ‡å®šå…ƒç´ çš„æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±ç”¨å®ƒæ¥åˆå§‹åŒ– ArrayListï¼Œå¦‚ä¸‹ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ArrayList&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;(Collections.nCopies(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>));<br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¼šåˆå§‹åŒ–ä¸€ä¸ªç”± 10 ä¸ª 0 ç»„æˆçš„é›†åˆ</p></blockquote><h1 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h1><h2 id="æ™®é€šæ’å…¥"><a href="#æ™®é€šæ’å…¥" class="headerlink" title="æ™®é€šæ’å…¥"></a>æ™®é€šæ’å…¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Appends the specified element to the end of this list.</span><br><span class="hljs-comment">   å°†æŒ‡å®šå…ƒç´ é™„åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> e element to be appended to this list</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@code</span> true&#125; (as specified by &#123;<span class="hljs-doctag">@link</span> Collection#add&#125;)</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> &#123;<br>    modCount++;<br>    add(e, elementData, size);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ’å…¥æ—¶æ‰©å®¹"><a href="#æ’å…¥æ—¶æ‰©å®¹" class="headerlink" title="æ’å…¥æ—¶æ‰©å®¹"></a>æ’å…¥æ—¶æ‰©å®¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> &#123;<br>    rangeCheckForAdd(index);<br>    modCount++;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> s;<br>    Object[] elementData;<br>    <span class="hljs-keyword">if</span> ((s = size) == (elementData = <span class="hljs-built_in">this</span>.elementData).length)<br>        elementData = grow();<br>    System.arraycopy(elementData, index,<br>                     elementData, index + <span class="hljs-number">1</span>,<br>                     s - index);<br>    elementData[index] = element;<br>    size = s + <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rangeCheckForAdd</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>    <span class="hljs-keyword">if</span> (index &gt; size || index &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>    Objects.checkIndex(index, size);<br>    <span class="hljs-keyword">final</span> Object[] es = elementData;<br><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="hljs-type">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> (E) es[index];<br>    fastRemove(es, index);<br><br>    <span class="hljs-keyword">return</span> oldValue;<br>&#125;<br><br><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fastRemove</span><span class="hljs-params">(Object[] es, <span class="hljs-type">int</span> i)</span> &#123;<br>    modCount++;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> newSize;<br>    <span class="hljs-keyword">if</span> ((newSize = size - <span class="hljs-number">1</span>) &gt; i)<br>        System.arraycopy(es, i + <span class="hljs-number">1</span>, es, i, newSize - i);<br>    es[size = newSize] = <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h1>]]></content>
    
    
    <categories>
      
      <category>æºç </category>
      
    </categories>
    
    
    <tags>
      
      <tag>æºç </tag>
      
      <tag>ArrayList</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HashMapæºç åˆ†æ</title>
    <link href="/2022/07/06/2022-7-6-HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <url>/2022/07/06/2022-7-6-HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Begin"><a href="#Begin" class="headerlink" title="Begin"></a>Begin</h1><ul><li><p>HashMapæœ€æ—©å‡ºç°åœ¨JDK1.2ä¸­,åº•å±‚åŸºäºæ•£åˆ—ç®—æ³•å®ç°</p></li><li><p>HashMapå…è®¸nulé”®å’Œnullå€¼</p></li><li><p>HashMapå¹¶ä¸ä¿è¯é”®å€¼å¯¹çš„é¡ºåº</p></li><li><p>HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„</p></li><li><p>ç­‰ç­‰â€¦</p></li></ul><blockquote><p>åœ¨JDK1.7æ—¶,HashMapé‡‡ç”¨çš„æ˜¯æ•°ç»„+é“¾è¡¨,ä½†æ˜¯åœ¨JDK1.8çš„æ—¶å€™,HashMapé‡‡ç”¨çš„æ˜¯æ•°ç»„åŠ {é“¾è¡¨æˆ–çº¢é»‘æ ‘}</p></blockquote><h1 id="åˆæ­¥äº†è§£HashMap"><a href="#åˆæ­¥äº†è§£HashMap" class="headerlink" title="åˆæ­¥äº†è§£HashMap"></a>åˆæ­¥äº†è§£HashMap</h1><blockquote><p>ä»æ ¹æºå»çœ‹,å¦‚æœè¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸€å †å­—ç¬¦ä¸²,æˆ‘æƒ³è¦å°†ä»–å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­,å¹¶è¦æ±‚è·å–æ¯ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1),è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨HashMap</p></blockquote><p>æˆ‘ä»¬åªéœ€è¦é€šè¿‡æŸç§æ–¹å¼å»è®¡ç®—å•ä¸ªå­—ç¬¦çš„ç´¢å¼•ä¸‹æ ‡å³å¯,å°±åƒä¸‹é¢è¿™æ ·</p><p>å…¶ä¸­<code>key.hashCode() &amp; (tab.length - 1)</code>å…¶å®å°±æ˜¯<code>key.hashCode()</code>å¯¹8è¿›è¡Œå–ä½™</p><blockquote><p>è®°xä¸º2çš„å¹‚æ¬¡æ–¹</p><p>è¿™ä¸ª&amp;è¿ç®—å–ä½™çš„æ“ä½œåªé€‚ç”¨äºå¯¹xè¿™æ ·çš„è¿›è¡Œæ“ä½œ,å°±æ˜¯&amp;ä¸€ä¸ª2çš„å¹‚æ¬¡æ–¹ - 1,å°±ç­‰åŒäºå¯¹xè¿›è¡Œå–ä½™</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šä¹‰è¦å­˜æ”¾çš„æ•°ç»„</span><br>String[] tab = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">8</span>];<br><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abc&quot;</span>;<br><br><span class="hljs-comment">// è®¡ç®—ç´¢å¼•ä½ç½®</span><br><span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> key.hashCode() &amp; (tab.length - <span class="hljs-number">1</span>);  <br>tab[idx] = key;<br></code></pre></td></tr></table></figure><h1 id="æ‰°åŠ¨å‡½æ•°"><a href="#æ‰°åŠ¨å‡½æ•°" class="headerlink" title="æ‰°åŠ¨å‡½æ•°"></a>æ‰°åŠ¨å‡½æ•°</h1><blockquote><p>é¡¾åæ€ä¹‰,è¯¥å‡½æ•°æ˜¯ä¸ºäº†å¢åŠ éšæœºæ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡º<code>hashCode</code>çš„è¿”å›å€¼æ˜¯<code>int</code>ç±»å‹,ä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶æ˜¯32ä½,é‚£ä¹ˆæ­¤æ—¶<code>hashCode</code>çš„å–å€¼èŒƒå›´æ˜¯[-2147483648, 2147483647],é•¿åº¦å¾ˆå¤§,åœ¨åˆå§‹åŒ–æ•°ç»„æ—¶å€™ä¸ä¼šå»å°†æ•°ç»„åˆå§‹åŒ–è¿™ä¹ˆå¤§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * The default initial capacity - MUST be a power of two.</span><br><span class="hljs-comment"> ===å®¹é‡å¿…é¡»æ˜¯2çš„å¹‚,[2,4,8,16,32...]===</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_INITIAL_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">4</span>; <span class="hljs-comment">// aka 16</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°,åˆå§‹åŒ–çš„æ—¶å€™,ä¼šå°†è¿™ä¸ªæ•°ç»„é•¿åº¦åˆå§‹åŒ–ä¸º16,ä½†æ˜¯æˆ‘ä»¬è·å¾—çš„<code>hashcode</code>æ˜¯32ä½,ä¸èƒ½ç›´æ¥ä½¿ç”¨,æ‰€ä»¥éœ€è¦å¯¹æ•°ç»„çš„é•¿åº¦è¿›è¡Œå–æ¨¡å¾—åˆ°ä¸‹æ ‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-type">int</span> h;<br>    <span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>hashMap</code>æºç è¿™é‡Œä¸åªæ˜¯ç›´æ¥è·å–å“ˆå¸Œå€¼,è¿˜è¿›è¡Œäº†ä¸€æ¬¡æ‰°åŠ¨è®¡ç®—,<code>(h =key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>.æŠŠå“ˆå¸Œå€¼å³ç§» 16 ä½,ä¹Ÿå°±æ­£å¥½æ˜¯è‡ªå·±é•¿åº¦çš„ä¸€åŠ,ä¹‹åä¸åŸå“ˆå¸Œå€¼åšå¼‚æˆ–è¿ç®—,è¿™æ ·å°±æ··åˆäº†åŸå“ˆå¸Œå€¼ä¸­çš„é«˜ä½å’Œä½ä½,å¢å¤§äº†éšæœºæ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">00000000001011</span> <span class="hljs-number">1011001101000110</span>  <span class="hljs-comment">//  åˆå§‹  &quot;å°èµµ&quot;.hashCode()</span><br><span class="hljs-number">00000000000000</span> <span class="hljs-number">0000000000001011</span>  <span class="hljs-comment">//  &gt;&gt;&gt; 16</span><br><span class="hljs-number">00000000001011</span> <span class="hljs-number">1011001101001101</span>  <span class="hljs-comment">//  ^</span><br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿä»”ç»†çš„è¯,è¿˜å¯ä»¥å‘ç°<code>(key == null) ? 0  : (h </code>,è¯´æ˜<code>HashMap</code>å¯ä»¥<code>key</code>ä¸º<code>null</code>,ä¸”æ­¤æ—¶çš„<code>hash</code>å€¼ä¸º0</p><ul><li>ä½¿ç”¨æ‰°åŠ¨å‡½æ•°å°±æ˜¯ä¸ºäº†å¢åŠ éšæœºæ€§,è®©æ•°æ®å…ƒç´ æ›´åŠ å‡è¡¡çš„æ•£åˆ—,å‡å°‘ç¢°æ’</li></ul><h1 id="åˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½å› å­"><a href="#åˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½å› å­" class="headerlink" title="åˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½å› å­"></a>åˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½å› å­</h1><h2 id="åˆå§‹åŒ–å®¹é‡"><a href="#åˆå§‹åŒ–å®¹é‡" class="headerlink" title="åˆå§‹åŒ–å®¹é‡"></a>åˆå§‹åŒ–å®¹é‡</h2><p>å¯ä»¥å…ˆçœ‹ä¸‹é¢è¿™ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span>  initialCapacity åˆå§‹åŒ–å®¹é‡</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span>  loadFactor      è´Ÿè½½å› å­</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">HashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity, <span class="hljs-type">float</span> loadFactor)</span> &#123;<br>    ...<br>    <span class="hljs-built_in">this</span>.loadFactor = loadFactor;<br>    <span class="hljs-built_in">this</span>.threshold = tableSizeFor(initialCapacity); <span class="hljs-comment">// é˜ˆå€¼</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é˜€å€¼ <code>threshold</code>,é€šè¿‡æ–¹æ³• <code>tableSizeFor </code>è¿›è¡Œè®¡ç®—,æ˜¯æ ¹æ®åˆå§‹åŒ–æ¥è®¡ç®—çš„</li><li>è¿™ä¸ªæ–¹æ³•ä¹Ÿå°±æ˜¯è¦å¯»æ‰¾æ¯”åˆå§‹å€¼å¤§çš„,æœ€å°çš„é‚£ä¸ª2<code>è¿›åˆ¶</code>æ•°å€¼.æ¯”å¦‚ä¼ äº†<code>17</code>,æˆ‘åº”è¯¥æ‰¾åˆ°çš„æ˜¯<code>32</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è®¡ç®—é˜ˆå€¼å¤§å°çš„æ–¹æ³•</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tableSizeFor</span><span class="hljs-params">(<span class="hljs-type">int</span> cap)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> cap - <span class="hljs-number">1</span>;<br>    n |= n &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>    n |= n &gt;&gt;&gt; <span class="hljs-number">2</span>;<br>    n |= n &gt;&gt;&gt; <span class="hljs-number">4</span>;<br>    n |= n &gt;&gt;&gt; <span class="hljs-number">8</span>;<br>    n |= n &gt;&gt;&gt; <span class="hljs-number">16</span>;<br>    <span class="hljs-keyword">return</span> (n &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-comment">// æœ€å¤§å®¹é‡</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAXIMUM_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>; <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåœ°æ–¹è®¡ç®—é˜ˆå€¼æ˜¯å…ˆè¦å°†<code>cap-1</code>,å†å°†ä»–æœ€é«˜ä½å¾€ä¸‹å…¨éƒ¨å˜æˆ<code>1</code>(<code>1111111</code>),æœ€åå†<code>cap+1</code>,ä¼šå˜æˆ<code>1000000</code>è¿™ä¸ªæ ·å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆå§‹å€¼æˆ‘ä»¬ç”¨ 17   -&gt;    17 - 1  =  16</span><br><span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-comment">// n |= n &gt;&gt;&gt; 1;</span><br><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span><span class="hljs-comment">// n |= n &gt;&gt;&gt; 2;</span><br><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-comment">// n |= n &gt;&gt;&gt; 4;</span><br><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span><span class="hljs-comment">// n |= n &gt;&gt;&gt; 8;</span><br><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">1</span>   <span class="hljs-comment">// n |= n &gt;&gt;&gt; 16;</span><br><span class="hljs-comment">// æœ€å+1</span><br><span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span><span class="hljs-comment">// 32    </span><br></code></pre></td></tr></table></figure><h2 id="è´Ÿè½½å› å­"><a href="#è´Ÿè½½å› å­" class="headerlink" title="è´Ÿè½½å› å­"></a>è´Ÿè½½å› å­</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">DEFAULT_LOAD_FACTOR</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.75f</span>;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥,è¦é€‰æ‹©ä¸€ä¸ªåˆç†çš„å¤§å°ä¸‹è¿›è¡Œæ‰©å®¹,é»˜è®¤å€¼ 0.75 å°±æ˜¯è¯´å½“é˜€å€¼å®¹é‡å äº†3&#x2F;4 æ—¶èµ¶ç´§æ‰©å®¹,å‡å°‘ Hash ç¢°æ’</p><p>åŒæ—¶ 0.75 æ˜¯ä¸€ä¸ªé»˜è®¤æ„é€ å€¼,åœ¨åˆ›å»º HashMap ä¹Ÿå¯ä»¥è°ƒæ•´,æ¯”å¦‚ä½ å¸Œæœ›ç”¨æ›´å¤šçš„ç©ºé—´æ¢å–æ—¶é—´,å¯ä»¥æŠŠè´Ÿè½½å› å­è°ƒçš„æ›´å°ä¸€äº›,å‡å°‘ç¢°æ’</p><h1 id="æ‰©å®¹å…ƒç´ æ‹†åˆ†"><a href="#æ‰©å®¹å…ƒç´ æ‹†åˆ†" class="headerlink" title="æ‰©å®¹å…ƒç´ æ‹†åˆ†"></a>æ‰©å®¹å…ƒç´ æ‹†åˆ†</h1><p>è¿™ä¸ªåœ°æ–¹å¯ä»¥ä¸¾ä¸ªä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_hashMap</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    list.add(<span class="hljs-string">&quot;jlkk&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;lopi&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;jmdw&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;e4we&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;io98&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;nmhg&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;vfg6&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;gfrt&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;alpo&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;vfbh&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;bnhj&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;zuio&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;iu8e&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;yhjk&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;plop&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;dd0p&quot;</span>);<br><br>    <span class="hljs-keyword">for</span> (String key : list) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> key.hashCode() ^ (key.hashCode() &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>        System.out.println(<span class="hljs-string">&quot;å­—ç¬¦ä¸²:&quot;</span> + key + <span class="hljs-string">&quot; \tIdx(16):&quot;</span> + ((<span class="hljs-number">16</span> - <span class="hljs-number">1</span>) &amp; hash) + <span class="hljs-string">&quot; \tBitå€¼:&quot;</span> + Integer.toBinaryString(hash) + <span class="hljs-string">&quot; - &quot;</span> + Integer.toBinaryString(hash &amp; <span class="hljs-number">16</span>) + <span class="hljs-string">&quot; \t\tIdx(32):&quot;</span> + ((<span class="hljs-number">32</span> - <span class="hljs-number">1</span>) &amp; hash));<br>        System.out.println(Integer.toBinaryString(key.hashCode()) +<span class="hljs-string">&quot; &quot;</span>+ Integer.toBinaryString(hash) + <span class="hljs-string">&quot; &quot;</span> + Integer.toBinaryString((<span class="hljs-number">32</span> - <span class="hljs-number">1</span>) &amp; hash));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŠ½å–ä¸¤æ¡å†…å®¹å‡ºæ¥</span><br>å­—ç¬¦ä¸²:jlkk <span class="hljs-title function_">Idx</span><span class="hljs-params">(<span class="hljs-number">16</span>)</span>:<span class="hljs-number">3</span> Bit å€¼:<span class="hljs-number">1100011101001000010011</span> - <span class="hljs-number">10000</span> Idx(<span class="hljs-number">32</span>):<span class="hljs-number">19</span><br>hashcoded1100011101001000100010 <span class="hljs-number">1100011101001000010011</span> <span class="hljs-number">10011</span><br>    <br>å­—ç¬¦ä¸²:lopi <span class="hljs-title function_">Idx</span><span class="hljs-params">(<span class="hljs-number">16</span>)</span>:<span class="hljs-number">14</span> Bit å€¼:<span class="hljs-number">1100101100011010001110</span> - <span class="hljs-number">0</span> Idx(<span class="hljs-number">32</span>):<span class="hljs-number">14</span><br><span class="hljs-number">1100101100011010111100</span> <span class="hljs-number">1100101100011010001110</span> <span class="hljs-number">1110</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥å…ˆæ‰¾è§„å¾‹çš„å»çœ‹</p><p>å½“å®¹é‡ä¸º16æ—¶,å¯¹åº”çš„åæ ‡æ˜¯3å’Œ14,<code>(16 - 1) &amp; hash</code></p><p>å¯ä»¥æ³¨æ„åˆ°<code>hash &amp; 16</code>åˆ†åˆ«æ˜¯<code>10000</code>å’Œ<code>0</code>,16å¯¹åº”çš„äºŒè¿›åˆ¶æ˜¯<code>10000</code>,æ‰€ä»¥ä¸€ä¸ªæ•°å’Œä»–ç›¸ä¸,å¾—å‡ºæ¥çš„è¦ä¹ˆæ˜¯<code>10000</code>,è¦ä¹ˆæ˜¯<code>0</code></p><p><strong>å¦‚æœæ˜¯<code>0</code></strong>,æ˜¯ä¸æ˜¯å°±ä»£è¡¨ç€<code>hash</code>è¿™ä¸€ä½ä¸Šæ˜¯<code>0</code>,å¯ä»¥æ¨å‡º<code>(32 - 1) &amp; hash </code> &#x3D;&#x3D; <code>(16 - 1) &amp; hash</code> ,ä¹Ÿå°±æ˜¯ä½ç½®å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜</p><p><strong>åŒç†å¯ä»¥æ¨å‡ºä¸æ˜¯<code>0</code>çš„è¯</strong>,æˆ‘ä»¬å¯ä»¥è®©ä¸€å¼€å§‹æ±‚å¾—çš„ä¸‹æ ‡åŠ ä¸Š<code>16</code>,å°±å¾—åˆ°æ–°çš„æ‰©å®¹åçš„åæ ‡äº†</p><blockquote><p>è¿™ä¸ªåœ°æ–¹è®¾è®¡çš„éå¸¸å·§å¦™</p></blockquote><h1 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h1><h2 id="æ’å…¥æºç "><a href="#æ’å…¥æºç " class="headerlink" title="æ’å…¥æºç "></a>æ’å…¥æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;<br>    <span class="hljs-comment">// hash(key) è¿›è¡Œäº†hashæ‰°åŠ¨</span><br>    <span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>); <br>&#125;<br><br><span class="hljs-keyword">final</span> V <span class="hljs-title function_">putVal</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, K key, V value, <span class="hljs-type">boolean</span> onlyIfAbsent,</span><br><span class="hljs-params">               <span class="hljs-type">boolean</span> evict)</span> &#123;<br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="hljs-type">int</span> n, i;<br>    <span class="hljs-comment">// åˆå§‹åŒ–æ¡¶æ•°ç»„ table,table è¢«å»¶è¿Ÿåˆ°æ’å…¥æ–°æ•°æ®æ—¶å†è¿›è¡Œåˆå§‹åŒ–</span><br>    <span class="hljs-keyword">if</span> ((tab = table) == <span class="hljs-literal">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)<br>        n = (tab = resize()).length;<br>    <span class="hljs-comment">// å¦‚æœæ¡¶ä¸­ä¸åŒ…å«é”®å€¼å¯¹èŠ‚ç‚¹å¼•ç”¨,åˆ™å°†æ–°é”®å€¼å¯¹èŠ‚ç‚¹çš„å¼•ç”¨å­˜å…¥æ¡¶ä¸­å³å¯</span><br>    <span class="hljs-keyword">if</span> ((p = tab[i = (n - <span class="hljs-number">1</span>) &amp; hash]) == <span class="hljs-literal">null</span>)<br>        tab[i] = newNode(hash, key, value, <span class="hljs-literal">null</span>);<br>    <span class="hljs-keyword">else</span> &#123;<br>        Node&lt;K,V&gt; e; K k;<br>        <span class="hljs-comment">// å¦‚æœé”®çš„å€¼ä»¥åŠèŠ‚ç‚¹ hash ç­‰äºé“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹èŠ‚ç‚¹æ—¶,åˆ™å°† e æŒ‡å‘è¯¥é”®å€¼å¯¹</span><br>        <span class="hljs-keyword">if</span> (p.hash == hash &amp;&amp;<br>            ((k = p.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br>            e = p;<br>        <span class="hljs-comment">// å¦‚æœæ¡¶ä¸­çš„å¼•ç”¨ç±»å‹ä¸º TreeNode,åˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ’å…¥æ–¹æ³•</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> TreeNode)<br>            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="hljs-built_in">this</span>, tab, hash, key, value);<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å¯¹é“¾è¡¨è¿›è¡Œéå†,å¹¶ç»Ÿè®¡é“¾è¡¨é•¿åº¦</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">binCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; ; ++binCount) &#123;<br>                <span class="hljs-comment">// é“¾è¡¨ä¸­ä¸åŒ…å«è¦æ’å…¥çš„é”®å€¼å¯¹èŠ‚ç‚¹æ—¶,åˆ™å°†è¯¥èŠ‚ç‚¹æ¥åœ¨é“¾è¡¨çš„æœ€å</span><br>                <span class="hljs-keyword">if</span> ((e = p.next) == <span class="hljs-literal">null</span>) &#123;<br>                    p.next = newNode(hash, key, value, <span class="hljs-literal">null</span>);<br>                    <span class="hljs-comment">// å¦‚æœé“¾è¡¨é•¿åº¦å¤§äºæˆ–ç­‰äºæ ‘åŒ–é˜ˆå€¼,åˆ™è¿›è¡Œæ ‘åŒ–æ“ä½œ</span><br>                    <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="hljs-number">1</span>) <span class="hljs-comment">// -1 for 1st</span><br>                        treeifyBin(tab, hash);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-comment">// æ¡ä»¶ä¸º true,è¡¨ç¤ºå½“å‰é“¾è¡¨åŒ…å«è¦æ’å…¥çš„é”®å€¼å¯¹,ç»ˆæ­¢éå†</span><br>                <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                    ((k = e.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br>                    <span class="hljs-keyword">break</span>;<br>                p = e;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// åˆ¤æ–­è¦æ’å…¥çš„é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ HashMap ä¸­</span><br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// existing mapping for key</span><br>            <span class="hljs-type">V</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> e.value;<br>            <span class="hljs-comment">// onlyIfAbsent è¡¨ç¤ºæ˜¯å¦ä»…åœ¨ oldValue ä¸º null çš„æƒ…å†µä¸‹æ›´æ–°é”®å€¼å¯¹çš„å€¼</span><br>            <span class="hljs-keyword">if</span> (!onlyIfAbsent || oldValue == <span class="hljs-literal">null</span>)<br>                e.value = value;<br>            afterNodeAccess(e);<br>            <span class="hljs-keyword">return</span> oldValue; <span class="hljs-comment">// å› ä¸ºæ˜¯æ›¿æ¢value,æ‰€ä»¥ä¸éœ€è¦å»åˆ¤æ–­å®¹é‡,ç›´æ¥è¿”å›ç»“æœ</span><br>        &#125;<br>    &#125;<br>    ++modCount;<br>    <span class="hljs-comment">// é”®å€¼å¯¹æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶,åˆ™è¿›è¡Œæ‰©å®¹</span><br>    <span class="hljs-keyword">if</span> (++size &gt; threshold)<br>        resize();<br>    afterNodeInsertion(evict);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ‰©å®¹æºç "><a href="#æ‰©å®¹æºç " class="headerlink" title="æ‰©å®¹æºç "></a>æ‰©å®¹æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;<br>    Node&lt;K,V&gt;[] oldTab = table;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldCap</span> <span class="hljs-operator">=</span> (oldTab == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : oldTab.length;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldThr</span> <span class="hljs-operator">=</span> threshold;<br>    <span class="hljs-type">int</span> newCap, newThr = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// Cap æ˜¯ capacity çš„ç¼©å†™,å®¹é‡.å¦‚æœå®¹é‡ä¸ä¸ºç©º,åˆ™è¯´æ˜å·²ç»åˆå§‹åŒ–</span><br>    <span class="hljs-keyword">if</span> (oldCap &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å¦‚æœå®¹é‡è¾¾åˆ°æœ€å¤§ 1 &lt;&lt; 30 åˆ™ä¸å†æ‰©å®¹</span><br>        <span class="hljs-keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;<br>            threshold = Integer.MAX_VALUE;<br>            <span class="hljs-keyword">return</span> oldTab;<br>        &#125;<br>        <span class="hljs-comment">// æŒ‰æ—§å®¹é‡å’Œé˜€å€¼çš„ 2 å€è®¡ç®—æ–°å®¹é‡å’Œé˜€å€¼</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="hljs-number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;<br>                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)<br>            newThr = oldThr &lt;&lt; <span class="hljs-number">1</span>; <span class="hljs-comment">// double threshold</span><br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldThr &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// initial capacity was placed in threshold</span><br>        newCap = oldThr;<br>    <br>    <span class="hljs-comment">// initial capacity was placed in threshold ç¿»è¯‘è¿‡æ¥çš„æ„æ€,å¦‚ä¸‹;</span><br>    <span class="hljs-comment">// åˆå§‹åŒ–æ—¶,å°† threshold çš„å€¼èµ‹å€¼ç»™ newCap,</span><br>    <span class="hljs-comment">// HashMap ä½¿ç”¨ threshold å˜é‡æš‚æ—¶ä¿å­˜ initialCapacity å‚æ•°çš„å€¼</span><br>    <span class="hljs-keyword">else</span> &#123;               <span class="hljs-comment">// zero initial threshold signifies using defaults</span><br>        <span class="hljs-comment">// è¿™ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯,æºä»£ç ä¸­ä¹Ÿæœ‰ç›¸åº”çš„è‹±æ–‡æ³¨é‡Š</span><br>        <span class="hljs-comment">// è°ƒç”¨æ— å‚æ„é€ æ–¹æ³•æ—¶,æ•°ç»„æ¡¶æ•°ç»„å®¹é‡ä¸ºé»˜è®¤å®¹é‡ 1 &lt;&lt; 4; aka 16</span><br>        <span class="hljs-comment">// é˜€å€¼;æ˜¯é»˜è®¤å®¹é‡ä¸è´Ÿè½½å› å­çš„ä¹˜ç§¯,0.75</span><br>        newCap = DEFAULT_INITIAL_CAPACITY;<br>        newThr = (<span class="hljs-type">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);<br>    &#125;<br>    <br>    <span class="hljs-comment">// newThr ä¸º 0,åˆ™ä½¿ç”¨é˜€å€¼å…¬å¼è®¡ç®—å®¹é‡</span><br>    <span class="hljs-keyword">if</span> (newThr == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">float</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>)newCap * loadFactor;<br>        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="hljs-type">float</span>)MAXIMUM_CAPACITY ?<br>                  (<span class="hljs-type">int</span>)ft : Integer.MAX_VALUE);<br>    &#125;<br>    <br>    threshold = newThr;<br>    <span class="hljs-meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span><br>    <span class="hljs-comment">// åˆå§‹åŒ–æ•°ç»„æ¡¶,ç”¨äºå­˜æ”¾ key</span><br>    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>[newCap];<br>    table = newTab;<br>    <span class="hljs-comment">// å¦‚æœæ—§æ•°ç»„æ¡¶,oldCap æœ‰å€¼,åˆ™éå†å°†é”®å€¼æ˜ å°„åˆ°æ–°æ•°ç»„æ¡¶ä¸­</span><br>    <span class="hljs-keyword">if</span> (oldTab != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; oldCap; ++j) &#123;<br>            Node&lt;K,V&gt; e;<br>            <span class="hljs-keyword">if</span> ((e = oldTab[j]) != <span class="hljs-literal">null</span>) &#123;<br>                oldTab[j] = <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">if</span> (e.next == <span class="hljs-literal">null</span>)<br>                    newTab[e.hash &amp; (newCap - <span class="hljs-number">1</span>)] = e;<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> TreeNode)<br>                    <span class="hljs-comment">// è¿™é‡Œ split,æ˜¯çº¢é»‘æ ‘æ‹†åˆ†æ“ä½œ.åœ¨é‡æ–°æ˜ å°„æ—¶æ“ä½œçš„.</span><br>                    ((TreeNode&lt;K,V&gt;)e).split(<span class="hljs-built_in">this</span>, newTab, j, oldCap);<br>                <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// preserve order</span><br>                    Node&lt;K,V&gt; loHead = <span class="hljs-literal">null</span>, loTail = <span class="hljs-literal">null</span>;<br>                    Node&lt;K,V&gt; hiHead = <span class="hljs-literal">null</span>, hiTail = <span class="hljs-literal">null</span>;<br>                    Node&lt;K,V&gt; next;<br>                    <span class="hljs-comment">// è¿™é‡Œæ˜¯é“¾è¡¨,å¦‚æœå½“å‰æ˜¯æŒ‰ç…§é“¾è¡¨å­˜æ”¾çš„,åˆ™å°†é“¾è¡¨èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„</span><br>                    <span class="hljs-keyword">do</span> &#123;<br>                        next = e.next;<br>                        <span class="hljs-keyword">if</span> ((e.hash &amp; oldCap) == <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">if</span> (loTail == <span class="hljs-literal">null</span>)<br>                                loHead = e;<br>                            <span class="hljs-keyword">else</span><br>                                loTail.next = e;<br>                            loTail = e;<br>                        &#125;<br>                        <span class="hljs-keyword">else</span> &#123;<br>                            <span class="hljs-keyword">if</span> (hiTail == <span class="hljs-literal">null</span>)<br>                                hiHead = e;<br>                            <span class="hljs-keyword">else</span><br>                                hiTail.next = e;<br>                            hiTail = e;<br>                        &#125;<br>                    &#125; <span class="hljs-keyword">while</span> ((e = next) != <span class="hljs-literal">null</span>);<br>                    <br>                    <span class="hljs-comment">// å°†åˆ†ç»„åçš„é“¾è¡¨æ˜ å°„åˆ°æ¡¶ä¸­</span><br>                    <span class="hljs-keyword">if</span> (loTail != <span class="hljs-literal">null</span>) &#123;<br>                        loTail.next = <span class="hljs-literal">null</span>;<br>                        newTab[j] = loHead;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (hiTail != <span class="hljs-literal">null</span>) &#123;<br>                        hiTail.next = <span class="hljs-literal">null</span>;<br>                        newTab[j + oldCap] = hiHead;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> newTab;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é“¾è¡¨æ ‘åŒ–"><a href="#é“¾è¡¨æ ‘åŒ–" class="headerlink" title="é“¾è¡¨æ ‘åŒ–"></a>é“¾è¡¨æ ‘åŒ–</h2><blockquote><p>åœ¨jdk1.8ä¹‹å‰,é‡‡ç”¨çš„éƒ½æ˜¯é“¾è¡¨æ–¹å¼å­˜æ”¾æ•°æ®,ä½†æ˜¯è¿™æ ·ä»é“¾è¡¨ä¸­å–æ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(n),é“¾è¡¨è¶Šé•¿æ€§èƒ½è¶Šå·®,å› æ­¤åœ¨jdk1.8ä¸­æŠŠè¿‡é•¿çš„é“¾è¡¨,ä¹Ÿå°±æ˜¯8ä¸ª,ä¼˜åŒ–æˆè‡ªå¹³è¡¡çš„çº¢é»‘æ ‘ç»“æ„,ä»¥æ­¤è®©å®šä½å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–è¿‘ä¼¼O(logn)</p><p>ä½†ä¹Ÿå¹¶ä¸æ˜¯å®Œå…¨æŠ›å¼ƒäº†é“¾è¡¨,å› ä¸ºåœ¨å…ƒç´ ç›¸å¯¹ä¸å¤šçš„æƒ…å†µä¸‹,é“¾è¡¨çš„æ’å…¥é€Ÿåº¦æ›´å¿«,æ‰€ä»¥æ€»ä¼šè€ƒè™‘è®¾å®šé˜ˆå€¼ä¸º8æ‰è¿›è¡Œçº¢é»‘æ ‘è½¬æ¢æ“ä½œ</p></blockquote><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207071029357.png" alt="image-20220707102944268"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">treeifyBin</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, <span class="hljs-type">int</span> hash)</span> &#123;<br>    <span class="hljs-type">int</span> n, index; Node&lt;K,V&gt; e;<br>    <span class="hljs-comment">// ä¸ä¸€å®šæ ‘åŒ–è¿˜å¯èƒ½åªæ˜¯æ‰©å®¹.ä¸»è¦æ¡¶æ•°ç»„å®¹é‡æ˜¯å¦å°äº64 MIN_TREEIFY_CAPACITY</span><br>    <span class="hljs-keyword">if</span> (tab == <span class="hljs-literal">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)<br>        resize();<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((e = tab[index = (n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-literal">null</span>) &#123;<br>        TreeNode&lt;K,V&gt; hd = <span class="hljs-literal">null</span>, tl = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-comment">// å°†æ™®é€šèŠ‚ç‚¹è½¬æ¢ä¸ºæ ‘èŠ‚ç‚¹,ä½†æ­¤æ—¶è¿˜ä¸æ˜¯çº¢é»‘æ ‘,ä¹Ÿå°±æ˜¯è¯´è¿˜ä¸ä¸€å®šå¹³è¡¡</span><br>            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class="hljs-literal">null</span>);<br>            <span class="hljs-keyword">if</span> (tl == <span class="hljs-literal">null</span>)<br>                hd = p;<br>            <span class="hljs-keyword">else</span> &#123;<br>                p.prev = tl;<br>                tl.next = p;<br>            &#125;<br>            tl = p;<br>        &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">if</span> ((tab[index] = hd) != <span class="hljs-literal">null</span>)<br>            <span class="hljs-comment">// è½¬çº¢é»‘æ ‘æ“ä½œ</span><br>            hd.treeify(tab);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é“¾è¡¨æ ‘åŒ–çš„æ¡ä»¶:1.é“¾è¡¨é•¿åº¦å¤§äºç­‰äº8,æ¡¶å®¹é‡å¤§äº64,å¦åˆ™åªæ˜¯æ‰©å®¹,ä¸ä¼šæ ‘åŒ–</li><li>é“¾è¡¨æ ‘åŒ–çš„è¿‡ç¨‹ä¸­æ˜¯å¸çº³ç”±é“¾è¡¨è½¬æ¢ä¸ºæ ‘èŠ‚ç‚¹,æ­¤æ—¶çš„æ ‘å¹¶ä¸æ˜¯ä¸€é¢—å¹³è¡¡æ ‘,åŒæ—¶åœ¨æ­¤è¿‡ç¨‹ä¸­ä¼š<strong>è®°å½•é“¾è¡¨çš„é¡ºåº</strong>,è¿™ä¸»è¦æ–¹ä¾¿ååºè½¬é“¾è¡¨å’Œæ‹†åˆ†æ›´åŠ æ–¹ä¾¿</li></ul><h2 id="çº¢é»‘æ ‘è½¬é“¾è¡¨"><a href="#çº¢é»‘æ ‘è½¬é“¾è¡¨" class="headerlink" title="çº¢é»‘æ ‘è½¬é“¾è¡¨"></a>çº¢é»‘æ ‘è½¬é“¾è¡¨</h2><p>é“¾è¡¨è½¬çº¢é»‘æ ‘çš„è¿‡ç¨‹ä¸­,è®°å½•äº†åŸæœ‰é“¾è¡¨çš„é¡ºåº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title function_">untreeify</span><span class="hljs-params">(HashMap&lt;K,V&gt; map)</span> &#123;<br>    Node&lt;K,V&gt; hd = <span class="hljs-literal">null</span>, tl = <span class="hljs-literal">null</span>;<br>    <span class="hljs-comment">// éå† TreeNode</span><br>    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; q = <span class="hljs-built_in">this</span>; q != <span class="hljs-literal">null</span>; q = q.next) &#123;<br>        <span class="hljs-comment">// TreeNode æ›¿æ¢ Node</span><br>        Node&lt;K,V&gt; p = map.replacementNode(q, <span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">if</span> (tl == <span class="hljs-literal">null</span>)<br>            hd = p;<br>        <span class="hljs-keyword">else</span><br>            tl.next = p;<br>        tl = p;<br>    &#125;<br>    <span class="hljs-keyword">return</span> hd;<br>&#125;<br><br><span class="hljs-comment">// æ›¿æ¢æ–¹æ³•</span><br>Node&lt;K,V&gt; <span class="hljs-title function_">replacementNode</span><span class="hljs-params">(Node&lt;K,V&gt; p, Node&lt;K,V&gt; next)</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;&gt;(p.hash, p.key, p.value, next);<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºè®°å½•äº†é“¾è¡¨å…³ç³»,æ‰€ä»¥æ›¿æ¢è¿‡ç¨‹å¾ˆå®¹æ˜“.æ‰€ä»¥å¥½çš„æ•°æ®ç»“æ„å¯ä»¥è®©æ“ä½œå˜å¾—æ›´åŠ å®¹æ˜“</p><h1 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> &#123;<br>    Node&lt;K,V&gt; e;<br>    <span class="hljs-comment">// åŒæ ·éœ€è¦ç»è¿‡æ‰°åŠ¨å‡½æ•°è®¡ç®—å“ˆå¸Œå€¼</span><br>    <span class="hljs-keyword">return</span> (e = getNode(hash(key), key)) == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : e.value;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title function_">getNode</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, Object key)</span> &#123;<br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="hljs-type">int</span> n; K k;<br>    <span class="hljs-comment">// åˆ¤æ–­æ¡¶æ•°ç»„çš„æ˜¯å¦ä¸ºç©ºå’Œé•¿åº¦å€¼</span><br>    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>        <span class="hljs-comment">// è®¡ç®—ä¸‹æ ‡,å“ˆå¸Œå€¼ä¸æ•°ç»„é•¿åº¦-1</span><br>        (first = tab[(n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-literal">null</span>) &#123;<br>        <br>        <span class="hljs-keyword">if</span> (first.hash == hash &amp;&amp; <span class="hljs-comment">// always check first node</span><br>            ((k = first.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br>            <span class="hljs-keyword">return</span> first;<br>        <span class="hljs-keyword">if</span> ((e = first.next) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// TreeNode èŠ‚ç‚¹ç›´æ¥è°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ–¹æ³•,æ—¶é—´å¤æ‚åº¦ O(logn)</span><br>            <span class="hljs-keyword">if</span> (first <span class="hljs-keyword">instanceof</span> TreeNode)<br>                <span class="hljs-keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);<br>            <span class="hljs-comment">// å¦‚æœæ˜¯é“¾è¡¨å°±ä¾æ¬¡éå†æŸ¥æ‰¾</span><br>            <span class="hljs-keyword">do</span> &#123;<br>                <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                    ((k = e.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br>                    <span class="hljs-keyword">return</span> e;<br>            &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(Object key)</span> &#123;<br>    Node&lt;K,V&gt; e;<br>    <span class="hljs-keyword">return</span> (e = removeNode(hash(key), key, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)) == <span class="hljs-literal">null</span> ?<br>        <span class="hljs-literal">null</span> : e.value;<br>&#125;<br><br><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title function_">removeNode</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, Object key, Object value,</span><br><span class="hljs-params">                           <span class="hljs-type">boolean</span> matchValue, <span class="hljs-type">boolean</span> movable)</span> &#123;<br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="hljs-type">int</span> n, index;<br>    <span class="hljs-comment">// å®šä½æ¡¶æ•°ç»„ä¸­çš„ä¸‹æ ‡ä½ç½®,index = (n - 1) &amp; hash</span><br>    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>        (p = tab[index = (n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-literal">null</span>) &#123;<br>        Node&lt;K,V&gt; node = <span class="hljs-literal">null</span>, e; K k; V v;<br>        <span class="hljs-comment">// å¦‚æœé”®çš„å€¼ä¸é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç›¸ç­‰,åˆ™å°† node æŒ‡å‘è¯¥èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">if</span> (p.hash == hash &amp;&amp;<br>            ((k = p.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br>            node = p;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((e = p.next) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// æ ‘èŠ‚ç‚¹,è°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ–¹æ³•,å®šä½èŠ‚ç‚¹</span><br>            <span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> TreeNode)<br>                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// éå†é“¾è¡¨,æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹</span><br>                <span class="hljs-keyword">do</span> &#123;<br>                    <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>                        ((k = e.key) == key ||<br>                         (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k)))) &#123;<br>                        node = e;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    p = e;<br>                &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// åˆ é™¤èŠ‚ç‚¹,ä»¥åŠçº¢é»‘æ ‘éœ€è¦ä¿®å¤,å› ä¸ºåˆ é™¤åä¼šç ´åå¹³è¡¡æ€§.é“¾è¡¨çš„åˆ é™¤æ›´åŠ ç®€å•</span><br>        <span class="hljs-keyword">if</span> (node != <span class="hljs-literal">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||<br>                             (value != <span class="hljs-literal">null</span> &amp;&amp; value.equals(v)))) &#123;<br>            <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> TreeNode)<br>                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="hljs-built_in">this</span>, tab, movable);<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node == p)<br>                tab[index] = node.next;<br>            <span class="hljs-keyword">else</span><br>                p.next = node.next;<br>            ++modCount;<br>            --size;<br>            afterNodeRemoval(node);<br>            <span class="hljs-keyword">return</span> node;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h1><h2 id="æ·»åŠ å…ƒç´ -åœ¨-HashMap-è¿˜æ˜¯åªé“¾è¡¨ç»“æ„æ—¶"><a href="#æ·»åŠ å…ƒç´ -åœ¨-HashMap-è¿˜æ˜¯åªé“¾è¡¨ç»“æ„æ—¶" class="headerlink" title="æ·»åŠ å…ƒç´ ,åœ¨ HashMap è¿˜æ˜¯åªé“¾è¡¨ç»“æ„æ—¶"></a>æ·»åŠ å…ƒç´ ,åœ¨ HashMap è¿˜æ˜¯åªé“¾è¡¨ç»“æ„æ—¶</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207072008336.png" alt="image-20220707200846170"></p><h2 id="æ·»åŠ å…ƒç´ -åœ¨-HashMap-è½¬æ¢ä¸ºçº¢é»‘æ ‘æ—¶å€™"><a href="#æ·»åŠ å…ƒç´ -åœ¨-HashMap-è½¬æ¢ä¸ºçº¢é»‘æ ‘æ—¶å€™" class="headerlink" title="æ·»åŠ å…ƒç´ ,åœ¨ HashMap è½¬æ¢ä¸ºçº¢é»‘æ ‘æ—¶å€™"></a>æ·»åŠ å…ƒç´ ,åœ¨ HashMap è½¬æ¢ä¸ºçº¢é»‘æ ‘æ—¶å€™</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207072008827.png" alt="image-20220707200829678"></p><h2 id="åˆ é™¤å…ƒç´ -åœ¨-HashMap-è½¬æ¢ä¸ºé“¾è¡¨ç»“æ„æ—¶"><a href="#åˆ é™¤å…ƒç´ -åœ¨-HashMap-è½¬æ¢ä¸ºé“¾è¡¨ç»“æ„æ—¶" class="headerlink" title="åˆ é™¤å…ƒç´ ,åœ¨ HashMap è½¬æ¢ä¸ºé“¾è¡¨ç»“æ„æ—¶"></a>åˆ é™¤å…ƒç´ ,åœ¨ HashMap è½¬æ¢ä¸ºé“¾è¡¨ç»“æ„æ—¶</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207072008360.png" alt="image-20220707200837192"></p>]]></content>
    
    
    <categories>
      
      <category>æºç </category>
      
    </categories>
    
    
    <tags>
      
      <tag>æºç </tag>
      
      <tag>HashMap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç‘å‰å¤–å–çš„æŠ€æœ¯æ€»ç»“</title>
    <link href="/2022/07/05/2022-7-5-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/"/>
    <url>/2022/07/05/2022-7-5-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/</url>
    
    <content type="html"><![CDATA[<h1 id="WebMVC"><a href="#WebMVC" class="headerlink" title="WebMVC"></a>WebMVC</h1><h2 id="æ¶ˆæ¯è½¬åŒ–å™¨"><a href="#æ¶ˆæ¯è½¬åŒ–å™¨" class="headerlink" title="æ¶ˆæ¯è½¬åŒ–å™¨"></a>æ¶ˆæ¯è½¬åŒ–å™¨</h2><blockquote><p>å°†åç«¯è¿”å›ç»™å‰ç«¯çš„å¯¹è±¡è½¬æ¢ä¸ºjson,å¯¹longæ•°æ®è½¬æ¢,æ—¥æœŸç­‰</p></blockquote><p>ä½¿ç”¨Mapperæ–‡ä»¶å¤¹æ›¿ä»£Dao</p><p>åŒæ—¶ä½¿ç”¨<code>@Mapper</code>æ³¨è§£è€Œä¸æ˜¯<code>@Repository</code>æ³¨è§£</p><blockquote><p>ä¸¤è€…åŒºåˆ«:</p><p>@Repositoryæ˜¯springçš„æ³¨è§£,æ ‡è®°ä¸ºä¸€ä¸ªbean,é…åˆmybatisæ—¶éœ€è¦é…ç½®@MapperScan</p><p>@Mapperæ˜¯Mybatisçš„æ³¨è§£,ä¸éœ€è¦é¢å¤–çš„@MapperScanæ‰«æ</p></blockquote><h1 id="Mybatis-Plus"><a href="#Mybatis-Plus" class="headerlink" title="Mybatis-Plus"></a>Mybatis-Plus</h1><h2 id="LambdaQueryWrapper"><a href="#LambdaQueryWrapper" class="headerlink" title="LambdaQueryWrapper"></a>LambdaQueryWrapper</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>queryWrapper.eq(Employee::getName,employee.getUsername());<br><span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> employeeService.getOne(queryWrapper);<br></code></pre></td></tr></table></figure><h2 id="åˆ†é¡µæ’ä»¶"><a href="#åˆ†é¡µæ’ä»¶" class="headerlink" title="åˆ†é¡µæ’ä»¶"></a>åˆ†é¡µæ’ä»¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é…ç½®MPçš„åˆ†é¡µæ’ä»¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">mybatisPlusInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        mybatisPlusInterceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>());<br>        <span class="hljs-keyword">return</span> mybatisPlusInterceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageSize</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> name</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br><span class="hljs-keyword">public</span> R&lt;Page&gt; <span class="hljs-title function_">page</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, String name)</span>&#123;<br>    log.info(<span class="hljs-string">&quot;page = &#123;&#125;,pageSize = &#123;&#125;,name = &#123;&#125;&quot;</span>,page,pageSize,name);<br><br>    <span class="hljs-comment">// æ„é€ åˆ†é¡µæ„é€ å™¨</span><br>    <span class="hljs-type">Page</span> <span class="hljs-variable">pageInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(page,pageSize);<br><br>    <span class="hljs-comment">// æ„é€ æ¡ä»¶æ„é€ å™¨</span><br>    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>();<br>    <span class="hljs-comment">// æ·»åŠ è¿‡æ»¤æ¡ä»¶</span><br>    queryWrapper.like(StringUtils.isNotEmpty(name),Employee::getName,name);<br>    <span class="hljs-comment">// æ·»åŠ æ’åºæ¡ä»¶</span><br>    queryWrapper.orderByDesc(Employee::getUpdateTime);<br><br>    <span class="hljs-comment">// æ‰§è¡ŒæŸ¥è¯¢</span><br>    employeeService.page(pageInfo,queryWrapper); <span class="hljs-comment">// ä¸éœ€è¦è¿”å›,ä¼ è¿›å»å°±æ„é€ å¥½äº†</span><br>    <span class="hljs-keyword">return</span> R.success(pageInfo);<br>&#125;<br></code></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getMemberList</span> (params) &#123;<br>  <span class="hljs-keyword">return</span> $axios(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/employee/page&#x27;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>,<br>    params<br>  &#125;)<br>&#125;<br><br>ä¸è¿‡åœ¨å‰ç«¯æœ‰ä¸ªæ‹¦æˆªå™¨<br>ä¼šå°†ä¼ è¿‡å»çš„è·¯åŠ²æ”¹å˜<br></code></pre></td></tr></table></figure><h2 id="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a href="#å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……" class="headerlink" title="å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a>å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h2><p>åœ¨å®ä½“ç±»å±æ€§ä¸ŠåŠ æ³¨è§£<code>@TableField</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span> <span class="hljs-comment">// æ’å…¥æ—¶å¡«å……å­—æ®µ</span><br><span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span> <span class="hljs-comment">// æ’å…¥å’Œæ›´æ–°æ—¶å¡«å……å­—æ®µ</span><br><span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br><span class="hljs-keyword">private</span> Long createUser;<br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br><span class="hljs-keyword">private</span> Long updateUser;<br></code></pre></td></tr></table></figure><p>åˆ›å»º<strong>MyMetaObjectHandler</strong>ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[insert]...&quot;</span>);<br>        log.info(metaObject.toString());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[update]...&quot;</span>);<br>        log.info(metaObject.toString());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ThreadLocalè¿›è¡Œå®Œå–„</p><hr><h1 id="MD5åŠ å¯†"><a href="#MD5åŠ å¯†" class="headerlink" title="MD5åŠ å¯†"></a>MD5åŠ å¯†</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">employee.setPassword(DigestUtils.md5DigestAsHex(<span class="hljs-string">&quot;123456&quot;</span>.getBytes()));<br></code></pre></td></tr></table></figure><h1 id="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½</h1><p>commons-fileupload</p><p>commons-io</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/common&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonController</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;reggie.path&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String basePath;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ä¸Šä¼ </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;String&gt; <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span> &#123; <span class="hljs-comment">// å‚æ•°åå­—å’Œå‰ç«¯çš„åå­—ä¸€è‡´</span><br>        log.info(file.toString());<br><br>        <span class="hljs-comment">// åŸå§‹æ–‡ä»¶å</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">suffix</span> <span class="hljs-operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br><br>        <span class="hljs-comment">// ä½¿ç”¨UUIDé‡æ–°ç”Ÿæˆæ–‡ä»¶å,é˜²æ­¢æ–‡ä»¶åé‡å¤é€ æˆæ–‡ä»¶è¦†ç›–</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + suffix;<br><br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç›®å½•å¯¹è±¡</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath);<br>        <span class="hljs-comment">// åˆ¤æ–­å½“å‰ç›®å½•æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (!dir.exists()) &#123;<br>            <span class="hljs-comment">// ç›®å½•ä¸å­˜åœ¨,éœ€è¦åˆ›å»º</span><br>            dir.mkdirs();<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + fileName));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> R.success(fileName);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ä¸‹è½½</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/download&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">download</span><span class="hljs-params">(String name, HttpServletResponse response)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è¾“å…¥æµ,é€šè¿‡å‡ºå…¥åˆ˜è¯»å–æ–‡ä»¶å†…å®¹</span><br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(basePath + name));<br><br>            <span class="hljs-comment">// è¾“å‡ºæµ,é€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶å†™å›æµè§ˆå™¨,åœ¨æµè§ˆå™¨å±•ç¤ºå›¾ç‰‡äº†</span><br>            <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> response.getOutputStream();<br>            response.setContentType(<span class="hljs-string">&quot;image/jpeg&quot;</span>);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="hljs-number">1</span>) &#123;<br>                outputStream.write(bytes,<span class="hljs-number">0</span>,len);<br>                outputStream.flush();<br>            &#125;<br><br>            <span class="hljs-comment">// å…³é—­èµ„æº</span><br>            outputStream.close();<br>            fileInputStream.close();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å…³é—­8080ç«¯å£"><a href="#å…³é—­8080ç«¯å£" class="headerlink" title="å…³é—­8080ç«¯å£"></a>å…³é—­8080ç«¯å£</h1><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202206271443914.png" alt="image-20220627144344849"></p><h1 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h1><blockquote><p>åŸºäºæ³¨è§£çš„ç¼“å­˜åŠŸèƒ½</p></blockquote><table><thead><tr><th>@EnableCaching</th><th>å¼€å¯ç¼“å­˜æ³¨è§£</th></tr></thead><tbody><tr><td>@cacheable</td><td>æŸ¥è¯¢ç¼“å­˜,å°†æ–¹æ³•ç¼“å­˜å€¼æ”¾å…¥ç¼“å­˜æ± ä¸­</td></tr><tr><td>@Cacheput</td><td>æ’å…¥ç¼“å­˜</td></tr><tr><td>@CacheEvict</td><td>åˆ é™¤ç¼“å­˜</td></tr></tbody></table><p><strong>å¯¼åæ ‡</strong></p><p>åªæ˜¯ä½¿ç”¨åŸºç¡€åŠŸèƒ½(åŸºäºMysql),ä¸éœ€è¦å¯¼åŒ…,å·²ç»å­˜åœ¨äº<code>spring-context</code>ä¸­äº†</p><p><strong>æ‰©å±•åæ ‡</strong></p><p><code>Spring-cache</code>åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>redis</code>åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>é…ç½®redis<code>application.yml</code></strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cache:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">time-to-live:</span> <span class="hljs-number">180000</span> <span class="hljs-comment">#è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸ</span><br></code></pre></td></tr></table></figure><p><strong>å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</strong></p><p>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ <code>@EnableCaching</code>å¼€å¯</p><h1 id="Mysqlä¸»ä»å¤åˆ¶"><a href="#Mysqlä¸»ä»å¤åˆ¶" class="headerlink" title="Mysqlä¸»ä»å¤åˆ¶"></a>Mysqlä¸»ä»å¤åˆ¶</h1><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207031527152.png" alt="image-20220703152704036"></p><p><strong>ä¸»åº“Master</strong></p><p>ç¬¬ä¸€æ­¥ä¿®æ”¹Msyqlé…ç½®æ–‡ä»¶ <code>/etc/my.cnf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cnf">[mysqld]<br>server_id=100 ## è®¾ç½®server_id,åŒä¸€å±€åŸŸç½‘ä¸­éœ€è¦å”¯ä¸€ID<br>log-bin=mysql-bin ## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½,ä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒæ•°æ®åº“å®ä¾‹çš„Masteræ—¶ä½¿ç”¨<br></code></pre></td></tr></table></figure><p>å¼€å¯è¿œç¨‹æƒé™</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">grant</span> <span class="hljs-keyword">replication</span> slave <span class="hljs-keyword">on</span> *.* <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;xiaoming&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;root@123456&#x27;</span>;<br><br># æ›´æ”¹å¯†ç ç­–ç•¥<br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> validate_password_policy=<span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">show <span class="hljs-keyword">master</span> <span class="hljs-title">status</span>;<br></code></pre></td></tr></table></figure><p><strong>ä»åº“Slave</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">server_id</span>=<span class="hljs-number">101</span> <span class="hljs-comment">## è®¾ç½®server_id,åŒä¸€å±€åŸŸç½‘ä¸­éœ€è¦å”¯ä¸€ID</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">change master <span class="hljs-keyword">to</span><br>    <span class="hljs-attribute">MASTER_HOST</span>=<span class="hljs-string">&#x27;192.168.33.131&#x27;</span>,<br>    <span class="hljs-attribute">MASTER_USER</span>=<span class="hljs-string">&#x27;xiaoming&#x27;</span>,<br>    <span class="hljs-attribute">MASTER_PASSWORD</span>=<span class="hljs-string">&#x27;root@123456&#x27;</span>,<br>    <span class="hljs-attribute">MASTER_LOG_FILE</span>=<span class="hljs-string">&#x27;mysql-bin.000001&#x27;</span>,<br>    <span class="hljs-attribute">MASTER_LOG_POS</span>=1833;<br></code></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># å¯åŠ¨ä»åº“åŒæ­¥å¼€å…³</span><br><span class="hljs-literal">start</span> <span class="hljs-literal">slave</span>;<br><span class="hljs-literal">stop</span> <span class="hljs-literal">slave</span> <span class="hljs-comment"># åœæ­¢</span><br>    <br><span class="hljs-comment"># æ£€æŸ¥çŠ¶æ€</span><br>show <span class="hljs-literal">slave</span> status\G<br>    <br> <br><span class="hljs-comment"># éœ€è¦ä¸‹é¢å…¨éƒ¨å˜æˆyes</span><br>Slave_IO_Running: YES <span class="hljs-comment"># æ²¡å˜æ˜¯å› ä¸ºUUID</span><br>Slave_SQL_Running: YES<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/weixin_46049759/article/details/116779743">å‚è€ƒä¸ªäººåšå®¢</a></p><h1 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h1><p><strong>å¯¼åŒ…</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0-RC1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è¯»å†™åˆ†ç¦»è§„åˆ™</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-comment"># åº”ç”¨åç§°</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">reggie_take_out</span><br>  <span class="hljs-attr">shardingsphere:</span><br>    <span class="hljs-attr">datasource:</span><br>      <span class="hljs-attr">names:</span><br>        <span class="hljs-string">master,slave</span><br>      <span class="hljs-comment"># ä¸»æ•°æ®æº</span><br>      <span class="hljs-attr">master:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.33.131:3306/reggie?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>      <span class="hljs-comment"># ä»æ•°æ®æº</span><br>      <span class="hljs-attr">slave:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.3.132:3306/reggie?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">masterslave:</span><br>      <span class="hljs-comment"># è¯»å†™åˆ†ç¦»é…ç½®</span><br>      <span class="hljs-attr">load-balance-algorithm-type:</span> <span class="hljs-string">round_robin</span> <span class="hljs-comment">#è½®è¯¢</span><br>      <span class="hljs-comment"># æœ€ç»ˆçš„æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">dataSource</span><br>      <span class="hljs-comment"># ä¸»åº“æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">master-data-source-name:</span> <span class="hljs-string">master</span><br>      <span class="hljs-comment"># ä»åº“æ•°æ®æºåç§°åˆ—è¡¨,å¤šä¸ªé€—å·åˆ†éš”</span><br>      <span class="hljs-attr">slave-data-source-names:</span> <span class="hljs-string">slave</span><br>    <span class="hljs-attr">props:</span><br>      <span class="hljs-attr">sql:</span><br>        <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å¼€å¯SQLæ˜¾ç¤º,é»˜è®¤false</span><br></code></pre></td></tr></table></figure><p><strong>åœ¨é…ç½®æ–‡ä»¶æ±‡æ€»é…ç½®è¢«å…è®¸beanå®šä¹‰è¦†ç›–é…ç½®é¡¹</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>    <span class="hljs-attr">main:</span><br>        <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><hr><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><blockquote><p>è½»é‡webæœåŠ¡å™¨,åå‘ä»£ç†æœåŠ¡å™¨,é‚®ä»¶ä»£ç†æœåŠ¡å™¨,å æœ‰å†…å­˜å°,å¹¶å‘èƒ½åŠ›å¼º<br><a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></p><p>æœ¬æ–‡åŸºäº<code>Centos7</code>å»å®‰è£…</p></blockquote><p><strong>å®‰è£…ä¾èµ–åŒ…</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…gcc å¦‚æœæ²¡æœ‰yumæº,å¯ä»¥å‚è€ƒä¸‹é¢åšå®¢é“¾æ¥å»é…ç½®</span><br>apt-get install yum<br><br>yum install --nogpgcheck  gcc pcre-devel zlib-devel openssl openssl-devel<br></code></pre></td></tr></table></figure><p><strong>ä¸‹è½½Nginxå®‰è£…åŒ…</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…wget</span><br>apt-get install wget<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸‹è½½nginx</span><br>wget http://nginx.org/download/nginx-1.16.1.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹æ–‡ä»¶</span><br>tar -zxvf nginx-1.16.1.tar.gz -C /soft<br></code></pre></td></tr></table></figure><p><strong>å®‰è£…</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥è§£å‹ç›®å½•/soft  åˆ›å»ºå®‰è£…æ–‡ä»¶å¤¹nginx  ç„¶ååœ¨å®‰è£…</span><br>./configure --prefix=/usr/local/nginx<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">=====å‡ºç°ä¸‹é¢ä¿¡æ¯ä»£è¡¨åˆæ­¥å®‰è£…æ£€æŸ¥å®Œæˆ=====<br>checking for PCRE JIT support ... found<br>checking for zlib library ... found<br>creating objs/Makefile<br><br>Configuration summary<br>  + using system PCRE library<br>  + OpenSSL library is not used<br>  + using system zlib library<br><br>  nginx path prefix: &quot;/usr/local/nginx&quot;<br>  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;<br>  nginx modules path: &quot;/usr/local/nginx/modules&quot;<br>  nginx configuration prefix: &quot;/usr/local/nginx/conf&quot;<br>  nginx configuration file: &quot;/usr/local/nginx/conf/nginx.conf&quot;<br>  nginx pid file: &quot;/usr/local/nginx/logs/nginx.pid&quot;<br>  nginx error log file: &quot;/usr/local/nginx/logs/error.log&quot;<br>  nginx http access log file: &quot;/usr/local/nginx/logs/access.log&quot;<br>  nginx http client request body temporary files: &quot;client_body_temp&quot;<br>  nginx http proxy temporary files: &quot;proxy_temp&quot;<br>  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;<br>  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;<br>  nginx http scgi temporary files: &quot;scgi_temp&quot;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">make &amp;&amp; make install<br>------çœŸæ­£å®‰è£…å®Œæˆ<br>|| mkdir -p &#x27;/usr/local/nginx/logs&#x27;<br>make[1]: Leaving directory `/root/nginx-1.16.1&#x27;<br></code></pre></td></tr></table></figure><p>æŠ¥é”™1:<a href="https://www.cnblogs.com/zhoading/p/9938762.html">https://www.cnblogs.com/zhoading/p/9938762.html</a></p><p><strong>æŸ¥çœ‹ç‰ˆæœ¬</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost sbin]# ./nginx -v<br>nginx version: nginx/1.16.1<br></code></pre></td></tr></table></figure><p><strong>å¼€å§‹å‰æµ‹è¯•</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost sbin]# ./nginx -t<br>nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful<br></code></pre></td></tr></table></figure><p><strong>å¯åŠ¨å’Œåœæ­¢</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span><br>./nginx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœæ­¢</span><br>./nginx -s stop<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è¿›ç¨‹</span><br>ps -ef | grep nginx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å†™åŠ è½½é…ç½®æ–‡ä»¶</span><br>./nginx -s reload<br>------------------------------------------------------------------------<br>root       8460      1  0 12:03 ?        00:00:00 nginx: master process ./nginx<br>nobody     8461   8460  0 12:03 ?        00:00:00 nginx: worker process<br>root       8616   8008  0 12:04 pts/0    00:00:00 grep --color=auto nginx<br>------------------------------------------------------------------------<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¼€/å…³é˜²ç«å¢™</span><br>service firewalld restart é‡å¯<br>service firewalld start å¼€å¯<br>service firewalld stop å…³é—­<br></code></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207041419539.png" alt="image-20220704141950432"></p><h2 id="éƒ¨ç½²é™æ€èµ„æº"><a href="#éƒ¨ç½²é™æ€èµ„æº" class="headerlink" title="éƒ¨ç½²é™æ€èµ„æº"></a>éƒ¨ç½²é™æ€èµ„æº</h2><blockquote><p>æ›´ä¸ºé«˜æ•ˆ</p></blockquote><p><code>nginx.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">server &#123;<br>      listen       80;# ç›‘å¬ç«¯å£<br>      server_name  localhost;# æœåŠ¡åç§°<br>      <br>      location / &#123;# åŒ¹é…å®¢æˆ·ç«¯è¯·æ±‚url<br>          root   html;# æŒ‡å®šé™æ€èµ„æºæ ¹ç›®å½•<br>          index  index.html;# æŒ‡å®šé»˜è®¤é¦–é¡µ<br>      &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h2><p><code>nginx.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">server &#123;<br>      listen       82;# ç›‘å¬ç«¯å£<br>      server_name  localhost;# æœåŠ¡åç§°<br>      <br>      location / &#123;# åŒ¹é…å®¢æˆ·ç«¯è¯·æ±‚url<br>      proxy_passhttp://192.168.138.101:8080; # åå‘ä»£ç†é…ç½®,å°†è¯·æ±‚è½¬å‘åˆ°æŒ‡å®šæœåŠ¡<br>      &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207041542371.png" alt="image-20220704154233304"></p><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><blockquote><p>åŸºäºåå‘ä»£ç†å®ç°</p><p>è½®è¯¢ç®—æ³•</p></blockquote><p><strong>é…ç½®è´Ÿè½½å‡è¡¡</strong></p><p><code>nginx.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">upstream  targetserver &#123;# upstreamæŒ‡ä»¤å¯ä»¥å®šä¹‰ä¸€ç»„æœåŠ¡å™¨<br>server 192.168.138.101:8080;<br>server 192.168.138.101:8081;<br>&#125;<br>server &#123;<br>       listen       80;  # ç›‘å¬ç«¯å£<br>       server_name  localhost;   # æœåŠ¡åç§°<br>       location / &#123;  # åŒ¹é…å®¢æˆ·ç«¯è¯·æ±‚url<br>       proxy_passhttp://targetserver;<br>       &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p><strong>æƒé‡çš„é…ç½®æ–¹å¼</strong></p><p><code>nginx.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">upstream  targetserver &#123;# upstreamæŒ‡ä»¤å¯ä»¥å®šä¹‰ä¸€ç»„æœåŠ¡å™¨<br>server 192.168.138.101:8080 weight=10;<br>server 192.168.138.101:8081 weight=5;<br>&#125;<br>server &#123;<br>       listen       80;  # ç›‘å¬ç«¯å£<br>       server_name  localhost;   # æœåŠ¡åç§°<br>       location / &#123;  # åŒ¹é…å®¢æˆ·ç«¯è¯·æ±‚url<br>       proxy_passhttp://targetserver;<br>       &#125;<br> &#125;<br></code></pre></td></tr></table></figure><h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><p><strong>å¯¼å…¥knife4jçš„åæ ‡</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>å¯¼å…¥é…ç½®</strong></p><p><code>WebMvcConfig.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@EnableSwagger2</span> <span class="hljs-comment">// Swagger</span><br><span class="hljs-meta">@EnableKnife4j</span> <span class="hljs-comment">// Knife4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebMvcConfigurationSupport</span> &#123;<br>    <br>    ......<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">createRestApi</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ–‡æ¡£ç±»å‹</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                .select()<br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.itheima.reggie.controller&quot;</span>))<br>                .paths(PathSelectors.any())<br>                .build();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                .title(<span class="hljs-string">&quot;ç‘å‰å¤–å–&quot;</span>)<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .description(<span class="hljs-string">&quot;ç‘å‰å¤–å–æ¥å£æ–‡æ¡£&quot;</span>)<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è®¾ç½®é™æ€èµ„æºæ˜ å°„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">registry.addResourceHandler(<span class="hljs-string">&quot;doc.html&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>);<br>registry.addResourceHandler(<span class="hljs-string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br></code></pre></td></tr></table></figure><p><strong>è®¾ç½®<code>LoginCheckFilter</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šä¹‰ä¸éœ€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„</span><br>String[] urls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<br>        <br>    ......<br>            <br>        <span class="hljs-string">&quot;/doc.html&quot;</span>,<br>        <span class="hljs-string">&quot;/webjars/**&quot;</span>,<br>        <span class="hljs-string">&quot;/swagger-resources&quot;</span>,<br>        <span class="hljs-string">&quot;/v2/api-docs&quot;</span><br>&#125;;<br></code></pre></td></tr></table></figure><hr><h1 id="å‡å•†å“"><a href="#å‡å•†å“" class="headerlink" title="å‡å•†å“"></a>å‡å•†å“</h1>]]></content>
    
    
    <categories>
      
      <category>ç‘å‰å¤–å–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®</tag>
      
      <tag>ssm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•</title>
    <link href="/2022/07/01/2022-7-1-%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <url>/2022/07/01/2022-7-1-%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h1 id="âœ¨æ•°æ®ç»“æ„ä¸ç®—æ³•"><a href="#âœ¨æ•°æ®ç»“æ„ä¸ç®—æ³•" class="headerlink" title="âœ¨æ•°æ®ç»“æ„ä¸ç®—æ³•"></a>âœ¨æ•°æ®ç»“æ„ä¸ç®—æ³•</h1><blockquote><p>Githubï¼š<a href="https://github.com/sanshisi/DS">https://github.com/sanshisi/DS</a></p></blockquote><h1 id="ä¸€ã€æ¦‚å¿µä»‹ç»"><a href="#ä¸€ã€æ¦‚å¿µä»‹ç»" class="headerlink" title="ä¸€ã€æ¦‚å¿µä»‹ç»"></a>ä¸€ã€æ¦‚å¿µä»‹ç»</h1><h2 id="1-æ•°æ®ç»“æ„æ¦‚è¿°"><a href="#1-æ•°æ®ç»“æ„æ¦‚è¿°" class="headerlink" title="1.æ•°æ®ç»“æ„æ¦‚è¿°"></a>1.æ•°æ®ç»“æ„æ¦‚è¿°</h2><blockquote><p>æ•°æ®ä¹‹é—´çš„å…³ç³»</p></blockquote><h3 id="1-1é€»è¾‘ç»“æ„"><a href="#1-1é€»è¾‘ç»“æ„" class="headerlink" title="1.1é€»è¾‘ç»“æ„"></a>1.1é€»è¾‘ç»“æ„</h3><ul><li>çº¿æ€§ç»“æ„ï¼šçº¿æ€§ç»“æ„ä¸­çš„æ•°æ®å…ƒç´ ä¹‹é—´æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»</li><li>æ ‘å½¢ç»“æ„ï¼šæ ‘å½¢ç»“æ„ä¸­çš„æ•°æ®å…ƒç´ ä¹‹é—´å­˜åœ¨ä¸€ç§ä¸€å¯¹ä¸€çš„å±‚æ¬¡å…³ç³»</li><li>å›¾å½¢ç»“æ„ï¼šå›¾å½¢ç»“æ„çš„æ•°æ®å…ƒç´ æ˜¯å¤šå¯¹å¤šçš„å…³ç³»</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/7b4d3b5e726183a2e1c11dced9feb2cf.png" alt="image-20220110113715973"></p><h3 id="1-2ç‰©ç†ç»“æ„"><a href="#1-2ç‰©ç†ç»“æ„" class="headerlink" title="1.2ç‰©ç†ç»“æ„"></a>1.2ç‰©ç†ç»“æ„</h3><ul><li>é¡ºåºå­˜å‚¨ç»“æ„ï¼šå¼€è¾Ÿä¸€ç»„è¿ç»­çš„ç©ºé—´å­˜å‚¨æ•°æ®</li><li>é“¾å¼å­˜å‚¨ç»“æ„ï¼šå¼€è¾Ÿä¸€ç»„éšæœºçš„ç©ºé—´å­˜å‚¨æ•°æ®</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/a4c78d53ade676b53333213d5392c564.png" alt="image-20220110123504095"></p><h2 id="2-ç®—æ³•æ¦‚è¿°"><a href="#2-ç®—æ³•æ¦‚è¿°" class="headerlink" title="2.ç®—æ³•æ¦‚è¿°"></a>2.ç®—æ³•æ¦‚è¿°</h2><h3 id="2-1ä»€ä¹ˆæ˜¯ç®—æ³•"><a href="#2-1ä»€ä¹ˆæ˜¯ç®—æ³•" class="headerlink" title="2.1ä»€ä¹ˆæ˜¯ç®—æ³•"></a>2.1ä»€ä¹ˆæ˜¯ç®—æ³•</h3><p>æ˜¯è§£å†³ç‰¹å®šé—®é¢˜æ±‚è§£æ­¥éª¤çš„æè¿°,åˆ†æé—®é¢˜ï¼Œä¸€æ­¥ä¸€æ­¥æ±‚è§£ï¼Œå¹¶å¾—åˆ°ç»“æœ,è¿™ä¸€ç³»åˆ—çš„æ­¥éª¤å°±ç§°ä¹‹ä¸º<strong>ç®—æ³•</strong></p><p><strong>ä¾‹å¦‚ï¼š</strong>1~100æ±‚å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">=====æ–¹æ³•ä¸€<br><span class="hljs-type">int</span> sum=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> N=<span class="hljs-number">100</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=N;i++)&#123;<br>sum+=i;<br>&#125;<br>=====æ–¹æ³•äºŒ<br><span class="hljs-type">int</span> N=<span class="hljs-number">100</span>;<br><span class="hljs-type">int</span> sum=(N+<span class="hljs-number">1</span>)*N/<span class="hljs-number">2</span>;    <br></code></pre></td></tr></table></figure><blockquote><p>æ–¹æ¡ˆ1éšç€Nçš„å¢å¤§ï¼Œå¾ªç¯çš„æ¬¡æ•°ä¹Ÿä¼šå¢å¤§ï¼Œä¹Ÿå°±æ„å‘³ç€æ‰§è¡Œçš„æ¬¡æ•°å’Œè¿è¡Œçš„æ—¶é—´ä¹Ÿä¼šå¢å¤§</p><p>æ–¹æ¡ˆ2éšç€Nçš„å¢å¤§ï¼Œå…¶æ‰§è¡Œæ¬¡æ•°åªæœ‰ä¸€æ¬¡ï¼Œä¸ä¼šéšç€Nçš„å¢å¤§è€Œå¢å¤§</p></blockquote><p><strong>åŒä¸€ä¸ªé—®é¢˜ï¼Œå¯ä»¥æœ‰å¤šç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨ä¸åŒçš„ç®—æ³•å»è§£å†³åŒä¸€ä¸ªé—®é¢˜</strong></p><h3 id="2-2è¯„ä»·ç®—æ³•çš„å¥½å"><a href="#2-2è¯„ä»·ç®—æ³•çš„å¥½å" class="headerlink" title="2.2è¯„ä»·ç®—æ³•çš„å¥½å"></a>2.2è¯„ä»·ç®—æ³•çš„å¥½å</h3><ul><li>äº‹åç»Ÿè®¡æ³•</li><li>äº‹å‰åˆ†ææ³•</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/77651191d4cdcb0010c81fda4cfef3e0.png" alt="image-20220110124119211"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/b3f968e102d91409a497a1aa6147d274.png" alt="image-20220110124130526"></p><h3 id="2-3æ—¶é—´å¤æ‚åº¦"><a href="#2-3æ—¶é—´å¤æ‚åº¦" class="headerlink" title="2.3æ—¶é—´å¤æ‚åº¦"></a>2.3æ—¶é—´å¤æ‚åº¦</h3><blockquote><p><strong>ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸»è¦æ¢ç©¶çš„æ˜¯é—®é¢˜è¾“å…¥è§„æ¨¡Nçš„æ•°é‡çº§</strong></p><p><strong>ä¸æ˜¯ç®—æ³•çš„å…·ä½“æ‰§è¡Œæ¬¡æ•°</strong></p></blockquote><hr><p><strong>å¸¸æ•°é˜¶O(1)</strong></p><blockquote><p>å°±æ˜¯é‚£äº›æ— å¾ªç¯ã€æ— é€’å½’ã€ä¸é—®é¢˜è¾“å…¥è§„æ¨¡Næ— å…³çš„ã€é€è¡Œæ‰§è¡Œçš„ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;<br></code></pre></td></tr></table></figure><hr><p><strong>çº¿æ€§é˜¶O(n)</strong></p><blockquote><p>ä¸é—®é¢˜è¾“å…¥è§„æ¨¡æœ‰å…³çš„ï¼Œä¸»è¦æ˜¯ä¸€å±‚å¾ªç¯çš„ä»£ç ï¼Œå¤šä¸ªä¸€å±‚å¾ªç¯å¯ä»¥å¹¶åˆ—ä½†ä¸èƒ½åŒ…å«</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= N; i++) &#123;<br>    System.out.println(i);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= N; i++) &#123;<br>    System.out.println(i);<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= N; i++) &#123;<br>    System.out.println(i);<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>çº¿æ€§é˜¶O(n+m)</strong></p><blockquote><p>å’Œçº¿æ€§é˜¶O(n)ä¸€æ ·ï¼Œåªä¸è¿‡æˆ‘ä»¬æœ‰ä¸¤ç§æ•°æ®çš„è¾“å…¥è§„æ¨¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= N; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= N; j++) &#123;<br>        System.out.println(i + j);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>å¹³æ–¹é˜¶O(n^2)</strong></p><blockquote><p>ä¸é—®é¢˜è¾“å…¥è§„æ¨¡æœ‰å…³çš„ï¼Œä¸»è¦æ˜¯äºŒå±‚åµŒå¥—å¾ªç¯çš„ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= N; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= N; j++) &#123;<br>        System.out.println(i + j);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>å¹³æ–¹é˜¶O(nm)</strong></p><blockquote><p>å’Œå¹³æ–¹é˜¶O(n^2)ä¸€æ ·ï¼Œåªä¸è¿‡æˆ‘ä»¬æœ‰ä¸¤ç§æ•°æ®è¾“å…¥è§„æ¨¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">M</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= N; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= M; j++) &#123;<br>        System.out.println(i + j);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>å¯¹æ•°é˜¶O(logn)</strong></p><blockquote><p>ä¸é—®é¢˜è¾“å…¥è§„æ¨¡æœ‰å…³çš„ï¼Œä¸»è¦æ˜¯ä¸€å±‚å¾ªç¯è¿­ä»£æˆ–é€’å½’çš„ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> <span class="hljs-number">100000</span>;<br><span class="hljs-keyword">while</span> (count &lt; N) <br>    count = count * <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure><hr><p>âœ¨<strong>æ—¶é—´å¤æ‚åº¦ç®€å•è®¡ç®—</strong>ï¼šå¿½ç•¥å¸¸æ•°ã€åªä¿ç•™å¹‚é«˜é¡¹ã€ä¸”å¿½ç•¥å¹‚é«˜é¡¹çš„ç³»æ•°ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/68210c985d2989d56ec47ec5b1ee2a9b.png" alt="image-20220110125423456"></p><p><strong>âœ¨å¸¸è§é˜¶çš„æ¯”è¾ƒï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/img_convert/a1d13f4ffa647044118ef3cd88810c9b.png" alt="image-20220110125557002"></p><h1 id="äºŒã€åŠ¨æ€æ•°ç»„"><a href="#äºŒã€åŠ¨æ€æ•°ç»„" class="headerlink" title="äºŒã€åŠ¨æ€æ•°ç»„"></a>äºŒã€åŠ¨æ€æ•°ç»„</h1><blockquote><p>åŠ¨æ€æ•°ç»„å°±æ˜¯é¡ºåºå­˜å‚¨ç»“æ„å…·ä½“å®ç°çš„æ ¸å¿ƒæ€æƒ³</p></blockquote><h2 id="1-æ•°ç»„æ¦‚è¿°"><a href="#1-æ•°ç»„æ¦‚è¿°" class="headerlink" title="1.æ•°ç»„æ¦‚è¿°"></a>1.æ•°ç»„æ¦‚è¿°</h2><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹Javaå†…ç½®æ•°ç»„</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>æ•°ç»„çš„é•¿åº¦ä¸€æ—¦ç¡®å®šåˆ™ä¸å¯æ›´æ”¹</li><li>æ•°ç»„åªèƒ½å­˜å‚¨åŒä¸€ç±»å‹çš„æ•°æ®</li><li>æ•°ç»„æ¯ä¸ªå­˜å‚¨ç©ºé—´åœ°å€æ˜¯è¿ç»­ä¸”ç›¸ç­‰çš„</li><li>æ•°ç»„æä¾›è§’æ ‡çš„æ–¹å¼è®¿é—®å…ƒç´ </li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>é•¿åº¦ä¸å¯å˜</li><li>åœ°å€è¿ç»­ä¸”æä¾›è§’æ ‡è®¿é—®å¾ˆå¿«</li><li>æ•°ç»„åªæœ‰lengthè¿™ä¸ªå±æ€§</li></ul><p>å› æ­¤æˆ‘ä»¬æƒ³å®ç°æ›´å¤šçš„åŠŸèƒ½é€šè¿‡åŠ¨æ€æ•°ç»„</p><p>ä¾‹å¦‚ï¼š</p><ul><li>åœ¨ä»»æ„ä½ç½®æ·»åŠ åˆ é™¤å…ƒç´ </li><li>è·å–ä»»æ„ä½ç½®å…ƒç´ </li><li>æ›´æ”¹æŸä¸€ä½ç½®å…ƒç´ æ•°æ®</li><li>æ¸…ç©ºæ•°ç»„</li><li>â€¦â€¦</li></ul><h2 id="2-çº¿æ€§è¡¨çš„å®ç°"><a href="#2-çº¿æ€§è¡¨çš„å®ç°" class="headerlink" title="2.çº¿æ€§è¡¨çš„å®ç°"></a>2.çº¿æ€§è¡¨çš„å®ç°</h2><h3 id="2-1Listæ¥å£çš„å®šä¹‰"><a href="#2-1Listæ¥å£çš„å®šä¹‰" class="headerlink" title="2.1Listæ¥å£çš„å®šä¹‰"></a>2.1Listæ¥å£çš„å®šä¹‰</h3><p>å®šä¹‰ä¸€ç³»åˆ—ä¾‹å¦‚æ·»åŠ ã€åˆ é™¤ã€å¤§å°ã€æŸ¥æ‰¾å…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€å…ƒç´ æ˜¯å¦åœ¨æ•°ç»„ã€æ•°ç»„æ˜¯å¦ä¸ºç©ºã€åˆ†å‰²æ•°ç»„ã€æ•°ç»„æ’åºã€è¿­ä»£â€¦â€¦</p><p><img src="https://img-blog.csdnimg.cn/img_convert/19e2a3195f5f3e4a44c71e36036a2649.png" alt="image-20220110131628955"></p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p1/%E6%8E%A5%E5%8F%A3/List.java">List.java</a></p><h3 id="2-2å®ç°ArrayList"><a href="#2-2å®ç°ArrayList" class="headerlink" title="2.2å®ç°ArrayList"></a>2.2å®ç°ArrayList</h3><p>âœ¨<strong>å…·ä½“å®ç°</strong></p><p><strong>æ·»åŠ æˆ–åˆ é™¤ä¼šé‡åˆ°çš„æƒ…å†µ</strong></p><blockquote><p>æ‰©å®¹æˆ–ç¼©å®¹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">...add() <br>    <span class="hljs-comment">// å½“å®¹é‡æ»¡äº†ï¼Œæ‰©ä¸¤å€</span><br>    <span class="hljs-comment">// åˆ¤è¯»çº¿æ€§è¡¨æ˜¯å¦æ»¡çŠ¶æ€</span><br>    <span class="hljs-keyword">if</span> (size == data.length) &#123;<br>        resize(<span class="hljs-number">2</span> * data.length);<br>    &#125;<br>...<br>    <br>...remove()<br>    <span class="hljs-comment">// ä»€ä¹ˆæ—¶å€™ç¼©å®¹</span><br>    <span class="hljs-comment">// 1.æœ‰æ•ˆå…ƒç´ æ˜¯å®¹é‡çš„1/4</span><br>    <span class="hljs-comment">// 2.å½“å‰å®¹é‡ä¸å¾—å°äºçš„ç­‰äºé»˜è®¤å®¹é‡</span><br>    <span class="hljs-keyword">if</span> (size == data.length / <span class="hljs-number">4</span> &amp;&amp; data.length &gt; DEFAULT_CAPACITY) &#123;<br>        resize(data.length / <span class="hljs-number">2</span>);<br>    &#125;<br>...<br><br><br><span class="hljs-comment">// æ‰©å®¹/ç¼©å®¹ æ“ä½œ ä¸å‘å¤–ç•Œå¼€æ”¾æä¾›  æ˜¯ç§æœ‰private</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resize</span><span class="hljs-params">(<span class="hljs-type">int</span> newLen)</span> &#123;<br>    E[] newData = (E[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[newLen];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) &#123;<br>        newData[i] = data[i];<br>    &#125;<br>    data = newData;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>æ’åº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">(Comparator&lt;E&gt; c)</span> &#123;<br>    <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;comparator can not be null&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; size; i++) &#123;<br>        <span class="hljs-type">E</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> data[i];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (j = i; j &gt; <span class="hljs-number">0</span> &amp;&amp; c.compare(data[j - <span class="hljs-number">1</span>], e) &gt; <span class="hljs-number">0</span>; j--) &#123; <span class="hljs-comment">// compare &gt; 0 ä»£è¡¨ç¬¬ä¸€ä¸ªå€¼æ¯”ç¬¬äºŒä¸ªå€¼å¤§</span><br>            data[j] = data[j - <span class="hljs-number">1</span>];<br>        &#125;<br>        data[j] = e;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>é‡å†™equals</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> &#123; <span class="hljs-comment">// æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ª ArrayList æ˜¯å¦ç›¸ç­‰</span><br>    <span class="hljs-comment">// 1.åˆ¤ç©º</span><br>    <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-comment">// 2.åˆ¤è‡ªå·±</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == o) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-comment">// 3.åˆ¤ç±»å‹</span><br>    <span class="hljs-keyword">if</span> (o <span class="hljs-keyword">instanceof</span> ArrayList) &#123;<br>        <span class="hljs-comment">// 4.æŒ‰ç…§è‡ªå·±çš„é€»è¾‘æ¯”è¾ƒ</span><br>        ArrayList&lt;E&gt; other = (ArrayList&lt;E&gt;) o;<br>        <span class="hljs-comment">// 5.å…ˆæ¯”è¾ƒå…ƒç´ çš„ä¸ªæ•°</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.size != other.size) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-comment">// 6.æœ‰æ•ˆå…ƒç´ ä¸ªæ•°ç›¸ç­‰çš„æƒ…å†µä¸‹ é€ä¸ªæ¯”è¾ƒå…ƒç´ </span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) &#123;<br>            <span class="hljs-keyword">if</span> (!data[i].equals(other.data[i])) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>é‡å†™è¿­ä»£å™¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–å½“å‰è¿™ä¸ªæ•°æ®ç»“æ„/å®¹å™¨ çš„ è¿­ä»£å™¨</span><br><span class="hljs-comment">//é€šè¿‡è¿­ä»£å™¨å¯¹è±¡ æ›´æ–¹ä¾¿æŒ¨ä¸ªå–å‡ºæ¯ä¸€ä¸ªå…ƒç´ </span><br><span class="hljs-comment">//åŒæ—¶ å®ç°äº†Iterable å¯ä»¥è®©å½“å‰çš„æ•°æ®ç»“æ„/å®¹å™¨ è¢«foreachå¾ªç¯éå†</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayListIterator</span>();<br>&#125;<br><br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå±äºArrayListçš„è¿­ä»£å™¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayListIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;E&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">cur</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>        <span class="hljs-keyword">return</span> cur &lt; size;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<span class="hljs-comment">//å¦‚æœæœ‰ä¸‹ä¸€ä¸ªå…ƒç´  åˆ™æŠŠå½“å‰å…ƒç´ è¿”å› å¹¶ç§»è‡³åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>        <span class="hljs-keyword">return</span> data[cur++]; <span class="hljs-comment">// å…ˆç”¨ååŠ </span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€¦â€¦</p><p><img src="https://img-blog.csdnimg.cn/img_convert/6a315164b5d26e72b7ddf760c20c55a5.png" alt="image-20220110131732408"></p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/ArrayList.java">ArrayList.java</a></p><h2 id="3-æ ˆçš„å®ç°"><a href="#3-æ ˆçš„å®ç°" class="headerlink" title="3.æ ˆçš„å®ç°"></a>3.æ ˆçš„å®ç°</h2><blockquote><p>å…ˆè¿›åå‡º</p></blockquote><h3 id="3-1Stackæ¥å£çš„å®šä¹‰"><a href="#3-1Stackæ¥å£çš„å®šä¹‰" class="headerlink" title="3.1Stackæ¥å£çš„å®šä¹‰"></a>3.1Stackæ¥å£çš„å®šä¹‰</h3><p><strong>ğŸ“ƒæ ˆçš„æ–¹æ³•</strong></p><ul><li>å‡ºæ ˆ</li><li>å…¥æ ˆ</li><li>æŸ¥çœ‹æ ˆé¡¶æ•°æ®</li><li>â€¦â€¦</li></ul><p>å› ä¸ºæ˜¯åŠ¨æ€æ•°ç»„å®ç°æ ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å®ç°å‡ºå…¥æ ˆéƒ½æ˜¯å¯¹æ•°ç»„è¿›è¡Œæ“ä½œ</p><p>å…¥æ ˆæœ¬è´¨ä¸Šå°±æ˜¯åœ¨åŠ¨æ€æ•°ç»„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªæ•°æ®</p><p>å‡ºæ ˆæœ¬è´¨ä¸Šå°±æ˜¯åŠ¨æ€æ•°ç»„å°¾éƒ¨åˆ é™¤ä¸€ä¸ªæ•°æ®</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ea8f76b7e689708c603712369cd69e72.png" alt="image-20220110132149124"></p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p1/%E6%8E%A5%E5%8F%A3/Stack.java">Stack.java</a></p><h3 id="3-2å®ç°ArrayStack"><a href="#3-2å®ç°ArrayStack" class="headerlink" title="3.2å®ç°ArrayStack"></a>3.2å®ç°ArrayStack</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/c612eaf062aa06767ae199e0991be22f.png" alt="image-20220110132205228"></p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/ArrayStack.java">ArrayStack.java</a></p><h3 id="3-3ä¸­ç¼€è¡¨è¾¾å¼"><a href="#3-3ä¸­ç¼€è¡¨è¾¾å¼" class="headerlink" title="3.3ä¸­ç¼€è¡¨è¾¾å¼"></a>3.3ä¸­ç¼€è¡¨è¾¾å¼</h3><blockquote><p>ä¼ å…¥ä¸€ä¸ªè¡¨è¾¾å¼   (10+20&#x2F;2*3)&#x2F;2+8   å¯¹å…¶è¿›è¡Œè®¡ç®—</p></blockquote><p>ç»™å®šè¡¨è¾¾å¼ï¼š<code>(10+20/2*3)/2+8</code></p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦å’Œæ•°å­—åˆ†ç¦»ï¼Œç”¨åˆ°è‡ªå®šä¹‰æ–¹æ³•<code>insertBlanks()</code>å’Œå­—ç¬¦ä¸²çš„<code>split()</code>,ä¹‹åè¿™äº›å­˜å…¥æ•°ç»„<code>tokens</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">=====insertBlanks()=====<br><span class="hljs-comment">//å¯¹åŸè¡¨è¾¾å¼è¿›è¡Œæ ¼å¼åŒ–å¤„ç† ç»™æ‰€æœ‰çš„éæ•°å­—å­—ç¬¦ä¸¤è¾¹æ·»åŠ ç©ºæ ¼</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">insertBlanks</span><span class="hljs-params">(String expression)</span> &#123;<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; expression.length(); i++) &#123;<br>        <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> expression.charAt(i);<br>        <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&#x27;(&#x27;</span> || c == <span class="hljs-string">&#x27;)&#x27;</span> || c == <span class="hljs-string">&#x27;+&#x27;</span> || c == <span class="hljs-string">&#x27;-&#x27;</span> || c == <span class="hljs-string">&#x27;*&#x27;</span> || c == <span class="hljs-string">&#x27;/&#x27;</span>) &#123;<br>            sb.append(<span class="hljs-string">&#x27; &#x27;</span>);<br>            sb.append(c);<br>            sb.append(<span class="hljs-string">&#x27; &#x27;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            sb.append(c);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sb.toString();<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ€è·¯å°±å¾ˆç®€å•äº†ï¼Œä¾æ¬¡éå†æ•°ç»„<code>tokens</code>ï¼Œå–å‡ºå…ƒç´ æ”¾å…¥<code>numberStack</code>ã€<code>operatorStack</code>ä¸¤ä¸ªæ ˆä¸­ï¼Œç„¶ååœ¨æ ¹æ®ç¬¦å·è¿›è¡Œå¼¹æ ˆæ“</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>1*2+3</p><blockquote><p>éœ€è¦éå†5æ¬¡</p></blockquote><p><strong>ç¬¬1æ¬¡éå†ï¼š</strong></p><p><code>1</code>ç›´æ¥æ”¾å…¥æ•°å­—æ ˆ</p><p><code>numberStack : [1]</code></p><p><code>operatorStack : []</code></p><p><strong>ç¬¬2æ¬¡éå†ï¼š</strong></p><p><code>+</code>ï¼Œç¬¦å·æ ˆä¸ºç©ºï¼Œç›´æ¥æ”¾å…¥ç¬¦å·æ ˆ</p><p><code>numberStack : [1]</code></p><p><code>operatorStack : [*]</code></p><p><strong>ç¬¬3æ¬¡éå†ï¼š</strong></p><p><code>2</code>ç›´æ¥æ”¾å…¥æ•°å­—æ ˆ</p><p><code>numberStack : [1,2]</code></p><p><code>operatorStack : [*]</code></p><p><strong>ç¬¬4æ¬¡éå†ï¼š</strong></p><p><code>+</code>,æ­¤æ—¶ç¬¦å·æ ˆå·²ç»æœ‰ä¹˜å·äº†ï¼Œå¹¶ä¸”ä¹˜å·ä¼˜å…ˆçº§æ¯”åŠ å·é«˜ï¼Œæ‰€ä»¥åº”å½“è¿›è¡Œå¼¹æ ˆè®¡ç®—ï¼Œå°†å¾—åˆ°çš„ç»“æœæ”¾å…¥æ•°å­—æ ˆ</p><p><code>numberStack : [2]</code></p><p><code>operatorStack : [+]</code></p><p><strong>ç¬¬5æ¬¡éå†ï¼š</strong></p><p><code>3</code>ç›´æ¥æ”¾å…¥æ•°å­—æ ˆ</p><p><code>numberStack : [2,3]</code></p><p><code>operatorStack : [+]</code></p><p><strong>æœ€å</strong></p><p>å°†æ•°å­—æ ˆå’Œç¬¦å·æ ˆä¸­çš„å…ƒç´ ä¾æ¬¡å¼¹å‡ºè®¡ç®—</p><p>ä»£ç ä½ç½®ï¼š<a href="InfixCalculator.java">InfixCalculator.java</a></p><h3 id="3-4ä¸­ç¼€è½¬åç¼€-gt-åç¼€è¡¨è¾¾å¼-åšè®¡ç®—å™¨-é€†æ³¢å…°è¡¨è¾¾å¼"><a href="#3-4ä¸­ç¼€è½¬åç¼€-gt-åç¼€è¡¨è¾¾å¼-åšè®¡ç®—å™¨-é€†æ³¢å…°è¡¨è¾¾å¼" class="headerlink" title="3.4ä¸­ç¼€è½¬åç¼€   -&gt;  åç¼€è¡¨è¾¾å¼ åšè®¡ç®—å™¨(é€†æ³¢å…°è¡¨è¾¾å¼)"></a>3.4ä¸­ç¼€è½¬åç¼€   -&gt;  åç¼€è¡¨è¾¾å¼ åšè®¡ç®—å™¨(é€†æ³¢å…°è¡¨è¾¾å¼)</h3><p><strong>ä¸­ç¼€è½¬åç¼€</strong></p><p>å°†ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºåç¼€è¡¨è¾¾å¼ï¼Œæ›´ä¸ºå®¹æ˜“è®¡ç®—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">ä¸­ç¼€å½¢å¼ï¼š(<span class="hljs-number">10</span>+<span class="hljs-number">20</span>/<span class="hljs-number">2</span>*<span class="hljs-number">3</span>)/<span class="hljs-number">2</span>+<span class="hljs-number">8</span><br>åç¼€å½¢å¼ï¼š<span class="hljs-number">10</span> <span class="hljs-number">20</span> <span class="hljs-number">2</span> / <span class="hljs-number">3</span> * + <span class="hljs-number">2</span> / <span class="hljs-number">8</span> + <br></code></pre></td></tr></table></figure><p>éœ€è¦ä½¿ç”¨ä¸€ä¸ªç¬¦å·æ ˆå’Œä¸€ä¸ªæ•°ç»„è¿›è¡Œå­˜å‚¨æ•°æ®</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7321011854597a554c01e03d9a4b48bc.gif" alt="ä¸­ç¼€è½¬åç¼€"></p><p>å¤§æ¦‚åŸç†ï¼šéå†ä¸­ç¼€è¡¨è¾¾å¼ï¼Œå¦‚æœæ˜¯æ•°å­—ï¼Œç›´æ¥å­˜å…¥æ•°ç»„ä¸­ï¼Œé‡åˆ°ç¬¦å·ï¼Œé¦–å…ˆåˆ¤æ–­ä¼˜å…ˆçº§ï¼Œå¦‚æœæ ˆé¡¶ä¼˜å…ˆçº§æ›´é«˜æˆ–ç›¸ç­‰ï¼Œåˆ™å°†æ ˆé¡¶ç¬¦å·æ”¾å…¥æ•°ç»„ä¸­ï¼Œå¦‚æœæ˜¯å·¦æ‹¬å·ï¼Œåˆ™å°†å·¦æ‹¬å·å…¥ç¬¦å·æ ˆï¼Œå¦‚æœæ˜¯å³æ‹¬å·ï¼Œåˆ™å°†ç¬¦å·æ ˆä¸­å·¦æ‹¬å·ä¸Šçš„ç¬¦å·ä¾æ¬¡å¼¹å‡ºæ”¾å…¥æ•°ç»„ä¸­ï¼ˆæ³¨ï¼šæ‹¬å·ä¸éœ€è¦æ”¾å…¥æ•°ç»„ï¼‰ï¼Œéå†åˆ°æœ€åï¼Œå¦‚æœç¬¦å·æ ˆä¸ä¸ºç©ºï¼Œä¾æ¬¡å°†ç¬¦å·æ ˆä¸­å…ƒç´ å¼¹å‡ºæ”¾å…¥æ•°ç»„ä¸­å°±å¥½äº†</p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/InfixToSuffix.java">InfixToSuffix.java</a></p><p><strong>é€†æ³¢å…°è¡¨è¾¾å¼</strong>ï¼šä½¿ç”¨åç¼€è¡¨è¾¾å¼åšè®¡ç®—å™¨</p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/SuffixCalculator.java">SuffixCalculator.java</a></p><h3 id="3-5è¿›åˆ¶è½¬æ¢"><a href="#3-5è¿›åˆ¶è½¬æ¢" class="headerlink" title="3.5è¿›åˆ¶è½¬æ¢"></a>3.5è¿›åˆ¶è½¬æ¢</h3><p><strong>âœ¨æŒæ¡å¥½å¦‚ä½•ä½¿ç”¨ASCAllç </strong></p><p><strong>åè¿›åˆ¶è½¬åå…­è¿›åˆ¶</strong>-</p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/DecToHex.java">DecToHex.java</a></p><p><strong>åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</strong></p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/HexToDec.java">HexToDec.java</a></p><h3 id="3-6å›æ–‡åˆ¤æ–­"><a href="#3-6å›æ–‡åˆ¤æ–­" class="headerlink" title="3.6å›æ–‡åˆ¤æ–­"></a>3.6å›æ–‡åˆ¤æ–­</h3><p>æ³•1ï¼š</p><p>æ¯æ¬¡å…¥æ ˆå‰è¦åˆ¤æ–­è¯¥å€¼å’Œæ ˆé¡¶å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰å°±è¿›è¡Œå¼¹æ ˆæ“ä½œï¼Œæœ€åé€šè¿‡åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºæ¥å†³å®šæ˜¯å¦ä¸ºå›æ–‡</p><blockquote><p>ä½†æ˜¯æœ‰ä¸€ä¸ªbugï¼Œå°±æ˜¯é‡ä¸Š<code>aabbccdd</code>è¿™ç§ä¹Ÿä¼šåˆ¤æ–­æˆå›æ–‡</p></blockquote><p>æ³•2ï¼š</p><p>é€šè¿‡åŒæŒ‡é’ˆæ–¹æ³•è¿›è¡Œéå†å­—ç¬¦ä¸²ï¼Œè§£å†³äº†æ³•ä¸€çš„bug</p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/JudgingPalindrome.java">JudgingPalindrome.java</a></p><h3 id="3-7æ‹¬å·åŒ¹é…"><a href="#3-7æ‹¬å·åŒ¹é…" class="headerlink" title="3.7æ‹¬å·åŒ¹é…"></a>3.7æ‹¬å·åŒ¹é…</h3><p>æ³•1ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">jshell&gt; <span class="hljs-string">&#x27;(&#x27;</span> - <span class="hljs-string">&#x27;)&#x27;</span><br>$<span class="hljs-number">2</span> ==&gt; -<span class="hljs-number">1</span><br>    <br>jshell&gt; <span class="hljs-string">&#x27;[&#x27;</span> - <span class="hljs-string">&#x27;]&#x27;</span><br>$<span class="hljs-number">3</span> ==&gt; -<span class="hljs-number">2</span><br>    <br>jshell&gt; <span class="hljs-string">&#x27;&#123;&#x27;</span> - <span class="hljs-string">&#x27;&#125;&#x27;</span><br>$<span class="hljs-number">4</span> ==&gt; -<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡Ascallç å¯ä»¥çŸ¥é“ï¼Œï¼ˆï¼‰[]  {} å·¦æ‹¬å·å’Œå³æ‹¬å·çš„å·®å€¼ä¸º-1æˆ–-2ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ‹¬å·åŒ¹é…</p><p>æ³•2ï¼š</p><p>é€šè¿‡<code>HashMap</code>æ¥åš</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;Character,Character&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&#x27;[&#x27;</span>,<span class="hljs-string">&#x27;]&#x27;</span>);<br>map.put(<span class="hljs-string">&#x27;&lt;&#x27;</span>,<span class="hljs-string">&#x27;&gt;&#x27;</span>);<br>map.put(<span class="hljs-string">&#x27;(&#x27;</span>,<span class="hljs-string">&#x27;)&#x27;</span>);<br>map.put(<span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span>);<br></code></pre></td></tr></table></figure><p>åªéœ€è¦è¿›è¡Œåˆ¤æ–­   æ ˆé¡¶å…ƒç´ æ˜¯å¦æ˜¯<code>map</code>ä¸­çš„é”®  &amp;&amp; è¯¥é”®å¯¹åº”çš„å€¼æ˜¯å¦ç­‰äºéå†å­—ç¬¦ä¸²çš„å€¼</p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/MatchBracket.java">MatchBracket.java</a></p><h3 id="3-8åŒç«¯æ ˆçš„å®ç°"><a href="#3-8åŒç«¯æ ˆçš„å®ç°" class="headerlink" title="3.8åŒç«¯æ ˆçš„å®ç°"></a>3.8åŒç«¯æ ˆçš„å®ç°</h3><p>åªæ˜¯å°†æ ˆçš„æ–¹æ³•æ‹“å®½äº†ï¼Œä»£ç å®ç°å…¶å®ä¸æ˜¯å¾ˆéš¾</p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/ArrayDoubleEndStack.java">ArrayDoubleEndStack.java</a></p><h2 id="4-é˜Ÿåˆ—çš„å®ç°"><a href="#4-é˜Ÿåˆ—çš„å®ç°" class="headerlink" title="4.é˜Ÿåˆ—çš„å®ç°"></a>4.é˜Ÿåˆ—çš„å®ç°</h2><blockquote><p>æ ˆæ˜¯å…ˆè¿›å…ˆå‡º</p></blockquote><h3 id="4-1Queueæ¥å£çš„å®šä¹‰"><a href="#4-1Queueæ¥å£çš„å®šä¹‰" class="headerlink" title="4.1Queueæ¥å£çš„å®šä¹‰"></a>4.1Queueæ¥å£çš„å®šä¹‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">offer()å…¥é˜Ÿåˆ—<br>poll()å‡ºé˜Ÿåˆ—<br>element()æŸ¥çœ‹é˜Ÿé¦–å…ƒç´ <br></code></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/00da9b875d152802422e3ae8964e6f84.png" alt="image-20220114153924198"></p><p>ä»£ç ä½ç½®ï¼š<a href="https://github.com/sanshisi/DS/blob/master/src/p1/%E6%8E%A5%E5%8F%A3/Queue.java">Queue.java</a></p><h3 id="4-2å®ç°ArrayQueue"><a href="#4-2å®ç°ArrayQueue" class="headerlink" title="4.2å®ç°ArrayQueue"></a>4.2å®ç°ArrayQueue</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/e7e03ba50d8a65293f777a600d9fb97f.png" alt="image-20220114154224235"></p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/ArrayQueue.java">ArrayQueue.java</a></p><h3 id="4-3æ–‡ä»¶éå†"><a href="#4-3æ–‡ä»¶éå†" class="headerlink" title="4.3æ–‡ä»¶éå†"></a>4.3æ–‡ä»¶éå†</h3><p>åŒè¿‡å¯¹é˜Ÿåˆ—å®ç°æ–‡ä»¶éå†ï¼Œåªè¦é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™å‡ºé˜Ÿä¸€ä¸ªç›®å½•å¯¹è±¡ï¼Œå°†è¯¥ç›®å½•å¯¹è±¡å±•å¼€ï¼Œå¼€å§‹éå†ï¼Œé‡åˆ°æ–‡ä»¶åˆ™æ‰“å°åç§°ï¼Œé‡åˆ°å…¶ä»–ç›®å½• åˆ™è¿›é˜Ÿ</p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/DiretoryTraversal.java">DiretoryTraversal.java</a></p><h3 id="4-4æ ˆå®ç°é˜Ÿåˆ—"><a href="#4-4æ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="4.4æ ˆå®ç°é˜Ÿåˆ—"></a>4.4æ ˆå®ç°é˜Ÿåˆ—</h3><p>è¿™é‡Œéœ€è¦ä¸¤ä¸ªæ ˆï¼šAæ ˆå’ŒBæ ˆ</p><p>å…¶ä¸­çœŸæ­£ç”¨æ¥å­˜æ”¾æ•°æ®çš„æ˜¯Aæ ˆï¼ŒBæ ˆä»…åšä¸­è½¬ç”¨</p><p>å‡è®¾Aæ ˆä¸­æœ‰ä¸‰ä¸ªå…ƒç´ ï¼š1,2,3</p><p><strong>ç°åœ¨è¿›è¡Œå‡ºé˜Ÿåˆ—</strong>ï¼šå‡ºçš„æ˜¯1ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¾æ¬¡å°†Aæ ˆä¸­çš„3,2å‡ºæ ˆï¼Œå­˜å…¥Bæ ˆä¸­ï¼Œå†å°†1å‡ºæ ˆè¿”å›ï¼Œä¹‹åå†å°†Bæ ˆä¸­çš„å…ƒç´ ä¾æ¬¡å‡ºæ ˆæ”¾å…¥Aæ ˆä¸­å³å¯</p><p><strong>å¦‚æœæ˜¯è¿›è¡Œå…¥é˜Ÿåˆ—</strong>ï¼šç›´æ¥äººAæ ˆå³å¯</p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/StackToQueue.java">StackToQueue.java</a></p><h3 id="4-5é˜Ÿåˆ—å®ç°æ ˆ"><a href="#4-5é˜Ÿåˆ—å®ç°æ ˆ" class="headerlink" title="4.5é˜Ÿåˆ—å®ç°æ ˆ"></a>4.5é˜Ÿåˆ—å®ç°æ ˆ</h3><p>è¿™é‡Œéœ€è¦ä¸¤ä¸ªé˜Ÿåˆ—ï¼šAé˜Ÿåˆ—å’ŒBé˜Ÿåˆ—</p><p>ä¸¤ä¸ªé˜Ÿåˆ—å¯ä»¥è½®æµå­˜å‚¨æ•°æ®</p><p>å‡è®¾åœ¨Aä¸­å…¥äº†ä¸‰ä¸ªå…ƒç´ ï¼š1,2,3</p><p><strong>ç°åœ¨è¿›è¡Œå‡ºæ ˆ</strong>ï¼šå‡ºçš„æ˜¯3ï¼Œéœ€è¦ä¾æ¬¡å°†Aä¸­çš„1,2å‡ºäº†ï¼Œå­˜å…¥Bä¸­ï¼Œç„¶åå†å°†3å‡ºé˜Ÿåˆ—è¿”å›å³å¯ï¼Œæ­¤æ—¶æ•°æ®å°±å…¨åœ¨Bä¸­</p><p><strong>ç°åœ¨è¿›è¡ŒæŸ¥çœ‹æ ˆé¡¶å…ƒç´ </strong>ï¼šæ ˆé¡¶å…ƒç´ ä¸º2ï¼ŒBä¸­å…ƒç´ 1,2ï¼Œéœ€è¦å°†Bä¸­1å‡ºé˜Ÿåˆ—ï¼Œå­˜å…¥Aé˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨å°†1å‡ºé˜Ÿåˆ—ï¼Œåœ¨è¿”å›å‰ï¼Œå°†1å…¥Aé˜Ÿåˆ—ï¼Œ</p><p>æ­¤æ—¶å…ƒç´ å°±å…¨å­˜åœ¨äº†Aæ ˆä¸­</p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/QueueToStack.java">QueueToStack.java</a></p><h3 id="4-6å¾ªç¯é˜Ÿåˆ—"><a href="#4-6å¾ªç¯é˜Ÿåˆ—" class="headerlink" title="4.6å¾ªç¯é˜Ÿåˆ—"></a>4.6å¾ªç¯é˜Ÿåˆ—</h3><p>å°†æ™®é€šçš„é˜Ÿåˆ—å˜æˆä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼ŒèŠ‚çœç©ºé—´ï¼Œå› æ­¤éœ€è¦å®šä¹‰ä¸€ä¸ªå¤´æŒ‡é’ˆå’Œå°¾æŒ‡é’ˆ</p><p>éœ€è¦é¢„ç•™ä¸€ä¸ªä½ç½®ç©ºç»™å°¾æŒ‡é’ˆ</p><blockquote><p>å‡è®¾ä¸ç•™ç©ºï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åˆ¤æ–­ç©ºæˆ–è€…æ»¡çš„æ—¶å€™åˆ¤æ–­æ¡ä»¶æ˜¯ä¸€æ ·çš„</p></blockquote><p>å› æ­¤æˆ‘ä»¬éœ€è¦ç•™ä¸€ä¸ªä½ç½®ç»™å°¾æŒ‡é’ˆï¼Œç”¨æ¥æ”¹å˜åˆ¤æ–­æ¡ä»¶</p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/ArrayLoopQueue.java">ArrayLoopQueue.java</a></p><h3 id="4-7åŒç«¯é˜Ÿåˆ—"><a href="#4-7åŒç«¯é˜Ÿåˆ—" class="headerlink" title="4.7åŒç«¯é˜Ÿåˆ—"></a>4.7åŒç«¯é˜Ÿåˆ—</h3><p>å…¶å®å°±æ˜¯å¾ªç¯é˜Ÿåˆ—çš„å‡çº§ç‰ˆ</p><p>åªæ˜¯åœ¨å…¶ä¸­åŠ äº†ä¸€äº›å¯¹æ ˆæ–¹æ³•çš„å®ç°</p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/ArrayDeque.java">ArrayDeque.java</a></p><h1 id="ä¸‰ã€åŠ¨æ€é“¾è¡¨"><a href="#ä¸‰ã€åŠ¨æ€é“¾è¡¨" class="headerlink" title="ä¸‰ã€åŠ¨æ€é“¾è¡¨"></a>ä¸‰ã€åŠ¨æ€é“¾è¡¨</h1><h2 id="1-å•é¡¹é“¾è¡¨"><a href="#1-å•é¡¹é“¾è¡¨" class="headerlink" title="1.å•é¡¹é“¾è¡¨"></a>1.å•é¡¹é“¾è¡¨</h2><blockquote><p>æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨æ•°å€¼å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p></blockquote><p><strong>âœ¨èŠ‚ç‚¹å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šä¹‰èŠ‚ç‚¹å¯¹è±¡</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>    E data;<br>    Node next;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(E data)</span> &#123;<br>        <span class="hljs-built_in">this</span>(data, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(E data, Node next)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>        <span class="hljs-built_in">this</span>.next = next;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> data.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/LinkedSinglyList.java">LinkedSinglyList.java</a></p><h2 id="2-å•é¡¹å¾ªç¯é“¾è¡¨"><a href="#2-å•é¡¹å¾ªç¯é“¾è¡¨" class="headerlink" title="2.å•é¡¹å¾ªç¯é“¾è¡¨"></a>2.å•é¡¹å¾ªç¯é“¾è¡¨</h2><blockquote><p>åœ¨å•é¡¹é“¾è¡¨çš„åŸºç¡€ä¸Šå°†é¦–å°¾é“¾æ¥åœ¨äº†ä¸€èµ·</p></blockquote><p><strong>âœ¨èŠ‚ç‚¹å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®šä¹‰ç»“ç‚¹å¯¹è±¡</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>    E data;     <span class="hljs-comment">//æ•°æ®åŸŸ</span><br>    Node next;  <span class="hljs-comment">//æŒ‡é’ˆåŸŸ</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(E data)</span> &#123;<br>        <span class="hljs-built_in">this</span>(data, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(E data, Node next)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>        <span class="hljs-built_in">this</span>.next = next;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> data.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/LinkedSinglyCircularList.java">LinkedSinglyCircularList.java</a></p><h4 id="çº¦ç‘Ÿå¤«ç¯"><a href="#çº¦ç‘Ÿå¤«ç¯" class="headerlink" title="çº¦ç‘Ÿå¤«ç¯"></a>çº¦ç‘Ÿå¤«ç¯</h4><blockquote><p>æ®è¯´è‘—åçŠ¹å¤ªå†å²å­¦å®¶Josephusæœ‰è¿‡ä¸€ä¸‹çš„æ•…äº‹:</p><p>åœ¨ç½—é©¬äººå é¢†ä¹”å¡”å¸•ç‰¹åï¼Œ39ä¸ªçŠ¹å¤ªäººä¸JosephusåŠä»–çš„æœ‹å‹èº²åœ¨ä¸€ä¸ªæ´ä¸­ï¼Œ39ä¸ªçŠ¹å¤ªäººå†³å®šå®æ„¿æ­»ä¹Ÿä¸è¦è¢«æ•ŒäººæŠ“åˆ°ï¼Œäºæ˜¯å†³å®šäº†ä¸€ä¸ªè‡ªæ€æ–¹å¼ï¼Œ41ä¸ªäººæ’æˆä¸€ä¸ªåœ†åœˆï¼Œç”±ç¬¬1ä¸ªäººå¼€å§‹æŠ¥æ•°ï¼Œæ¯æŠ¥æ•°åˆ°ç¬¬3ä¸ªäººè¯¥äººå¿…é¡»è‡ªæ€ï¼Œç„¶åå†ç”±ä¸‹ä¸€ä¸ªé‡æ–°æŠ¥æ•°,ç›´åˆ°æ‰€æœ‰äººéƒ½è‡ªæ€èº«äº¡ä¸ºæ­¢ã€‚</p><p>ç„¶è€ŒJosephuså’Œä»–çš„æœ‹å‹å¹¶ä¸æƒ³éµä», Josephusè¦ä»–çš„æœ‹å‹å…ˆå‡è£…éµä»ï¼Œä»–å°†æœ‹å‹ä¸è‡ªå·±å®‰æ’åœ¨äº†ç¬¬16ä¸ªä¸ç¬¬31ä¸ªä½ç½®ï¼Œäºæ˜¯é€ƒè¿‡äº†è¿™åœºæ­»äº¡æ¸¸æˆã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//çº¦ç‘Ÿå¤«ç¯é—®é¢˜</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">josephusLoop</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> head;<br>    <span class="hljs-keyword">while</span> (size != <span class="hljs-number">2</span>) &#123;<br>        p = p.next;<br>        <span class="hljs-type">Node</span> <span class="hljs-variable">del</span> <span class="hljs-operator">=</span> p.next;<br>        <span class="hljs-keyword">if</span> (del == head) &#123;<br>            head = del.next;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (del == tail) &#123;<br>            tail = p;<br>        &#125;<br>        p.next = del.next;<br>        del.next = <span class="hljs-literal">null</span>;<br>        p = p.next;<br>        size--;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é€¢ä¸ƒè¿‡æ¸¸æˆ"><a href="#é€¢ä¸ƒè¿‡æ¸¸æˆ" class="headerlink" title="é€¢ä¸ƒè¿‡æ¸¸æˆ"></a>é€¢ä¸ƒè¿‡æ¸¸æˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é€¢ä¸ƒè¿‡æ¸¸æˆ</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">è¾“å…¥ç©å®¶çš„ä¸ªæ•°</span><br><span class="hljs-comment">è¾“å…¥ä»å“ªä¸ªç©å®¶å¼€å§‹</span><br><span class="hljs-comment">è¾“å…¥è¯¥ç©å®¶ä»å“ªä¸ªæ•°å­—å¼€å§‹</span><br><span class="hljs-comment">è¾“å…¥ä¸€å…±ç©å‡ ä¸ªæ•°å­—</span><br><span class="hljs-comment">æ‰“å°å‡ºæ¯ä¸ªç©å®¶å°†è¦æŠ¥å‡ºçš„æ‰€æœ‰æ•°å­—</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/SevenGame.java">SevenGame.java</a></p><h2 id="3-åŒå‘å¾ªç¯é“¾è¡¨"><a href="#3-åŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="3.åŒå‘å¾ªç¯é“¾è¡¨"></a>3.åŒå‘å¾ªç¯é“¾è¡¨</h2><blockquote><p>æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨äº† å…ƒç´ å’ŒæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆå’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</p><p>é¦–å°¾ç›¸è¿æ¥</p></blockquote><p><strong>âœ¨èŠ‚ç‚¹å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>    E data;<br>    Node pre;   <span class="hljs-comment">//ç›´æ¥å‰é©±</span><br>    Node next;  <span class="hljs-comment">//ç›´æ¥åç»§</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(E data)</span> &#123;<br>        <span class="hljs-built_in">this</span>(data, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(E data, Node pre, Node next)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>        <span class="hljs-built_in">this</span>.pre = pre;<br>        <span class="hljs-built_in">this</span>.next = next;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> data.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/LinkedList.java">LinkedList.java</a></p><h1 id="å››ã€åˆ†æ²»å›æº¯"><a href="#å››ã€åˆ†æ²»å›æº¯" class="headerlink" title="å››ã€åˆ†æ²»å›æº¯"></a>å››ã€åˆ†æ²»å›æº¯</h1><h2 id="1-æ£‹ç›˜è¦†ç›–"><a href="#1-æ£‹ç›˜è¦†ç›–" class="headerlink" title="1.æ£‹ç›˜è¦†ç›–"></a>1.æ£‹ç›˜è¦†ç›–</h2><p>åšå®¢ä½ç½®ï¼š<a href="https://blog.csdn.net/weixin_46049759/article/details/122574014">https://blog.csdn.net/weixin_46049759&#x2F;article&#x2F;details&#x2F;122574014</a></p><h2 id="2-æ±‰è¯ºå¡”"><a href="#2-æ±‰è¯ºå¡”" class="headerlink" title="2.æ±‰è¯ºå¡”"></a>2.æ±‰è¯ºå¡”</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/LinkedList.java">LinkedList.java</a></p><h2 id="3-å…¨æ’åˆ—"><a href="#3-å…¨æ’åˆ—" class="headerlink" title="3.å…¨æ’åˆ—"></a>3.å…¨æ’åˆ—</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/LinkedList.java">LinkedList.java</a></p><h2 id="4-è¿·å®«é—®é¢˜"><a href="#4-è¿·å®«é—®é¢˜" class="headerlink" title="4.è¿·å®«é—®é¢˜"></a>4.è¿·å®«é—®é¢˜</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/LinkedList.java">LinkedList.java</a></p><h2 id="5-Nçš‡åé—®é¢˜"><a href="#5-Nçš‡åé—®é¢˜" class="headerlink" title="5.Nçš‡åé—®é¢˜"></a>5.Nçš‡åé—®é¢˜</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p2/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/LinkedList.java">LinkedList.java</a></p><h2 id="6-æ•°ç‹¬"><a href="#6-æ•°ç‹¬" class="headerlink" title="6.æ•°ç‹¬"></a>6.æ•°ç‹¬</h2><p>åšå®¢ä½ç½®ï¼š<a href="https://blog.csdn.net/weixin_46049759/article/details/122628294">https://blog.csdn.net/weixin_46049759&#x2F;article&#x2F;details&#x2F;122628294</a></p><h1 id="äº”ã€æ’åºç®—æ³•"><a href="#äº”ã€æ’åºç®—æ³•" class="headerlink" title="äº”ã€æ’åºç®—æ³•"></a>äº”ã€æ’åºç®—æ³•</h1><p><img src="https://sansisuifeng-img.oss-cn-beijing.aliyuncs.com/img/202207161715764.png" alt="image-20220716171540636"></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">ä¸‹åˆ—è¯´æ˜åœ¨æ­£æ–‡ç›¸åº”ç« èŠ‚å‡æœ‰æ›´è¯¦ç»†çš„æè¿°ã€‚<br><br>â€»<span class="hljs-number">1</span>å†’æ³¡: è¾“å…¥æ•°ç»„å·²æ’åºæ—¶æœ€å¥½ã€‚<br>â€»<span class="hljs-number">2</span>é€‰æ‹©: æ—¶é—´å¤æ‚åº¦ä¸è¾“å…¥æ•°ç»„ç‰¹ç‚¹æ— å…³ã€‚<br>â€»<span class="hljs-number">3</span>æ’å…¥: è¾“å…¥æ•°ç»„å·²æ’åºæ—¶æœ€å¥½ã€‚<br>â€»<span class="hljs-number">4</span>å¸Œå°”: å¤æ‚åº¦å–å†³äºå¢é‡åºåˆ—ï¼Œä¸¤è¡Œåˆ†åˆ«ä¸ºå¸Œå°”å¢é‡ï¼Œ<br>    å’ŒKnuthå¢é‡çš„å¸Œå°”æ’åºã€‚è¾“å…¥æ•°ç»„å·²æ’åºæ—¶æœ€å¥½ã€‚<br>â€»<span class="hljs-number">5</span>å½’å¹¶: æ‰€åˆ—å¤æ‚åº¦ä¸ºã€Œè‡ªé¡¶å‘ä¸‹éåŸåœ°ã€ç‰ˆæœ¬ã€‚<br>    è‡ªé¡¶å‘ä¸‹/è‡ªåº•å‘ä¸Šï¼ŒéåŸåœ°/åŸåœ°çš„æ—¶é—´ç©ºé—´å¤æ‚åº¦è§è¯¥å½’å¹¶æ’åºä¸€èŠ‚ã€‚<br>â€»<span class="hljs-number">6</span>å¿«é€Ÿ: å½“è¾“å…¥æ•°ç»„æœ‰åºï¼Œä¸”æ€»æ˜¯é€‰å–ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºä¸»è½´æ—¶ï¼Œ<br>    æ—¶é—´å¤æ‚åº¦é€€åŒ–ä¸º<span class="hljs-constructor">O(<span class="hljs-params">n</span>^2)</span>ã€‚ç©ºé—´å¼€é”€ä¸ºé€’å½’æ·±åº¦ã€‚<br>â€»<span class="hljs-number">7</span>å †: åŸåœ°å †æ’åºç©ºé—´å¤æ‚åº¦ä¸º<span class="hljs-constructor">O(1)</span>ã€‚è¾“å…¥æ•°ç»„æ‰€æœ‰æ•°å­—ç›¸ç­‰æ—¶ï¼Œ<br>    æ—¶é—´å¤æ‚åº¦ä¸º<span class="hljs-constructor">O(<span class="hljs-params">n</span>)</span>ã€‚<br>â€»<span class="hljs-number">8</span>è®¡æ•°: kæ˜¯è®¡æ•°æ•°ç»„å¤§å°ã€‚åº”ç”¨ç¨³å®šæ€§ä¼˜åŒ–åˆ™ç¨³å®šï¼Œå¦åˆ™ä¸ç¨³å®šã€‚<br>    æœ´ç´ ç‰ˆæœ¬ç©ºé—´å¤æ‚åº¦ä¸º<span class="hljs-constructor">O(<span class="hljs-params">k</span>)</span>ï¼Œç¨³å®šæ€§ä¼˜åŒ–ç‰ˆæœ¬ç©ºé—´å¤æ‚åº¦ä¸º<span class="hljs-constructor">O(<span class="hljs-params">n</span> + <span class="hljs-params">k</span>)</span>ã€‚<br>â€»<span class="hljs-number">9</span>åŸºæ•°: dæ˜¯æœ€å¤§æ•°ä½æ•°ï¼Œkæ˜¯è®¡æ•°æ•°ç»„å¤§å°ï¼Œå¤„ç†è´Ÿæ•°æ—¶k=<span class="hljs-number">19</span>ã€‚<br>    é‡‡ç”¨ç¨³å®šçš„è®¡æ•°æ’åºåˆ™ç¨³å®šï¼Œå¦åˆ™ä¸ç¨³å®šã€‚<br>â€»<span class="hljs-number">10</span>æ¡¶: ç¨³å®šæ€§å–å†³äºæ¡¶å†…æ’åºæ˜¯å¦ç¨³å®šã€‚ç©ºé—´å–å†³äºæ¡¶ä½¿ç”¨æ•°ç»„è¿˜æ˜¯å®¹å™¨ï¼Œ<br>    è‹¥é‡‡ç”¨æ•°ç»„ä¸º<span class="hljs-constructor">O(<span class="hljs-params">kn</span>)</span>ï¼Œå®¹å™¨åˆ™ä¸º<span class="hljs-constructor">O(<span class="hljs-params">n</span>)</span>ã€‚æ‰€æœ‰å…ƒç´ æ”¾å…¥åŒä¸€ä¸ªæ¡¶æ—¶å¤æ‚åº¦æœ€å¤§ã€‚<br>    æœ€åæ—¶é—´å¤æ‚åº¦å–å†³äºé‡‡ç”¨å“ªç§æ¡¶å†…æ’åºç®—æ³•ã€‚<br><br>ç¨³å®šæ€§: å­˜åœ¨ç¨³å®šå’Œéç¨³å®šç‰ˆæœ¬æ—¶ï¼Œè§†ä½œã€Œç¨³å®šã€ã€‚<br><br>ä½œè€…ï¼šyukiyama<br>é“¾æ¥ï¼šhttps:<span class="hljs-comment">//leetcode.cn/circle/discuss/eBo9UB/</span><br></code></pre></td></tr></table></figure><h2 id="1-å†’æ³¡æ’åº"><a href="#1-å†’æ³¡æ’åº" class="headerlink" title="1.å†’æ³¡æ’åº"></a>1.å†’æ³¡æ’åº</h2><blockquote><p>éå†æ•°ç»„ï¼Œä¸¤ä¸¤æ¯”è¾ƒï¼Œå¦‚æœå‰ä¸€ä¸ªæ•°å¤§äºåä¸€ä¸ªæ•°å°±äº¤æ¢ä¸¤ä¸ªæ•°ï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šæ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªæ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length - <span class="hljs-number">1</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; arr.length - i - <span class="hljs-number">1</span>; j++) &#123;<br>        <span class="hljs-keyword">if</span> (arr[j] &gt; arr[j + <span class="hljs-number">1</span>]) &#123;<br>            swap(j, j + <span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å†’æ³¡æ’åºä¸­å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹æœ‰ä¸¤å¤„ï¼š</p><ol><li>æå‰ç»“æŸä¼˜åŒ–ï¼šå¦‚æœæŸä¸€è½®æœªå‘ç”Ÿäº¤æ¢ï¼Œè¯´æ˜æ’åºå·²ç»å®Œæˆï¼Œå¯ä»¥æå‰ç»“æŸï¼Œå…·ä½“å®ç°å¯ä»¥å¢åŠ ä¸€ä¸ª boolean ç±»å‹å»è®°å½•</li><li>è¾¹ç•Œä¼˜åŒ–ï¼šè®°å½•å‰ä¸€è½®äº¤æ¢çš„æœ€ç»ˆä½ç½®ï¼Œè¯´æ˜è¯¥ä½ç½®ä¹‹åçš„å…ƒç´ ä¸ºå·²æ’åºçŠ¶æ€ï¼Œä¸‹ä¸€è½®çš„äº¤æ¢åªéœ€æ‰§è¡Œåˆ°è¯¥å¤„</li></ol><h2 id="2-æ’å…¥æ’åº"><a href="#2-æ’å…¥æ’åº" class="headerlink" title="2.æ’å…¥æ’åº"></a>2.æ’å…¥æ’åº</h2><blockquote><p>è¿™ä¸ªå¯ä»¥ç±»ä¼¼äºå°æœ‹å‹æ’é˜Ÿï¼Œæˆ‘ä»¬å…ˆé»˜è®¤ç¬¬ä¸€ä¸ªæ˜¯æœ‰åºçš„ï¼Œç„¶åå¼€å§‹å°†ç¬¬äºŒä¸ªå°æœ‹å‹ä¾æ¬¡å’Œå‰é¢çš„å°æœ‹å‹è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå°äºå‰é¢çš„å°±äº¤æ¢ï¼Œå¤§äºå°±ä¸åŠ¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; arr.length; i++) &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> arr[i]; <span class="hljs-comment">// é€‰ä¸­è¦å’Œå‰é¢æ¯”è¾ƒçš„å°ç›†å‹</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (j = i; j &gt; <span class="hljs-number">0</span> &amp;&amp; arr[j - <span class="hljs-number">1</span>] &gt; e; j--) &#123; <span class="hljs-comment">// ä»æœ‰åºçš„é˜Ÿä¼åé¢å‘å‰æ¯”è¾ƒ</span><br>        arr[j] = arr[j - <span class="hljs-number">1</span>]; <span class="hljs-comment">// å¦‚æœå‰é¢çš„æ¯”ä»–å¤§,å°±æŠŠå‰é¢çš„å‘åç§»åŠ¨ä¸€ä½</span><br>    &#125;<br>    arr[j] = e;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/InsertionSort.class">InsertionSort.java</a></p><h2 id="3-é€‰æ‹©æ’åº"><a href="#3-é€‰æ‹©æ’åº" class="headerlink" title="3.é€‰æ‹©æ’åº"></a>3.é€‰æ‹©æ’åº</h2><blockquote><p>å¯¹æ•°ç»„è¿›è¡Œéå†ï¼Œéœ€è¦æ¯æ¬¡æ‰¾åˆ°å‰©ä½™å…ƒç´ æœ€å°çš„å’Œå½“å‰å…ƒç´ äº¤æ¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length - <span class="hljs-number">1</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; arr.length; j++) &#123;<br>        <span class="hljs-keyword">if</span> (arr[i] &gt; arr[j]) &#123; <span class="hljs-comment">// å¦‚æœåé¢å…ƒç´ æ¯”å½“å‰å…ƒç´ æ›´å°ï¼Œå°±è¿›è¡Œäº¤æ¢</span><br>            swap(i, j);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¨³å®šæ€§ï¼šä¸ç¨³å®š</strong></p><p>å­˜åœ¨è·¨åŸŸäº¤æ¢ã€‚æ‰¾åˆ°æœ¬è½®æ¬¡æœ€å°å€¼ä¹‹åï¼Œå°†å…¶ä¸æœ¬è½®èµ·å§‹æ•°å­—äº¤æ¢ï¼Œæ­¤æ—¶è‹¥ä¸­é—´æœ‰ä¸èµ·å§‹å…ƒç´ åŒå€¼çš„å…ƒç´ ï¼Œå°†æ‰“ç ´ç¨³å®šæ€§ã€‚</p><p>ä¾‹:ã€€7 7 2 ã€‚ç¬¬ä¸€è½®äº¤æ¢ç¬¬ä¸€ä¸ª7å’Œ2ï¼Œåˆ™ä¸¤ä¸ª7ä½ç½®å…³ç³»æ”¹å˜ã€‚</p><h2 id="4-å¸Œå°”æ’åº"><a href="#4-å¸Œå°”æ’åº" class="headerlink" title="4.å¸Œå°”æ’åº"></a>4.å¸Œå°”æ’åº</h2><blockquote><p>æ’å…¥æ’åºçš„å‡çº§ç‰ˆï¼Œåˆå«<strong>ç¼©å°å¢é‡æ’åº</strong></p><p>9 8 7 6 5 4 3 2 4 0</p><p>0 1 2 3 4 5 6 7 8 9</p><p>å…ˆå»é•¿åº¦10ä¸€åŠï¼Œé—´éš”ä¸º5ï¼Œè§’æ ‡0,5è¿›è¡Œæ¯”è¾ƒå¤§å°(è§’æ ‡0,5ä¸­é—´é—´éš”5ä¸ª)ï¼Œå¦‚æœåé¢å°äºå‰é¢çš„åˆ™äº¤æ¢æ•°æ®(æ’å…¥æ’åº)ï¼Œç„¶åä¾æ¬¡æ˜¯è§’æ ‡1,6ï¼›2,8â€¦â€¦</p><p>ç„¶åå†å–é—´éš”çš„ä¸€åŠï¼Œé—´éš”ä¸º2ï¼Œè§’æ ‡0,2è¿›è¡Œæ¯”è¾ƒï¼Œä¹‹åè§’æ ‡1,3è¿›è¡Œæ¯”è¾ƒï¼Œä¹‹åè§’æ ‡2,4è¿›è¡Œæ¯”è¾ƒï¼Œè§’æ ‡2,4æ¯”è¾ƒå®Œåï¼Œè¿˜å¯ä»¥ç»§ç»­å‘å‰æ¯”è¾ƒè§’æ ‡0,2â€¦â€¦</p><p>â€¦â€¦</p><p>é—´éš”ä¸º1ï¼Œä¸¤ä¸¤æ¯”è¾ƒ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> arr.length;<br><span class="hljs-comment">// O(n^1.3)</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">gap</span> <span class="hljs-operator">=</span> len / <span class="hljs-number">2</span>; gap &gt; <span class="hljs-number">0</span>; gap = gap / <span class="hljs-number">2</span>) &#123; <span class="hljs-comment">// æ¯æ¬¡å–é—´éš”ä¸ºä¸€åŠ</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> gap; i &lt; len; i++) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> arr[i];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i;<br>        <span class="hljs-keyword">while</span> (j - gap &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[j - gap] &gt; e) &#123; <span class="hljs-comment">// æ’å…¥æ’åºçš„ä½“ç°</span><br>            arr[j] = arr[j - gap];<br>            j = j - gap;<br>        &#125;<br>        arr[j] = e;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/ShellSort.class">ShellSort.java</a></p><h2 id="5-å½’å¹¶æ’åº"><a href="#5-å½’å¹¶æ’åº" class="headerlink" title="5.å½’å¹¶æ’åº"></a>5.å½’å¹¶æ’åº</h2><blockquote><p>ä¾æ¬¡å¯¹åŠåˆ†ï¼Œä¸€ç›´åˆ†åˆ°æœ€å°ä¸€ä¸ªï¼Œç„¶åå¼€å§‹åˆå¹¶ï¼Œåˆå¹¶çš„æ—¶å€™å…¶å®å¯ä»¥ç†è§£ä¸ºã€åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ã€‘</p></blockquote><p><img src="https://img-blog.csdnimg.cn/img_convert/c62c948fb2bce64014ec6786f349333c.png" alt="image-20220202213646085"></p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/MergeSort.class">MergeSort.java</a></p><h2 id="6-å¿«æ’"><a href="#6-å¿«æ’" class="headerlink" title="6.å¿«æ’"></a>6.å¿«æ’</h2><p><strong>å•è·¯å¿«æ’</strong></p><blockquote><p>é¦–å…ˆé€‰ä¸­ä¸€ä¸ªæ•°ï¼ˆå¯ä»¥æ˜¯é»˜è®¤ç¬¬ä¸€ä¸ªæ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯éšæœºä¸€ä¸ªæ•°ç»„ä¸­çš„æ•°ï¼‰ä½œä¸ºä¸­é—´çš„æ•°ï¼Œç„¶åå°†å°äºä»–çš„æ•°å…¨éƒ¨æ”¾å®ƒçš„å·¦è¾¹ï¼Œå°†å¤§äºå®ƒçš„æ•°å…¨éƒ¨æ”¾åœ¨å³è¾¹ï¼Œç„¶åç¬¬äºŒæ­¥ï¼Œä»è§’æ ‡0åˆ°åˆšåˆšé‚£ä¸ªä¸­é—´çš„æ•°å†åšè¿™æ ·çš„æ“ä½œï¼Œä»ä¸­é—´çš„æ•°åˆ°æœ€åä¸€ä¸ªæ•°ä¹Ÿåšè¿™æ ·çš„æ“ä½œï¼Œç¬¬ä¸‰æ­¥â€¦â€¦</p></blockquote><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/QuickSort01.class">QuickSort01.java</a></p><hr><p><strong>åŒè·¯å¿«æ’</strong></p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/QuickSort02.class">QuickSort02.java</a></p><hr><p><strong>ä¸‰è·¯å¿«æ’</strong></p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/QuickSort03.class">QuickSort03.java</a></p><h2 id="7-åŸºæ•°æ’åº"><a href="#7-åŸºæ•°æ’åº" class="headerlink" title="7.åŸºæ•°æ’åº"></a>7.åŸºæ•°æ’åº</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/RadixSort.class">RadixSort.java</a></p><h2 id="8-æ¡¶æ’åº"><a href="#8-æ¡¶æ’åº" class="headerlink" title="8.æ¡¶æ’åº"></a>8.æ¡¶æ’åº</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/BucketSort.class">BucketSort.java</a></p><h2 id="9-è®¡æ•°æ’åº"><a href="#9-è®¡æ•°æ’åº" class="headerlink" title="9.è®¡æ•°æ’åº"></a>9.è®¡æ•°æ’åº</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/CountingSort.class">CountingSort.java</a></p><h2 id="10-æ’å€¼æŸ¥æ‰¾"><a href="#10-æ’å€¼æŸ¥æ‰¾" class="headerlink" title="10.æ’å€¼æŸ¥æ‰¾"></a>10.æ’å€¼æŸ¥æ‰¾</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/out/production/DS/p5/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/InterpolationSearch.class">InterpolationSearch.java</a></p><h2 id="11-å †æ’åº"><a href="#11-å †æ’åº" class="headerlink" title="11.å †æ’åº"></a>11.å †æ’åº</h2><h1 id="å…­ã€æ ‘ä¸å“ˆå¸Œè¡¨"><a href="#å…­ã€æ ‘ä¸å“ˆå¸Œè¡¨" class="headerlink" title="å…­ã€æ ‘ä¸å“ˆå¸Œè¡¨"></a>å…­ã€æ ‘ä¸å“ˆå¸Œè¡¨</h1><h2 id="1-äºŒåˆ†æœç´¢æ ‘"><a href="#1-äºŒåˆ†æœç´¢æ ‘" class="headerlink" title="1.äºŒåˆ†æœç´¢æ ‘"></a>1.äºŒåˆ†æœç´¢æ ‘</h2><blockquote><p>äºŒåˆ†æœç´¢æ ‘æœ¬èº«å°±æ˜¯äºŒå‰æ ‘ï¼Œåªä¸è¿‡åœ¨äºŒå‰æ ‘ä¸Šé¢åŠ äº†ä¸€äº›è§„åˆ™</p></blockquote><p>åšå®¢ä½ç½®ï¼š<a href="https://blog.csdn.net/weixin_46049759/article/details/123019755">æ ‘ä¸å“ˆå¸Œè¡¨â€”äºŒåˆ†æœç´¢æ ‘(BST)</a></p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/BinarySearchTree.java">BinarySearchTree.java</a></p><h2 id="2-é›†åˆäºŒåˆ†æœç´¢æ ‘å®ç°"><a href="#2-é›†åˆäºŒåˆ†æœç´¢æ ‘å®ç°" class="headerlink" title="2.é›†åˆäºŒåˆ†æœç´¢æ ‘å®ç°"></a>2.é›†åˆäºŒåˆ†æœç´¢æ ‘å®ç°</h2><blockquote><p>é›†åˆçš„åº•å±‚ç”±äºŒåˆ†æœç´¢æ•°å®ç°</p></blockquote><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/TreeSet.java">TreeSet.java</a></p><h2 id="3-é›†åˆé“¾è¡¨å®ç°"><a href="#3-é›†åˆé“¾è¡¨å®ç°" class="headerlink" title="3.é›†åˆé“¾è¡¨å®ç°"></a>3.é›†åˆé“¾è¡¨å®ç°</h2><blockquote><p>é›†åˆçš„åº•å±‚ç”±é“¾è¡¨å®å¿ƒ</p></blockquote><blockquote><p> è¯»å–æ–‡ä»¶ä¸­çš„å•è¯</p></blockquote><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/LinkedSet.java">LinkedSet.java</a></p><h2 id="4-MapäºŒåˆ†æœç´¢æ ‘å®ç°"><a href="#4-MapäºŒåˆ†æœç´¢æ ‘å®ç°" class="headerlink" title="4.MapäºŒåˆ†æœç´¢æ ‘å®ç°"></a>4.MapäºŒåˆ†æœç´¢æ ‘å®ç°</h2><blockquote><p>æœ¬è´¨ä¸Šå’ŒäºŒåˆ†æœç´¢æ•°è¿˜æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯Map</p></blockquote><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/TreeMap.java">TreeMap.java</a></p><h2 id="5-AVLå¹³è¡¡æ ‘"><a href="#5-AVLå¹³è¡¡æ ‘" class="headerlink" title="5.AVLå¹³è¡¡æ ‘"></a>5.AVLå¹³è¡¡æ ‘</h2><p>âœ¨<strong>å¯¹äºä»»æ„ä¸€ä¸ªèŠ‚ç‚¹,å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®ä¸èƒ½è¶…è¿‡1</strong></p><blockquote><p>åå­—ç¼˜ç”±ï¼šG.M.Adelson-Velskyå’ŒE.M.Landis</p><p>æ˜¯ä¸€ç§æœ€æ—©çš„è‡ªå¹³è¡¡äºŒåˆ†æœç´¢æ ‘ç»“æ„</p><p>æ»¡äºŒå‰æ ‘ä¸€å®šæ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œé«˜åº¦æœ€ä½</p><p>å®Œå…¨äºŒå‰æ ‘ä¹Ÿæ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œå¶å­èŠ‚ç‚¹æ·±åº¦ç›¸å·®ä¸ä¸º1</p></blockquote><p>AVLå¹³è¡¡æ ‘æ˜¯å¯¹BSTäºŒåˆ†æœç´¢æ ‘è¿›è¡Œäº†æ”¹å–„</p><p>åšå®¢ä½ç½®ï¼š<a href="https://blog.csdn.net/weixin_46049759/article/details/123033337">æ ‘ä¸å“ˆå¸Œè¡¨â€”äºŒåˆ†å¹³è¡¡æ ‘(AVL)</a></p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/AVLTreeMap.java">AVLTreeMap.java</a></p><h2 id="6-æœ€å¤§å †"><a href="#6-æœ€å¤§å †" class="headerlink" title="6.æœ€å¤§å †"></a>6.æœ€å¤§å †</h2><p>åšå®¢ä½ç½®ï¼š<a href="https://blog.csdn.net/weixin_46049759/article/details/123041016">æ ‘ä¸å“ˆå¸Œè¡¨â€”æœ€å¤§å †</a></p><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/MaxHeap.java">MaxHeap.java</a></p><h2 id="7-ä¼˜å…ˆé˜Ÿåˆ—æœ€å¤§å †å®ç°"><a href="#7-ä¼˜å…ˆé˜Ÿåˆ—æœ€å¤§å †å®ç°" class="headerlink" title="7.ä¼˜å…ˆé˜Ÿåˆ—æœ€å¤§å †å®ç°"></a>7.ä¼˜å…ˆé˜Ÿåˆ—æœ€å¤§å †å®ç°</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/PriorityQueue.java">PriorityQueue.java</a></p><h2 id="8-Tireæ ‘"><a href="#8-Tireæ ‘" class="headerlink" title="8.Tireæ ‘"></a>8.Tireæ ‘</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/Trie.java">Trie.java</a></p><h2 id="9-å“ˆå¸Œè¡¨"><a href="#9-å“ˆå¸Œè¡¨" class="headerlink" title="9.å“ˆå¸Œè¡¨"></a>9.å“ˆå¸Œè¡¨</h2><p>ä»£ç ä½ç½®:<a href="https://github.com/sanshisi/DS/blob/master/src/p6/%E6%A0%91%E4%B8%8E%E5%93%88%E5%B8%8C%E8%A1%A8/HashTable.java">HashTable.java</a></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®ç»“æ„ä¸ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
